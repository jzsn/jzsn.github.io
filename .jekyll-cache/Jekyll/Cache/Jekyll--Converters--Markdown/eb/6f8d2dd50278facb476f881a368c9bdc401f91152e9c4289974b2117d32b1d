I"}<h2 id="å®éªŒç›®çš„">å®éªŒç›®çš„</h2>

<p>åˆ©ç”¨ python å®ç° kMeans ç®—æ³•</p>

<h2 id="å®éªŒç®€ä»‹">å®éªŒç®€ä»‹</h2>

<p>åˆ©ç”¨ python çš„æ–‡æœ¬å¤„ç†èƒ½åŠ›å°†æ–‡æ¡£åˆ‡åˆ†æˆè¯ï¼Œé€šè¿‡é›†åˆå…ƒç´ çš„å”¯ä¸€æ€§ç”Ÿæˆè¯æ±‡åˆ— è¡¨ï¼ˆä¸åŒ…æ‹¬é‡å¤è¯æ±‡ï¼‰ï¼Œè¿›è€Œæ„å»ºè¯å‘é‡ï¼ˆè¯é›†å‘é‡æˆ–è¯è¢‹å‘é‡ï¼‰ï¼Œä»è¯å‘é‡è®¡ç®—æ¦‚ç‡ï¼Œç„¶å æ„å»ºåˆ†ç±»å™¨å¯¹é‚®ä»¶æ–‡æ¡£è¿›è¡Œåƒåœ¾é‚®ä»¶åˆ†ç±»ã€‚ä»£ç æ–‡ä»¶ï¼šbayes.py</p>

<h2 id="å®éªŒç¯å¢ƒ">å®éªŒç¯å¢ƒ</h2>

<h3 id="ç¡¬ä»¶">ç¡¬ä»¶</h3>

<p>æ‰€ç”¨æœºå™¨å‹å·ä¸º VAIO Z Flip 2016</p>

<ul>
  <li>Intel(R) Core(TM) i7-6567U CPU @3.30GHZ 3.31GHz</li>
  <li>8.00GB RAM</li>
</ul>

<h3 id="è½¯ä»¶">è½¯ä»¶</h3>

<ul>
  <li>Windows 10, 64-bit (Build 17763) 10.0.17763</li>
  <li>Visual Studio Code 1.39.2
    <ul>
      <li>Python 2019.10.41019ï¼šä¹æœˆåº•å‘å¸ƒçš„ VSCode Python æ’ä»¶æ”¯æŒåœ¨ç¼–è¾‘å™¨çª—å£å†…åŸç”Ÿè¿è¡Œ juyter nootbook äº†ï¼Œéå¸¸èµï¼</li>
      <li>Remote - WSL 0.39.9ï¼šé…åˆ WSLï¼Œåœ¨ Windows ä¸Šè·å¾— Linux æ¥è¿‘åŸç”Ÿç¯å¢ƒçš„ä½“éªŒã€‚</li>
    </ul>
  </li>
  <li>Windows Subsystem for Linux [Ubuntu 18.04.2 LTS]ï¼šWSL æ˜¯ä»¥è½¯ä»¶çš„å½¢å¼è¿è¡Œåœ¨ Windows ä¸‹çš„ Linux å­ç³»ç»Ÿï¼Œæ˜¯è¿‘äº›å¹´å¾®è½¯æ¨å‡ºæ¥çš„æ–°å·¥å…·ï¼Œå¯ä»¥åœ¨ Windows ç³»ç»Ÿä¸ŠåŸç”Ÿè¿è¡Œ Linuxã€‚
    <ul>
      <li>Python 3.7.4 64-bit (â€˜anaconda3â€™:virtualenv)ï¼šå®‰è£…åœ¨ WSL ä¸­ã€‚</li>
    </ul>
  </li>
</ul>

<h2 id="å®éªŒè¿‡ç¨‹">å®éªŒè¿‡ç¨‹</h2>

<ul>
  <li>åˆ©ç”¨ sklearn ä¸­ BernoulliNB åˆ†ç±»è¯¥é‚®ä»¶æ•°æ®é›†</li>
  <li>bayes.py ä¸­çš„è¯­å¥â€œfrom numpy import * â€ç”¨è¯­å¥â€œimport numpy as npâ€ä»£æ›¿ï¼Œä¿®æ”¹å…¶ä¸­å¯¹åº”çš„ä»£ç ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚</li>
  <li>å°†è¯é›†å‘é‡ç”¨ TF-IDF è¯å‘é‡æ›¿ä»£ï¼Œæµ‹è¯•åˆ†æç»“æœ</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åˆ©ç”¨ sklearnä¸­ BernoulliNBåˆ†ç±»è¯¥é‚®ä»¶æ•°æ®é›†
# bayes.pyä¸­çš„è¯­å¥â€œfrom numpy import * â€ç”¨è¯­å¥â€œimport numpy as npâ€ä»£æ›¿ï¼Œä¿®æ”¹å…¶ä¸­å¯¹åº”çš„ä»£ç ï¼Œä½¿å…¶èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚
# å°†è¯é›†å‘é‡ç”¨ TF-IDFè¯å‘é‡æ›¿ä»£ï¼Œæµ‹è¯•åˆ†æç»“æœ
# coding=utf-8
</span><span class="s">'''
é¡¹ç›®åç§°ï¼š
ä½œè€…
æ—¥æœŸ
'''</span>

<span class="c1"># å¯¼å…¥å¿…è¦åº“
</span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">feature_extraction</span>  <span class="c1"># å¯¼å…¥sklearnåº“, ä»¥è·å–æ–‡æœ¬çš„tf-idfå€¼
</span><span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">CountVectorizer</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_extraction.text</span> <span class="kn">import</span> <span class="n">TfidfTransformer</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">BernoulliNB</span>

<span class="c1"># åˆ›å»ºå®éªŒæ ·æœ¬
</span>

<span class="k">def</span> <span class="nf">loadDataSet</span><span class="p">():</span>
    <span class="n">postingList</span> <span class="o">=</span> <span class="p">[[</span><span class="s">'my'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'has'</span><span class="p">,</span> <span class="s">'flea'</span><span class="p">,</span> <span class="s">'problems'</span><span class="p">,</span> <span class="s">'help'</span><span class="p">,</span> <span class="s">'please'</span><span class="p">],</span>
                   <span class="p">[</span><span class="s">'maybe'</span><span class="p">,</span> <span class="s">'not'</span><span class="p">,</span> <span class="s">'take'</span><span class="p">,</span> <span class="s">'him'</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'park'</span><span class="p">,</span> <span class="s">'stupid'</span><span class="p">],</span>
                   <span class="p">[</span><span class="s">'my'</span><span class="p">,</span> <span class="s">'dalmation'</span><span class="p">,</span> <span class="s">'is'</span><span class="p">,</span> <span class="s">'so'</span><span class="p">,</span> <span class="s">'cute'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">,</span> <span class="s">'love'</span><span class="p">,</span> <span class="s">'him'</span><span class="p">],</span>
                   <span class="p">[</span><span class="s">'stop'</span><span class="p">,</span> <span class="s">'posting'</span><span class="p">,</span> <span class="s">'stupid'</span><span class="p">,</span> <span class="s">'worthless'</span><span class="p">,</span> <span class="s">'garbage'</span><span class="p">],</span>
                   <span class="p">[</span><span class="s">'mr'</span><span class="p">,</span> <span class="s">'licks'</span><span class="p">,</span> <span class="s">'ate'</span><span class="p">,</span> <span class="s">'my'</span><span class="p">,</span> <span class="s">'steak'</span><span class="p">,</span>
                       <span class="s">'how'</span><span class="p">,</span> <span class="s">'to'</span><span class="p">,</span> <span class="s">'stop'</span><span class="p">,</span> <span class="s">'him'</span><span class="p">],</span>
                   <span class="p">[</span><span class="s">'quit'</span><span class="p">,</span> <span class="s">'buying'</span><span class="p">,</span> <span class="s">'worthless'</span><span class="p">,</span> <span class="s">'dog'</span><span class="p">,</span> <span class="s">'food'</span><span class="p">,</span> <span class="s">'stupid'</span><span class="p">]]</span>
    <span class="c1"># 1 ä»£è¡¨ä¾®è¾±æ€§æ–‡å­—, 0 ä»£è¡¨æ­£å¸¸è¨€è®º
</span>    <span class="n">classVec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># postingListä¸ºè¯æ¡åˆ‡åˆ†åçš„æ–‡æ¡£é›†åˆï¼ŒclassVecä¸ºç±»åˆ«æ ‡ç­¾é›†åˆ
</span>    <span class="k">return</span> <span class="n">postingList</span><span class="p">,</span> <span class="n">classVec</span>


<span class="k">def</span> <span class="nf">createVocabList</span><span class="p">(</span><span class="n">dataSet</span><span class="p">):</span>
    <span class="n">vocabSet</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">docment</span> <span class="ow">in</span> <span class="n">dataSet</span><span class="p">:</span>
        <span class="c1"># ä¸¤ä¸ªé›†åˆçš„å¹¶é›†
</span>        <span class="n">vocabSet</span> <span class="o">=</span> <span class="n">vocabSet</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">docment</span><span class="p">)</span>
    <span class="c1"># è½¬æ¢æˆåˆ—è¡¨
</span>    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">vocabSet</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">setOfWords2Vec</span><span class="p">(</span><span class="n">vocabList</span><span class="p">,</span> <span class="n">inputSet</span><span class="p">):</span>
    <span class="c1"># åˆ›å»ºä¸€ä¸ªä¸è¯æ±‡è¡¨ç­‰é•¿çš„å‘é‡ï¼Œå¹¶å°†å…¶å…ƒç´ éƒ½è®¾ç½®ä¸º0
</span>    <span class="n">returnVec</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">vocabList</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">inputSet</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">vocabList</span><span class="p">:</span>
            <span class="c1"># æŸ¥æ‰¾å•è¯çš„ç´¢å¼•
</span>            <span class="n">returnVec</span><span class="p">[</span><span class="n">vocabList</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"the word: %s is not in my vocabulary"</span> <span class="o">%</span> <span class="n">word</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">returnVec</span>


<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">trainMat</span><span class="p">,</span> <span class="n">trainCategory</span><span class="p">):</span>
    <span class="c1"># trainMat:è®­ç»ƒæ ·æœ¬çš„è¯å‘é‡çŸ©é˜µï¼Œæ¯ä¸€è¡Œä¸ºä¸€ä¸ªé‚®ä»¶çš„è¯å‘é‡
</span>    <span class="c1"># trainGategory:å¯¹åº”çš„ç±»åˆ«æ ‡ç­¾ï¼Œå€¼ä¸º0ï¼Œ1è¡¨ç¤ºæ­£å¸¸ï¼Œåƒåœ¾
</span>    <span class="n">numTrain</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainMat</span><span class="p">)</span>
    <span class="n">numWords</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainMat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">pAbusive</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">trainCategory</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">numTrain</span><span class="p">)</span>
    <span class="n">p0Num</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numWords</span><span class="p">)</span>
    <span class="n">p1Num</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numWords</span><span class="p">)</span>
    <span class="n">p0Denom</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">p1Denom</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numTrain</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">trainCategory</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">p1Num</span> <span class="o">+=</span> <span class="n">trainMat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">p1Denom</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">trainMat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>

            <span class="n">p0Num</span> <span class="o">+=</span> <span class="n">trainMat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">p0Denom</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">trainMat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># ç±»1ä¸­æ¯ä¸ªå•è¯çš„æ¦‚ç‡
</span>    <span class="n">p1Vec</span> <span class="o">=</span> <span class="n">p1Num</span><span class="o">/</span><span class="n">p1Denom</span>
    <span class="n">p0Vec</span> <span class="o">=</span> <span class="n">p0Num</span><span class="o">/</span><span class="n">p0Denom</span>
    <span class="c1"># ç±»0ä¸­æ¯ä¸ªå•è¯çš„æ¦‚ç‡
</span>    <span class="k">return</span> <span class="n">p0Vec</span><span class="p">,</span> <span class="n">p1Vec</span><span class="p">,</span> <span class="n">pAbusive</span>


<span class="k">def</span> <span class="nf">classfy</span><span class="p">(</span><span class="n">vec2classfy</span><span class="p">,</span> <span class="n">p0Vec</span><span class="p">,</span> <span class="n">p1Vec</span><span class="p">,</span> <span class="n">pClass1</span><span class="p">):</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vec2classfy</span><span class="o">*</span><span class="n">p1Vec</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">pClass1</span><span class="p">)</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">vec2classfy</span><span class="o">*</span><span class="n">p0Vec</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pClass1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">p1</span> <span class="o">&gt;</span> <span class="n">p0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="c1"># å¯¹é‚®ä»¶çš„æ–‡æœ¬åˆ’åˆ†æˆè¯æ±‡ï¼Œé•¿åº¦å°äº2çš„é»˜è®¤ä¸ºä¸æ˜¯è¯æ±‡ï¼Œè¿‡æ»¤æ‰å³å¯ã€‚è¿”å›ä¸€ä¸²å°å†™çš„æ‹†åˆ†åçš„é‚®ä»¶ä¿¡æ¯ã€‚
</span>

<span class="k">def</span> <span class="nf">textParse</span><span class="p">(</span><span class="n">bigString</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="n">listOfTokens</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">r'\</span><span class="err">W+</span><span class="s">', bigString)
    return [tok.lower() for tok in listOfTokens if len(tok) &gt; 2]


def bagOfWords2Vec(vocabList, inputSet):
    # vocablistä¸ºè¯æ±‡è¡¨ï¼ŒinputSetä¸ºè¾“å…¥çš„é‚®ä»¶
    returnVec = [0]*len(vocabList)
    for word in inputSet:
        if word in vocabList:
            # æŸ¥æ‰¾å•è¯çš„ç´¢å¼•
            returnVec[vocabList.index(word)] = 1
        else:
            print("the word is not in my vocabulary")
    return returnVec

# å°†è¯é›†å‘é‡ç”¨ TF-IDFè¯å‘é‡æ›¿ä»£ï¼Œæµ‹è¯•åˆ†æç»“æœ

def TfidfVec(get_texts):
    mat = CountVectorizer()
    tf = TfidfTransformer()
    tfidf = tf.fit_transform(mat.fit_transform(get_texts))
    word = mat.get_feature_names()  # å•è¯çš„åç§°
    weight = tfidf.toarray()  # æƒé‡çŸ©é˜µ, åœ¨æ­¤ç¤ºèŒƒä¸­çŸ©é˜µä¸º(1, n)
    return weight


def spamTest():
    fullTest = []
    docList = []
    classList = []
    # it only 25 doc in every class
    for i in range(1, 26):
        wordList = textParse(open('</span><span class="n">email</span><span class="o">/</span><span class="n">spam</span><span class="o">/%</span><span class="n">d</span><span class="p">.</span><span class="n">txt</span><span class="s">' %
                                  i, encoding="ISO-8859-1").read())
        docList.append(wordList)
        fullTest.extend(wordList)
        classList.append(1)
        wordList = textParse(open('</span><span class="n">email</span><span class="o">/</span><span class="n">ham</span><span class="o">/%</span><span class="n">d</span><span class="p">.</span><span class="n">txt</span><span class="s">' %
                                  i, encoding="ISO-8859-1").read())
        docList.append(wordList)
        fullTest.extend(wordList)
        classList.append(0)
    # create vocabulary
    vocabList = createVocabList(docList)
    trainSet = list(range(50))
    testSet = []
    # choose 10 sample to test ,it index of trainMat
    for i in range(10):
        randIndex = int(np.random.uniform(0, len(trainSet)))  # num in 0-49
        testSet.append(trainSet[randIndex])
        del(trainSet[randIndex])
    trainMat = []
    trainClass = []
    for docIndex in trainSet:
        trainMat.append(bagOfWords2Vec(vocabList, docList[docIndex]))
        trainClass.append(classList[docIndex])
    # p0, p1, pSpam = train(np.array(trainMat), np.array(trainClass))
    # ä¿ç•™ä¸‹ä¸¤è¡Œè€Œå°†ä¸Šä¸€è¡Œæ³¨é‡Šæ‰ï¼Œå³å¯åˆ©ç”¨ sklearnä¸­ BernoulliNBåˆ†ç±»è¯¥é‚®ä»¶æ•°æ®é›†
    clf = BernoulliNB()
    clf.fit(np.array(trainMat), np.array(trainClass))
    errCount = 0
    for docIndex in testSet:
        wordVec = bagOfWords2Vec(vocabList, docList[docIndex])
        # if classfy(np.array(wordVec), p0, p1, pSpam) != classList[docIndex]:
        # ä¿ç•™ä¸‹ä¸¤è¡Œè€Œå°†ä¸Šä¸€è¡Œæ³¨é‡Šæ‰ï¼Œå³å¯åˆ©ç”¨ sklearnä¸­ BernoulliNBåˆ†ç±»è¯¥é‚®ä»¶æ•°æ®é›†
        if clf.predict(np.array([wordVec])) != classList[docIndex]:
            errCount += 1
            print(("classfication error"), docList[docIndex])

    print(("the error rate is "), float(errCount)/len(testSet))

if __name__ == '</span><span class="n">__main__</span><span class="s">':
    spamTest()
</span></code></pre></div></div>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the error rate is  0.0
</code></pre></div></div>

<ul>
  <li>ç¼–ç¨‹å®ç° PPT ä¸­çš„ä¾‹ 1</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ç¼–ç¨‹å®ç° PPTä¸­çš„ä¾‹ 1
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">clf</span><span class="o">=</span><span class="n">GaussianNB</span><span class="p">()</span>
    <span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]]))</span>
</code></pre></div></div>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>1]
</code></pre></div></div>

<ul>
  <li>åˆ©ç”¨æœ´ç´ è´å¶æ–¯ç®—æ³•å®ç°å¯¹ lab6 çš„ä¸¤ä¸ªæ•°æ®é›†åˆ†ç±»ã€‚</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åˆ©ç”¨æœ´ç´ è´å¶æ–¯ç®—æ³•å®ç°å¯¹ lab6çš„ä¸¤ä¸ªæ•°æ®é›†åˆ†ç±»ã€‚
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">BernoulliNB</span>

<span class="k">def</span> <span class="nf">file2matrix</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># å¾—åˆ°æ–‡ä»¶è¡Œæ•°
</span>    <span class="n">arrayOfLines</span> <span class="o">=</span> <span class="n">fr</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">numberOfLines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrayOfLines</span><span class="p">)</span>
    <span class="c1"># åˆ›å»ºè¿”å›çš„NumpyçŸ©é˜µ
</span>    <span class="n">returnMat</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numberOfLines</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">classLabelVector</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># è§£ææ–‡ä»¶æ•°æ®åˆ°åˆ—è¡¨
</span>    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">arrayOfLines</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># æ³¨é‡Š1
</span>        <span class="n">listFromLine</span> <span class="o">=</span> <span class="n">line</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="si">\</span><span class="se">t</span><span class="s">'</span><span class="p">)</span>  <span class="c1"># æ³¨é‡Š2
</span>        <span class="n">returnMat</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">listFromLine</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">classLabelVector</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">listFromLine</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">returnMat</span><span class="p">,</span> <span class="n">classLabelVector</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">file2matrix</span><span class="p">(</span><span class="s">'datingTestSet2.txt'</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">BernoulliNB</span><span class="p">()</span>
    <span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">clf</span><span class="p">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">sample_weight</span><span class="o">=</span><span class="bp">None</span><span class="p">))</span>
</code></pre></div></div>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0.325
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># åˆ©ç”¨æœ´ç´ è´å¶æ–¯ç®—æ³•å®ç°å¯¹ lab6çš„ä¸¤ä¸ªæ•°æ®é›†åˆ†ç±»ã€‚
# åˆ©ç”¨sklearnå®ç°ä½¿ç”¨æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨è¯†åˆ«æ‰‹å†™ä½“åº”ç”¨ã€‚
</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">BernoulliNB</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>


<span class="k">def</span> <span class="nf">img2vector</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="s">'''
    filename:æ–‡ä»¶åå­—
    å°†è¿™ä¸ªæ–‡ä»¶çš„æ‰€æœ‰æ•°æ®æŒ‰ç…§é¡ºåºå†™æˆä¸€ä¸ªä¸€ç»´å‘é‡å¹¶è¿”å›
    '''</span>
    <span class="n">returnVect</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
        <span class="n">lineStr</span> <span class="o">=</span> <span class="n">fr</span><span class="p">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
            <span class="n">returnVect</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lineStr</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">returnVect</span>

<span class="c1"># ä»æ–‡ä»¶åä¸­è§£æåˆ†ç±»æ•°å­—
</span>

<span class="k">def</span> <span class="nf">classnumCut</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="s">'''
    filename:æ–‡ä»¶å
    è¿”å›è¿™ä¸ªæ–‡ä»¶æ•°æ®ä»£è¡¨çš„å®é™…æ•°å­—
    '''</span>
    <span class="n">fileStr</span> <span class="o">=</span> <span class="n">fileName</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">classNumStr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fileStr</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'_'</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">classNumStr</span>

<span class="c1"># æ„å»ºè®­ç»ƒé›†æ•°æ®å‘é‡åŠå¯¹åº”åˆ†ç±»æ ‡ç­¾å‘é‡
</span>

<span class="k">def</span> <span class="nf">trainingDataSet</span><span class="p">():</span>
    <span class="s">'''
    ä»trainingDigitsæ–‡ä»¶å¤¹ä¸‹é¢è¯»å–æ‰€æœ‰æ•°æ®æ–‡ä»¶ï¼Œè¿”å›ï¼š
    trainingMatï¼šæ‰€æœ‰è®­ç»ƒæ•°æ®ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªæ•°æ®æ–‡ä»¶ä¸­çš„å†…å®¹
    hwLabelsï¼šæ¯ä¸€é¡¹è¡¨ç¤ºtraningMatä¸­å¯¹åº”é¡¹çš„æ•°æ®åˆ°åº•ä»£è¡¨æ•°å­—å‡ 
    '''</span>
    <span class="n">hwLabels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># è·å–ç›®å½•traningDigitså†…å®¹(å³æ•°æ®é›†æ–‡ä»¶å)ï¼Œå¹¶å‚¨å­˜åœ¨ä¸€ä¸ªlistä¸­
</span>    <span class="n">trainingFileList</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="s">'trainingDigits'</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainingFileList</span><span class="p">)</span>  <span class="c1"># å½“å‰ç›®å½•æ–‡ä»¶æ•°
</span>    <span class="c1"># åˆå§‹åŒ–mç»´å‘é‡çš„è®­ç»ƒé›†ï¼Œæ¯ä¸ªå‘é‡1024ç»´
</span>    <span class="n">trainingMat</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="mi">1024</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">fileNameStr</span> <span class="o">=</span> <span class="n">trainingFileList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># ä»æ–‡ä»¶åä¸­è§£æåˆ†ç±»æ•°å­—ï¼Œä½œä¸ºåˆ†ç±»æ ‡ç­¾
</span>        <span class="n">hwLabels</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">classnumCut</span><span class="p">(</span><span class="n">fileNameStr</span><span class="p">))</span>
        <span class="c1"># å°†å›¾ç‰‡çŸ©é˜µè½¬æ¢ä¸ºå‘é‡å¹¶å‚¨å­˜åœ¨æ–°çš„çŸ©é˜µä¸­
</span>        <span class="n">trainingMat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">img2vector</span><span class="p">(</span><span class="s">'trainingDigits/%s'</span> <span class="o">%</span> <span class="n">fileNameStr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hwLabels</span><span class="p">,</span> <span class="n">trainingMat</span>


<span class="k">def</span> <span class="nf">handwritingTest</span><span class="p">():</span>
    <span class="c1"># æ„å»ºè®­ç»ƒé›†
</span>    <span class="n">hwLabels</span><span class="p">,</span> <span class="n">trainingMat</span> <span class="o">=</span> <span class="n">trainingDataSet</span><span class="p">()</span>

    <span class="c1"># ä»testDigitsé‡Œé¢æ‹¿åˆ°æµ‹è¯•é›†
</span>    <span class="n">testFileList</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="s">'testDigits'</span><span class="p">)</span>

    <span class="c1"># é”™è¯¯æ•°
</span>    <span class="n">errorCount</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># æµ‹è¯•é›†æ€»æ ·æœ¬æ•°
</span>    <span class="n">mTest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">testFileList</span><span class="p">)</span>

    <span class="c1"># è·å–ç¨‹åºè¿è¡Œåˆ°æ­¤å¤„çš„æ—¶é—´ï¼ˆå¼€å§‹æµ‹è¯•ï¼‰
</span>    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">clf</span> <span class="o">=</span> <span class="n">BernoulliNB</span><span class="p">()</span>
    <span class="n">clf</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainingMat</span><span class="p">,</span> <span class="n">hwLabels</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mTest</span><span class="p">):</span>

        <span class="c1"># å¾—åˆ°å½“å‰æ–‡ä»¶å
</span>        <span class="n">fileNameStr</span> <span class="o">=</span> <span class="n">testFileList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># ä»æ–‡ä»¶åä¸­è§£æåˆ†ç±»æ•°å­—
</span>        <span class="n">classNumStr</span> <span class="o">=</span> <span class="n">classnumCut</span><span class="p">(</span><span class="n">fileNameStr</span><span class="p">)</span>

        <span class="c1"># å°†å›¾ç‰‡çŸ©é˜µè½¬æ¢ä¸ºå‘é‡
</span>        <span class="n">vectorUnderTest</span> <span class="o">=</span> <span class="n">img2vector</span><span class="p">(</span><span class="s">'testDigits/%s'</span> <span class="o">%</span> <span class="n">fileNameStr</span><span class="p">)</span>

        <span class="c1"># è°ƒç”¨knnç®—æ³•è¿›è¡Œæµ‹è¯•
</span>        <span class="n">classifierResult</span> <span class="o">=</span> <span class="n">clf</span><span class="p">.</span><span class="n">predict</span><span class="p">([</span><span class="n">vectorUnderTest</span><span class="p">])</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"the classifier came back with: %d, the real answer is: %d"</span> <span class="o">%</span>
              <span class="p">(</span><span class="n">classifierResult</span><span class="p">,</span> <span class="n">classNumStr</span><span class="p">))</span>

        <span class="c1"># é¢„æµ‹ç»“æœä¸ä¸€è‡´ï¼Œåˆ™é”™è¯¯æ•°+1
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">classifierResult</span> <span class="o">!=</span> <span class="n">classNumStr</span><span class="p">):</span>
            <span class="n">errorCount</span> <span class="o">+=</span> <span class="mf">1.0</span>

    <span class="k">print</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">n</span><span class="s">the total number of tests is: %d"</span> <span class="o">%</span> <span class="n">mTest</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"the total number of errors is: %d"</span> <span class="o">%</span> <span class="n">errorCount</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"the total error rate is: %f"</span> <span class="o">%</span> <span class="p">(</span><span class="n">errorCount</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">mTest</span><span class="p">)))</span>

    <span class="c1"># è·å–ç¨‹åºè¿è¡Œåˆ°æ­¤å¤„çš„æ—¶é—´ï¼ˆç»“æŸæµ‹è¯•ï¼‰
</span>    <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1"># æµ‹è¯•è€—æ—¶
</span>    <span class="k">print</span><span class="p">(</span><span class="s">"Cost time: %.2fmin, %.4fs."</span> <span class="o">%</span> <span class="p">((</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span><span class="o">//</span><span class="mi">60</span><span class="p">,</span> <span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">))</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">handwritingTest</span><span class="p">()</span>
</code></pre></div></div>

<p>è¿è¡Œæ—¶é—´å¦‚ä¸‹ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the total number of tests is: 946
the total number of errors is: 65
the total error rate is: 0.068710
Cost <span class="nb">time</span>: 0.00min, 21.8384s.
</code></pre></div></div>

<h2 id="å®éªŒæ€»ç»“">å®éªŒæ€»ç»“</h2>

<p>é€šè¿‡æœ¬æ¬¡å®éªŒï¼Œæˆ‘å¤§è‡´ç†Ÿæ‚‰äº† sklearn ä½¿ç”¨æœ´ç´ è´å¶æ–¯åšåˆ†ç±»çš„ç®—æ³•ï¼Œå¾—ç›Šäºä¹‹å‰æ¦‚ç‡è®ºçš„å­¦ä¹ ï¼Œè¿˜æ˜¯å¾ˆå®¹æ˜“ç†è§£å¹¶ä½¿ç”¨çš„ã€‚</p>
:ET