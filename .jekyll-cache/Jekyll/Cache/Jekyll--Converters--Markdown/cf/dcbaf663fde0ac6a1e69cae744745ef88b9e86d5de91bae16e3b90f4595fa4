I"ç_<h2 id="äºŒç»´">äºŒç»´</h2>

<p>ç‚¹å’Œå‘é‡åŒ–ä¸ºåæ ‡ Coord è¿›è¡Œè¿ç®—ï¼Œä½¿ç”¨ stl ä¸­çš„ complex å®ç°ã€‚</p>

<p>å¤æ•°ç›¸ä¹˜çš„å‡ ä½•æ„ä¹‰ä¸ºé•¿åº¦ç›¸ä¹˜ï¼Œæè§’ç›¸åŠ ã€‚</p>

<p>ç”¨ç›´çº¿ä¸Šçš„ä¸€ç‚¹ p å’Œæ–¹å‘å‘é‡ v è¡¨ç¤ºä¸€æ¡ç»è¿‡ p çš„ç›´çº¿ï¼Œç›´çº¿ä¸Šçš„æ‰€æœ‰ç‚¹ q æ»¡è¶³ q=p+t*vï¼Œå…¶ä¸­ t æ˜¯å‚æ•°ï¼›å½“é™åˆ¶ tâ‰¥0 æ—¶ï¼Œè¯¥å‚æ•°æ–¹ç¨‹è¡¨ç¤ºå°„çº¿ï¼›é™åˆ¶ 0â‰¤tâ‰¤1 æ—¶ï¼Œè¯¥å‚æ•°æ–¹ç¨‹è¡¨ç¤ºçº¿æ®µã€‚</p>

<p>æ­¤å¤–ï¼Œå¦‚æœå·²çŸ¥çº¿æ®µç«¯ç‚¹ a1 å’Œ a2ï¼Œå¯ä»¥é€šè¿‡ Line(a1,a2-a1)æ¥å¾—åˆ°å¯¹åº”çš„å‚æ•°å½¢å¼ã€‚</p>

<p>Morley å®šç†ï¼šä¸‰è§’å½¢æ¯ä¸ªå†…è§’çš„ä¸‰ç­‰åˆ†çº¿ç›¸äº¤æˆç­‰è¾¹ä¸‰è§’å½¢ã€‚</p>

<p>æ¬§æ‹‰å®šç†ï¼šå¹³é¢å›¾çš„ç‚¹æ•° Vã€è¾¹æ•° E å’Œé¢æ•° F æ»¡è¶³ V+F-E=2ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">Coord</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span>
<span class="cp">#define X real()
#define Y imag()
</span><span class="k">struct</span> <span class="nc">Line</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Line</span><span class="p">(</span><span class="n">Coord</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">Coord</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">())</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">Circle</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Circle</span><span class="p">(</span><span class="n">Coord</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">lf</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">c</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">polar</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//tä¸ºå‚æ•°ï¼Œå¹…è§’</span>
<span class="p">};</span>
<span class="cm">/*
Coord(lf x=0,lf y=0);//æ„é€ å‡½æ•°
lf real(Coord a);//açš„å®éƒ¨ï¼ˆå¤å¹³é¢çš„æ¨ªåæ ‡ï¼‰,ä¹Ÿå¯å†™ä½œa.real()
lf imag(Coord a);//açš„è™šéƒ¨ï¼ˆå¤å¹³é¢çš„çºµåæ ‡ï¼‰,ä¹Ÿå¯å†™ä½œa.imag()

lf abs(Coord a);//å‘é‡açš„æ¨¡é•¿ï¼Œæˆ–æ˜¯ç‚¹aåˆ°åŸç‚¹çš„è·ç¦»
lf norm(Coord a);//absçš„å¹³æ–¹ï¼Œæ¯”abså¿«ï¼Œä½†æ˜¯è¦æ³¨æ„æµ®ç‚¹æ•°ç²¾åº¦æº¢å‡º

lf arg(Coord a);//açš„å¹…è§’ï¼Œä¸atan2(a.real(),a.imag())ç­‰ä»·
Coord polar(lf r,lf t);//æåæ ‡ç”Ÿæˆæ–¹å¼ï¼Œrä¸ºå¹…å€¼ï¼Œtä¸ºå¹…è§’

//è¿ç®—ç¬¦é‡è½½+ã€-ã€*ã€/ï¼ˆä»¥åŠå¯¹åº”çš„èµ‹å€¼è¿ç®—ï¼Œä½†æ˜¯èµ‹å€¼è¿ç®—ä¸èƒ½å†™åœ¨è¡¨è¾¾å¼ä¸­ï¼Œè¯¦è§å‚è€ƒåœ°å€ï¼‰ã€&lt;&lt;ã€&gt;&gt;ï¼ˆè¾“å‡ºæ‹¬å·å½¢å¼çš„åæ ‡ï¼‰
*/</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//ä¸ç­‰è¿ç®—ç¬¦ï¼Œæ¶‰åŠåˆ°æµ®ç‚¹æ•°æ¯”è¾ƒè¦é‡å†™</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="nf">cmpCoord</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">?</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//å¤æ•°æ²¡æœ‰å°äºè¿ç®—ï¼Œåªèƒ½è¿™æ ·å®šä¹‰ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°</span>

<span class="kt">bool</span> <span class="nf">cmpLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">v</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//æŒ‰æè§’æ’åºï¼Œæ±‚å‡¸åŒ…ä¸­ä½¿ç”¨</span>

<span class="n">lf</span> <span class="nf">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">Area2</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//ä¸‰è§’å½¢ABCæœ‰å‘é¢ç§¯çš„ä¸¤å€</span>

<span class="n">Coord</span> <span class="nf">Rotate</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">lf</span> <span class="n">rad</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">polar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rad</span><span class="p">);}</span> <span class="c1">//å‘é‡Aé€†æ—¶é’ˆæ—‹è½¬radå¼§åº¦</span>

<span class="n">Coord</span> <span class="nf">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="c1">//Açš„æ³•å‘é‡ï¼ŒæŠŠAé€†æ—¶é’ˆæ—‹è½¬ä¹ååº¦å¹¶é•¿åº¦åŒ–ä¸º1</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">L</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Coord</span><span class="p">(</span><span class="o">-</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">L</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">onLeft</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//pæ˜¯å¦åœ¨æœ‰å‘ç›´çº¿Lå·¦ä¾§ï¼Œä¸å«çº¿ä¸Š</span>

<span class="n">lf</span> <span class="nf">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//ç‚¹åˆ°ç›´çº¿è·ç¦»ï¼ˆæœ‰å‘ï¼‰</span>

<span class="n">lf</span> <span class="nf">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">DistanceToSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//ç‚¹åˆ°çº¿æ®µçš„è·ç¦»ï¼ˆæ— å‘ï¼‰</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)));</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="nf">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//ç‚¹åœ¨ç›´çº¿ä¸Šçš„æŠ•å½±</span>

<span class="n">Coord</span> <span class="nf">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">Coord</span> <span class="nf">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">O</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">O</span> <span class="o">+</span> <span class="n">O</span> <span class="o">-</span> <span class="n">P</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//På…³äºOçš„å¯¹ç§°ç‚¹</span>

<span class="n">Coord</span> <span class="nf">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">L</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//På…³äºLçš„å¯¹ç§°ç‚¹</span>

<span class="n">Coord</span> <span class="nf">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L1</span><span class="p">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">L2</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L1</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//ç›´çº¿äº¤ç‚¹,é¡»ç¡®ä¿ä¸¤ç›´çº¿ç›¸äº¤</span>

<span class="n">Coord</span> <span class="nf">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">));</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="nf">SegmentProperIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="c1">//çº¿æ®µç›¸äº¤åˆ¤å®šï¼Œäº¤ç‚¹ä¸åœ¨ä¸€æ¡çº¿æ®µçš„ç«¯ç‚¹</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B1</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span>
	   <span class="n">C3</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">B1</span><span class="p">),</span> <span class="n">C4</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">onSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨çº¿æ®µä¸Šï¼Œä¸åŒ…å«ç«¯ç‚¹</span>

<span class="n">lf</span> <span class="nf">PolygonArea</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//è®¡ç®—å¤šè¾¹å½¢çš„æœ‰å‘é¢ç§¯ï¼Œå‡¸å¤šè¾¹å½¢å³ä¸ºé¢ç§¯</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">inPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">)</span> <span class="c1">//ç‚¹åœ¨å¤šè¾¹å½¢å†…çš„åˆ¤å®šï¼Œè½¬è§’æ³•ï¼Œæ­£å€¼ä¸ºå†…éƒ¨ï¼Œ0ä¸ºå¤–éƒ¨ï¼Œ-1åœ¨è¾¹ç•Œä¸Š</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//åœ¨è¾¹ç•Œä¸Š</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">d1</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="n">d2</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">++</span><span class="n">ans</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">--</span><span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">collineation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//è·å¾—å‡¸åŒ…ï¼Œä¸å¸Œæœ›å‡¸åŒ…çš„è¾¹ä¸Šæœ‰è¾“å…¥ç‚¹ç¬¬äºŒä¸ªå‚æ•°ä¼ 0</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">p</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpCoord</span><span class="p">);</span> <span class="c1">//å…ˆæ¯”æ¨ªåæ ‡å†æ¯”çºµåæ ‡</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="c1">//æ±‚å‡ºä¸‹å‡¸åŒ…</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="c1">//æ±‚å‡ºä¸Šå‡¸åŒ…</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">cutPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//ç”¨æœ‰å‘ç›´çº¿A-&gt;Båˆ‡å‰²å¤šè¾¹å½¢polyï¼Œ è¿”å›â€œå·¦ä¾§â€ã€‚ å¦‚æœé€€åŒ–ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªå•ç‚¹æˆ–è€…çº¿æ®µï¼Œå¤æ‚åº¦O(n^2)</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">newpoly</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">C</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">D</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">D</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="n">Coord</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="o">-</span> <span class="n">C</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
				<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">newpoly</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">getHalfPlaneIntersection</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">L</span><span class="p">)</span> <span class="c1">//åŠå¹³é¢äº¤</span>
<span class="p">{</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">L</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpLine</span><span class="p">);</span>  <span class="c1">//æŒ‰æè§’æ’åº</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Coord</span><span class="p">());</span> <span class="c1">//p[i]ä¸ºq[i]å’Œq[i+1]çš„äº¤ç‚¹</span>
	<span class="kt">int</span> <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>			<span class="c1">//åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ </span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Line</span><span class="p">());</span>   <span class="c1">//åŒç«¯é˜Ÿåˆ—</span>
	<span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>						<span class="c1">//é˜Ÿåˆ—åˆå§‹åŒ–ä¸ºåªæœ‰ä¸€ä¸ªåŠå¹³é¢L[0]</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">first</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">++</span><span class="n">first</span><span class="p">;</span>

		<span class="n">q</span><span class="p">[</span><span class="o">++</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">].</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">v</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onLeft</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]))</span>
				<span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">)</span>
			<span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]))</span>
		<span class="o">--</span><span class="n">last</span><span class="p">;</span> <span class="c1">//åˆ é™¤æ— ç”¨å¹³é¢</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">//ç©ºé›†</span>
	<span class="n">p</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">first</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//ä»dequeå¤åˆ¶åˆ°è¾“å‡ºä¸­</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getLineCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">b</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">c</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span>
	   <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">),</span>
	   <span class="n">g</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">delta</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">f</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">g</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">))),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C2</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//é‡åˆè¿”å›-1</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//å¤–ç¦»æˆ–å†…å«</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">C2</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C1</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">da</span> <span class="o">=</span> <span class="n">acos</span><span class="p">((</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">d</span><span class="p">));</span>

	<span class="n">Coord</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">da</span><span class="p">),</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">da</span><span class="p">);</span>

	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//ç›¸åˆ‡</span>
	<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Line</span> <span class="nf">getTangent</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//åœ†å¿ƒCï¼Œåœ†ä¸Šä¸€ç‚¹På¤„åˆ‡çº¿</span>

<span class="kt">int</span> <span class="nf">getTangents</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span> <span class="c1">//ç‚¹åˆ°åœ†çš„åˆ‡ç‚¹ï¼Œè¿”å›ä¸ªæ•°</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">u</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	  <span class="c1">//ç‚¹åœ¨åœ†å†…</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">))</span> <span class="c1">//ç‚¹åœ¨åœ†ä¸Š</span>
		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getTangents</span><span class="p">(</span><span class="n">Circle</span> <span class="n">A</span><span class="p">,</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">//å…¬å…±åˆ‡çº¿çš„åˆ‡ç‚¹</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">//æœ‰æ—¶éœ€æ ‡è®°äº¤æ¢</span>

	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">rdiff</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">rsum</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//å†…å«</span>

	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">rdiff</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//é‡åˆï¼Œæ— ç©·å¤šæ¡åˆ‡çº¿</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">))</span> <span class="c1">//å†…åˆ‡ï¼Œå¤–å…¬åˆ‡çº¿</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">//æœ‰å¤–å…¬åˆ‡çº¿çš„æƒ…å½¢</span>
	<span class="n">lf</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rdiff</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ang_in</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rsum</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="nf">AreaCircleWithTriangle</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//Cå’Œä¸‰è§’å½¢OABçš„ç›¸äº¤é¢ç§¯ï¼Œå¦‚æœä¸‰è§’å½¢é¡¶ç‚¹ä¸åœ¨Oä¸Šåˆ™æŠŠåœ†å’Œä¸‰è§’å½¢åŒæ—¶å¹³ç§»ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªé¡¶ç‚¹åœ¨Oä¸Š</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">sg</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sg</span> <span class="o">||</span> <span class="n">A</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span> <span class="o">||</span> <span class="n">B</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">OA</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">OB</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">prj</span> <span class="o">=</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">prj</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
		<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>

		<span class="n">lf</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
		   <span class="n">s2</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">s2</span> <span class="o">-=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">s1</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">s1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">inter</span><span class="p">;</span>
	<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">inter</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">inter_point</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">inter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)];</span>

	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">s</span> <span class="o">+=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="nf">AreaCircleWithPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">ans</span> <span class="o">+=</span> <span class="n">AreaCircleWithTriangle</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="nf">getGravityCenter</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//å¤šè¾¹å½¢é‡å¿ƒ</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lf</span> <span class="n">am</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mj</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">mj</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">a</span> <span class="o">+=</span> <span class="n">mj</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">am</span> <span class="o">+=</span> <span class="n">mj</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">am</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="ä¸‰ç»´">ä¸‰ç»´</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">INF</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>
<span class="k">struct</span> <span class="nc">Coord3</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">;</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">/=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">};</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">norm</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">abs</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Area2</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Volume6</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>	 <span class="c1">//å››é¢ä½“ä½“ç§¯</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">;</span> <span class="p">}</span>		  <span class="c1">//å››é¢ä½“çš„é‡å¿ƒ</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToPlane</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="p">}</span>		  <span class="c1">//ç‚¹påˆ°å¹³é¢p0-nçš„æœ‰å‘è·ç¦»</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">getPlaneProjection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//ç‚¹påœ¨å¹³é¢p0-nä¸Šçš„æŠ•å½±ã€‚nå¿…é¡»ä¸ºå•ä½å‘é‡</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">LinePlaneIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">n</span><span class="p">)</span>							  <span class="c1">//ç›´çº¿p1-p2 ä¸å¹³é¢p0-nçš„äº¤ç‚¹ï¼Œå‡è®¾äº¤ç‚¹å”¯ä¸€å­˜åœ¨</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">);</span> <span class="c1">//åˆ†æ¯ä¸º0ï¼Œç›´çº¿ä¸å¹³é¢å¹³è¡Œæˆ–åœ¨å¹³é¢ä¸Š</span>
		<span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>						  <span class="c1">//å¦‚æœæ˜¯çº¿æ®µ åˆ¤æ–­tæ˜¯å¦åœ¨0~1ä¹‹é—´</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//ç‚¹Påˆ°ç›´çº¿ABçš„è·ç¦»</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToSeg</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//ç‚¹åˆ°çº¿æ®µçš„è·ç¦»</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">LineDistance3D</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">u</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">v</span><span class="p">,</span> <span class="n">lf</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="c1">//æ±‚å¼‚é¢ç›´çº¿ p1+s*uä¸p2+t*vçš„å…¬å‚çº¿å¯¹åº”çš„sï¼Œå¦‚æœå¹³è¡Œ|é‡åˆï¼Œè¿”å›0</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">a</span><span class="p">)))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p1å’Œp2æ˜¯å¦åœ¨çº¿æ®µa-bçš„åŒä¾§</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>																						 <span class="c1">//ç‚¹Påœ¨ä¸‰è§’å½¢P0,P1,pä¸­</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">PP</span><span class="p">)</span> <span class="c1">//ä¸‰è§’å½¢P0P1pæ˜¯å¦å’Œçº¿æ®µABç›¸äº¤ï¼Œå¦‚æœ‰åˆ™ä¸ºPP</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>						 <span class="c1">//çº¿æ®µA-Bå’Œå¹³é¢P0P1på¹³è¡Œæˆ–å…±é¢</span>
		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="c1">//å¹³é¢Aå’Œç›´çº¿P1-pæœ‰æƒŸä¸€äº¤ç‚¹</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">//ä¸åœ¨çº¿æ®µABä¸Š</span>
		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriTriIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">T1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">T2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">//ç©ºé—´ä¸¤ä¸‰è§’å½¢æ˜¯å¦ç›¸äº¤</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T2</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">)</span> <span class="o">||</span>
				<span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="n">T1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T1</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">SegSegDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans2</span><span class="p">)</span> <span class="c1">//ç©ºé—´ä¸¤ç›´çº¿ä¸Šæœ€è¿‘ç‚¹å¯¹ è¿”å›æœ€è¿‘è·ç¦» ç‚¹å¯¹ä¿å­˜åœ¨ans1 ans2ä¸­</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">b1</span><span class="p">),</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">b2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">ab</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">ab</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">,</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">nd</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">cd</span><span class="p">),</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d1</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">,</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">InsideWithMinDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">*</span><span class="n">P</span><span class="p">,</span> <span class="n">lf</span> <span class="n">dist</span><span class="p">)</span> <span class="c1">//åˆ¤æ–­PPæ˜¯å¦åœ¨ä¸‰è§’å½¢Pä¸­ï¼Œå¹¶ä¸”åˆ°ä¸‰æ¡è¾¹çš„è·ç¦»éƒ½è‡³å°‘ä¸ºdistã€‚ä¿è¯P,A,B,Cå…±é¢</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">minBall</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">lf</span> <span class="n">eps</span> <span class="o">=</span> <span class="n">EPS</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="c1">//æ¨¡æ‹Ÿé€€ç«æ±‚æœ€å°çƒè¦†ç›–ï¼ŒEPSç„å­¦è°ƒæ•´ï¼›è¿”å›åŠå¾„</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">Coord3</span> <span class="n">z</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">;</span> <span class="n">step</span> <span class="o">*=</span> <span class="mf">0.99</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
					<span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]));</span>
			<span class="n">z</span> <span class="o">-=</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">*</span> <span class="n">step</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">Sphere</span>
<span class="p">{</span>
	<span class="n">Coord3</span> <span class="n">o</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Coord3</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lf</span> <span class="n">lng</span><span class="p">)</span> <span class="k">const</span> <span class="c1">//ç»çº¬åº¦ç¡®å®šçƒé¢ä¸Šä¸€ç‚¹</span>
	<span class="p">{</span>
		<span class="n">lat</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="n">lng</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">o</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)};</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">ConvexPolyhedron</span> <span class="c1">//ç©ºé—´å¤šè¾¹å½¢å’Œå‡¸åŒ…é—®é¢˜</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Face</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">Face</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
		<span class="n">Coord3</span> <span class="n">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="p">}</span>
		<span class="kt">bool</span> <span class="n">CanSee</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Normal</span><span class="p">(</span><span class="n">P</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//fæ˜¯å¦èƒ½çœ‹è§P[i]</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">ConvexPolyhedron</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">P</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">()};</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span> <span class="c1">//ç”±äºå·²ç»è¿›è¡Œæ‰°åŠ¨ï¼Œå‰ä¸‰ä¸ªç‚¹ä¸å…±çº¿</span>
		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">next</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="c1">//è®¡ç®—æ¯æ¡è¾¹çš„â€œå·¦é¢â€çš„å¯è§æ€§</span>
			<span class="p">{</span>
				<span class="n">Face</span> <span class="o">&amp;</span><span class="n">f</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">CanSee</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="p">)</span>
					<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
					<span class="n">vis</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">];</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vis</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">])</span> <span class="c1">//(a,b)æ˜¯åˆ†ç•Œçº¿ï¼Œå·¦è¾¹å¯¹P[i]å¯è§</span>
						<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">randEPS</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">lf</span><span class="p">(</span><span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPS</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="n">centroid</span><span class="p">()</span> <span class="c1">//ä¸‰ç»´å‡¸åŒ…é‡å¿ƒ</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">C</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tot</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
		<span class="n">lf</span> <span class="n">totv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">lf</span> <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
			<span class="n">totv</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
			<span class="n">tot</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">tot</span> <span class="o">/</span> <span class="n">totv</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">dist</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="c1">//å‡¸åŒ…å†…ä¸€ç‚¹åˆ°è¡¨é¢æœ€è¿‘è·ç¦»</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)));</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
:ET