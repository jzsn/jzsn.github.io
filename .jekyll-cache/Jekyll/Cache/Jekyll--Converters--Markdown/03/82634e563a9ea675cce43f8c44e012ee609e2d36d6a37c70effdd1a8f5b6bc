I"ÛH<p>è¿™é‡Œç”¨ç±»ä¼¼é‚»æ¥è¡¨çš„æ–¹æ³•å­˜å›¾ã€‚æœ‰çš„ç®—æ³•å¯èƒ½éœ€è¦é‚»æ¥çŸ©é˜µï¼Œè¯¦è§çº¿æ€§ä»£æ•°éƒ¨åˆ†ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Vertex</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">o</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>		<span class="c1">//ç›¸å…³å‡ºè¾¹å’Œå…¥è¾¹ç¼–å·</span>
		<span class="kt">int</span> <span class="n">siz</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">dfn</span><span class="p">;</span> <span class="c1">//æ ‘é“¾å‰–åˆ†ä¸­ä½¿ç”¨ï¼Œä¾æ¬¡ä»£è¡¨å­æ ‘èŠ‚ç‚¹æ•°ã€æ·±åº¦ã€æ‰€åœ¨é“¾çš„é¡¶ç«¯èŠ‚ç‚¹ã€dfsåº</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="nc">Edge</span> <span class="o">:</span> <span class="n">pair</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">len</span><span class="p">,</span> <span class="n">cap</span><span class="p">;</span> <span class="c1">//è¾¹é•¿ã€å®¹é‡ï¼Œå›¾è®ºç®—æ³•ä½¿ç”¨</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vertex</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span> <span class="c1">//ç‚¹é›†</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="n">e</span><span class="p">;</span>   <span class="c1">//è¾¹é›†</span>
	<span class="n">Graph</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">v</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span> <span class="o">==</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span> <span class="c1">//å¦‚æœæœ‰éœ€è¦è¯·æ‹†ç‚¹</span>
		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">v</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">e</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ch</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//uçš„ç¬¬iä¸ªå­©å­èŠ‚ç‚¹</span>
	<span class="kt">int</span> <span class="n">fa</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">first</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//uçš„ç¬¬iä¸ªçˆ¶èŠ‚ç‚¹</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="æœ€çŸ­è·¯">æœ€çŸ­è·¯</h2>

<h3 id="dijkstra-ç®—æ³•">Dijkstra ç®—æ³•</h3>

<p><a href="https://vjudge.net/solution/19427495">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œé€‚ç”¨äºè¾¹æƒä¸ºæ­£çš„æƒ…å†µï¼ˆæ— è®ºæœ‰å‘å›¾è¿˜æ˜¯æ— å‘å›¾ï¼‰ï¼Œç”¨äºæ±‚å•æºæœ€çŸ­è·¯ã€‚</p>

<p>ç›´æ¥ç»™å‡ºå…¶ä¼˜å…ˆé˜Ÿåˆ—ä¼˜åŒ–çš„ç‰ˆæœ¬ã€‚å¦å¤–ï¼Œç”±äº<code class="highlighter-rouge">priority_queue</code>å¹¶ä¸æä¾›ä¿®æ”¹ä¼˜å…ˆçº§çš„æ“ä½œï¼Œä¸ºé¿å…é‡å¤æ‰©å±•ï¼Œè¿™é‡Œé€‰æ‹©å°†æ–°å…ƒç´ ç›´æ¥æ’å…¥é˜Ÿåˆ—å¹¶åœ¨è¿è¡Œæ—¶åˆ¤æ–­è¯¥ç‚¹æ˜¯å¦è¢«å¤„ç†ï¼Œå¹¶ä¸å½±å“ç»“æœçš„æ­£ç¡®æ€§ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Dijkstra</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Dijkstra</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dis</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
					<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">to</span><span class="p">));</span>
				<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="bellmanford-ç®—æ³•">BellmanFord ç®—æ³•</h3>

<p><a href="https://vjudge.net/solution/16970652">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œç›´æ¥ç»™å‡ºå…¶é˜Ÿåˆ—ä¼˜åŒ–ã€å›½å†…ç§°ä¹‹ä¸º SPFA ç®—æ³•çš„ç‰ˆæœ¬ã€‚è¾ƒä¹‹ Dijkstra ç®—æ³•ï¼Œæ­¤ç®—æ³•ä¸å¤Ÿå¿«é€Ÿç¨³å®šä½†æ˜¯å¯ä»¥å…è®¸è´Ÿè¾¹å­˜åœ¨ï¼Œå½“ s åˆ°è¾¾è´Ÿæƒå›è·¯æ—¶ä¼šç›´æ¥è¿”å› 0ã€‚ç¨€ç–å›¾ä¸Šæ€§èƒ½ä¼˜ç§€ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">BellmanFord</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">BellmanFord</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">bool</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">d</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">p</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
							<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
						<span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="å·®åˆ†çº¦æŸç³»ç»Ÿ">å·®åˆ†çº¦æŸç³»ç»Ÿ</h4>

<p>æŒ‰å¦‚ä¸‹æ–¹å¼å»ºå›¾ã€è·‘ SPFAï¼š</p>

<p>å¯¹æ¯ä¸ªä¸ç­‰å¼$x_iâˆ’x_j\leq d$ï¼Œä»$j$å‘$i$è¿ä¸€æ¡è¾¹ï¼Œè¾¹é•¿ä¸º$d$ã€‚</p>

<p>è‹¥ä¸ç­‰å·çš„æ–¹å‘ç›¸åï¼Œå³$x_iâˆ’x_j\geq d$ï¼Œåˆ™åœ¨ä¸ç­‰å¼ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥$-1$ï¼Œå˜æˆ$x_jâˆ’x_i\leq -d$ï¼Œå³ä»$i$åˆ°$j$è¿ä¸€æ¡è¾¹ï¼Œè¾¹é•¿ä¸º$d$ã€‚</p>

<h3 id="floyed-æ±‚å¤šæºæœ€çŸ­è·¯">Floyed æ±‚å¤šæºæœ€çŸ­è·¯</h3>

<p>ä¸è¿é€šçš„æƒç½® INFã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">floyed</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">// å…¶å®ä¸€èˆ¬æ‰‹æ‰“å³å¯ï¼Œæ²¡å¿…è¦å¥—è¿™ä¸ªé¬¼æ¨¡æ¿â€¦</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
					<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="astar-æ±‚-k-çŸ­è·¯">Astar æ±‚ k çŸ­è·¯</h3>

<p><a href="https://vjudge.net/solution/16970766">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œåœ¨è¿™ä¸ªæ¯”è¾ƒå‘çš„ä¾‹å­ä¸­éœ€è¦åœ¨è°ƒç”¨å‰è¡¥ä¸€å¥<code class="highlighter-rouge">if(s==t)++k;</code>ã€‚<strong>k ä¸‹æ ‡ä» 0 å¼€å§‹ï¼Œå³æœ€çŸ­è·¯==ç¬¬ 0 çŸ­è·¯</strong>ã€‚</p>

<p>æœ´ç´ çš„æƒ³æ³•æ˜¯ä½¿ç”¨<code class="highlighter-rouge">priority_queue</code>ä»åŸç‚¹å‡ºå‘å‘å¤–æ¢ç´¢ï¼Œå½“å–å‡ºç»ˆç‚¹ t ç¬¬ k æ¬¡æ—¶å°±å¾—åˆ°ç¬¬ k çŸ­è·¯ï¼Œç±»ä¼¼ bfs çš„æ€æƒ³ï¼Œç¼ºé™·æ˜¯è¶Šå¾€åçŠ¶æ€æ•°è¶Šå¤šã€‚</p>

<p>æˆ‘ä»¬åœ¨åå‘å›¾ä¸Šä»$t\to s$è·‘ Astar ç®—æ³•ï¼Œé€šè¿‡ä¼˜å…ˆå±•å¼€åˆ° s è¿‘çš„çŠ¶æ€ï¼Œä½¿æœç´¢æ–¹å‘é è¿‘ç­”æ¡ˆï¼Œè€Œä¸æ˜¯ä¸€å±‚ä¸€å±‚å…¨éƒ½å±•å¼€ï¼Œä¼°ä»·å‡½æ•°$f\approx g+h$ï¼Œf æ˜¯ä¼°è®¡çš„ s åˆ° t çš„è·ç¦»ï¼Œg æ˜¯åˆ°è¾¾å½“å‰ç‚¹å·²ç»ç‚¹çš„èŠ±è´¹ï¼Œh æ˜¯é¢„è®¡å‰©ä¸‹çš„èŠ±è´¹ã€‚è¿™é‡Œ h å–å½“å‰ç‚¹çš„è·ç¦»åˆ° s è·ç¦»ï¼Œå¯é€šè¿‡ä» s è·‘ä¸€é Dijkstra å¯ä»¥é¢„å¤„ç†å¾—å‡ºã€‚</p>

<p>Astar ç®—æ³•æ˜¯åªæœ‰åˆ°è¾¾ç»ˆç‚¹çš„æ—¶å€™æ‰èƒ½ç»Ÿè®¡ç­”æ¡ˆï¼Œè¿™å¯¼è‡´å¯èƒ½æ‹“å±•å¾ˆå¤šä¸ªçŠ¶æ€æ‰èƒ½å¾—åˆ°ä¸€ä¸ªç”¨æ¥æ›´æ–°ç­”æ¡ˆçš„æœ‰æ•ˆçŠ¶æ€ã€‚ä¾‹å¦‚ä¸€ä¸ª n å…ƒç¯ï¼Œå½“æˆ‘ä»¬åˆ°è¾¾ç»ˆç‚¹ä¹‹å,å¯èƒ½è¿˜è¦æ‹“å±• n æ¬¡æ‰èƒ½å¾—åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œäºæ˜¯æ—¶é—´å¤æ‚åº¦å°±è¢«å¡åˆ°$O(nk)$ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Astar</span> <span class="o">:</span> <span class="n">Dijkstra</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">Astar</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Dijkstra</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">k</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Dijkstra</span><span class="o">::</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">cnt</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">t</span><span class="p">));</span> <span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">u</span> <span class="o">==</span> <span class="n">s</span><span class="p">)</span>
				<span class="n">ans</span><span class="p">[</span><span class="n">cnt</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span> <span class="o">=</span> <span class="n">dis</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="o">++</span><span class="n">cnt</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">]</span> <span class="o">-</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">-</span> <span class="n">dis</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="ç½‘ç»œæµ">ç½‘ç»œæµ</h2>

<h3 id="isap-æ±‚æœ€å¤§æµ">ISAP æ±‚æœ€å¤§æµ</h3>

<p><a href="https://vjudge.net/solution/16970964">ä½¿ç”¨ç¤ºä¾‹</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">ISAP</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">h</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">gap</span><span class="p">;</span>
	<span class="n">ISAP</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">_r</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]));</span>
				<span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">_r</span> <span class="o">==</span> <span class="n">r</span> <span class="o">||</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="k">return</span> <span class="n">_r</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="n">gap</span><span class="p">[</span><span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]])</span>
			<span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
		<span class="k">return</span> <span class="o">++</span><span class="n">gap</span><span class="p">[</span><span class="o">++</span><span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]],</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">cur</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">gap</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="cm">/*
		for (deque&lt;int&gt; q(h[t] = gap[t] = 1, t); !q.empty(); q.pop_front()) //ä¼˜åŒ–ï¼ŒåŠ äº†èƒ½å¿«ä¸€ç‚¹
			for (int i = 0, u = q.front(), k, to; i &lt; v[u].o.size(); ++i)
				if (to = e[v[u].o[i]].second, !h[to])
					++gap[h[to] = h[u] + 1], q.push_back(to);
		*/</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();)</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="primaldual-æ±‚è´¹ç”¨æµ">PrimalDual æ±‚è´¹ç”¨æµ</h3>

<p><a href="https://vjudge.net/solution/16971249">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œå®šä¹‰ä¸€æ¡è¾¹çš„è´¹ç”¨ä¸ºæµé‡*è¾¹é•¿ï¼Œæ±‚æ€»è´¹ç”¨æœ€å°çš„æœ€å¤§æµã€‚æ€§èƒ½ä¼˜ç§€ï¼Œåªèƒ½è·‘éè´Ÿæƒå›¾ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">PrimalDual</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">PrimalDual</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="c1">//è¯¢é—®såˆ°tçš„æœ€å°è´¹ç”¨æœ€å¤§æµï¼Œç­”æ¡ˆå­˜åœ¨flowã€costä¸­</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">),</span> <span class="n">h</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">ll</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">q</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">));</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
			<span class="p">{</span>
				<span class="n">ll</span> <span class="n">dis</span> <span class="o">=</span> <span class="o">-</span><span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">first</span><span class="p">;</span>
				<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">().</span><span class="n">second</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dis</span><span class="p">)</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
						<span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="p">{</span>
						<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
						<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">make_pair</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">to</span><span class="p">));</span>
					<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">INF</span><span class="p">)</span>
					<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">len</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="ek-æ±‚è´¹ç”¨æµ">EK æ±‚è´¹ç”¨æµ</h3>

<p><a href="https://vjudge.net/solution/16971149">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œå®šä¹‰ä¸€æ¡è¾¹çš„è´¹ç”¨ä¸ºæµé‡*è¾¹é•¿ï¼Œæ±‚æ€»è´¹ç”¨æœ€å°çš„æœ€å¤§æµã€‚BellmanFord ç®—æ³•æ‰¾å¢å¹¿è·¯ï¼Œå¯èƒ½è¢«å¡ä½†æ˜¯å¯ä»¥è·‘è´Ÿè´¹ç”¨æµï¼ˆæœ€å¤§è´¹ç”¨æµï¼‰ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">EdmondKarp</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">EdmondKarp</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">d</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">INF</span><span class="p">);</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">i</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span>
						<span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">d</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
							<span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">to</span><span class="p">),</span> <span class="n">flag</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">s</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">first</span><span class="p">)</span>
				<span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">e</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]].</span><span class="n">len</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="zkw-æ±‚è´¹ç”¨æµ">ZKW æ±‚è´¹ç”¨æµ</h3>

<p><a href="https://vjudge.net/solution/16971099">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œå®šä¹‰ä¸€æ¡è¾¹çš„è´¹ç”¨ä¸ºæµé‡*è¾¹é•¿ï¼Œæ±‚æ€»è´¹ç”¨æœ€å°çš„æœ€å¤§æµã€‚</p>

<p>å¯¹äºæœ€ç»ˆæµé‡è¾ƒå¤§ï¼Œè€Œè´¹ç”¨å–å€¼èŒƒå›´ä¸å¤§çš„å›¾ï¼Œæˆ–è€…æ˜¯å¢å¹¿è·¯å¾„æ¯”è¾ƒçŸ­çš„å›¾ï¼ˆå¦‚äºŒåˆ†å›¾ï¼‰ï¼Œzkw ç®—æ³•éƒ½ä¼šæ¯”è¾ƒå¿«ï¼ŒåŸå› æ˜¯å……åˆ†å‘æŒ¥ä¼˜åŠ¿ã€‚æ¯”å¦‚æµå¤šè¯´æ˜å¯ä»¥åŒä¸€è´¹ç”¨åå¤å¢å¹¿ï¼Œè´¹ç”¨çª„è¯´æ˜ä¸ç”¨æ”¹å¤ªå¤šè·ç¦»æ ‡å·å°±ä¼šæœ‰æ–°å¢å¹¿è·¯ï¼Œå¢å¹¿è·¯å¾„çŸ­å¯ä»¥æ˜¾è‘—æ”¹å–„æœ€åæƒ…å†µï¼Œå› ä¸ºå³ä½¿æ¯æ¬¡å°±åªå¢åŠ ä¸€æ¡è¾¹ä¹Ÿå¯ä»¥å¾ˆå¿«å‡‘æˆæœ€çŸ­è·¯ã€‚å¦‚æœæ°æ°ç›¸åï¼Œæµé‡ä¸å¤§ï¼Œè´¹ç”¨ä¸å°ï¼Œå¢å¹¿è·¯è¿˜è¾ƒé•¿ï¼Œå°±ä¸é€‚åˆ zkw ç®—æ³•äº†ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">ZKW</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">flow</span><span class="p">,</span> <span class="n">cost</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">h</span><span class="p">,</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">ZKW</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">Edge</span> <span class="n">ed</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">),</span> <span class="n">ed</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="n">_r</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">==</span> <span class="n">h</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
				<span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">_r</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">])),</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">_r</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">_r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">h</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">vis</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">flow</span> <span class="o">=</span> <span class="n">cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);;)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">_f</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">INF</span><span class="p">),</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="n">flow</span> <span class="o">+=</span> <span class="n">_f</span><span class="p">,</span> <span class="n">cost</span> <span class="o">+=</span> <span class="n">_f</span> <span class="o">*</span> <span class="n">h</span><span class="p">[</span><span class="n">s</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">u</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">cap</span> <span class="o">&gt;</span> <span class="n">f</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
						<span class="n">d</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">,</span> <span class="n">vis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="ä¸Šä¸‹ç•Œæœ‰æºæ±‡ç½‘ç»œæµ">ä¸Šä¸‹ç•Œæœ‰æºæ±‡ç½‘ç»œæµ</h3>

<p>T å‘ S è¿å®¹é‡æ­£æ— ç©·çš„è¾¹ï¼Œå°†æœ‰æºæ±‡è½¬åŒ–ä¸ºæ— æºæ±‡ã€‚æ¯æ¡è¾¹å®¹é‡å‡å»ä¸‹ç•Œï¼Œè®¾$in[i]$è¡¨ç¤ºæµå…¥ i çš„ä¸‹ç•Œä¹‹å’Œå‡å»æµå‡º i çš„ä¸‹ç•Œä¹‹å’Œã€‚æ–°å»ºè¶…çº§æºæ±‡ SS,TTï¼Œå¯¹äº$in[i]&gt;0$çš„ç‚¹ï¼ŒSS å‘ i è¿å®¹é‡ä¸º$in[i]$çš„è¾¹ã€‚å¯¹äº$in[i]&lt;0$çš„ç‚¹ï¼Œi å‘ TT è¿å®¹é‡ä¸º$âˆ’in[i]$çš„è¾¹ã€‚</p>

<p>æ±‚å‡ºä»¥ SS,TT ä¸ºæºæ±‡çš„æœ€å¤§æµï¼Œå¦‚æœç­‰äº$\sum in<a href="in[i] &gt; 0">i</a>$åˆ™å­˜åœ¨å¯è¡Œæµã€‚å†æ±‚å‡ºä»¥ S,T ä¸ºæºæ±‡çš„æœ€å¤§æµå³ä¸ºæœ€å¤§æµã€‚</p>

<p>è´¹ç”¨æµï¼šå»ºå®Œå›¾åç­‰ä»·äºæ±‚ä»¥ SS,TT ä¸ºæºæ±‡çš„çš„è´¹ç”¨æµã€‚</p>

<p>ä¸Šä¸‹ç•Œè´¹ç”¨æµï¼šå…ˆæŠŠä¸‹ç•Œçš„è´¹ç”¨åŠ å…¥ç­”æ¡ˆã€‚</p>

<h3 id="åˆ¤æ–­è¾¹æ˜¯å¦å±äºæŸä¸€å‰²é›†">åˆ¤æ–­è¾¹æ˜¯å¦å±äºæŸä¸€å‰²é›†</h3>

<p>åœ¨æ®‹ä½™ç½‘ç»œ (è¿˜æœ‰æµé‡çš„è¾¹) ä¸­æ±‚å¼ºè¿é€šåˆ†é‡ï¼Œé¡¶ç‚¹ä¸åœ¨åŒä¸€ SCC ä¸”æ»¡æµçš„è¾¹ã€‚</p>

<p>åˆ¤æ–­è¾¹æ˜¯å¦ä¸ºå…¨éƒ¨æœ€å°å‰²é›†çš„è¾¹ï¼š åœ¨ä¸Šä¸€æ¡çš„åŸºç¡€ä¸Šï¼Œè¿˜è¦æ»¡è¶³èµ·ç‚¹ä¸ S åœ¨åŒä¸€ SCCï¼Œä¸”ç»ˆç‚¹ä¸ T åœ¨åŒä¸€ SCCã€‚</p>

<h3 id="çº¿æ€§è§„åˆ’è½¬è´¹ç”¨æµ">çº¿æ€§è§„åˆ’è½¬è´¹ç”¨æµ</h3>

<p>é¦–å…ˆæ·»åŠ æ¾å¼›å˜é‡ï¼Œå°†ä¸ç­‰å·éƒ½å˜ä¸ºç­‰å·ã€‚åˆ†åˆ«ç”¨ä¸‹ä¸€ä¸ªå¼å­å‡å»ä¸Šä¸€ä¸ªå¼å­ï¼Œå¦‚æœæ¯ä¸ªå˜é‡åªå‡ºç°äº†ä¸¤æ¬¡ä¸”ç¬¦å·ä¸€æ­£ä¸€è´Ÿï¼Œé‚£ä¹ˆå¯ä»¥è½¬åŒ–ä¸ºè´¹ç”¨æµã€‚å¯¹äºæ¯ä¸ªå¼å­å»ºç«‹ä¸€ä¸ªç‚¹ï¼Œé‚£ä¹ˆæ¯ä¸ªå˜é‡å¯¹åº”ä¸€æ¡è¾¹ï¼Œä»ä¸€ä¸ªç‚¹æµå‡ºï¼Œå‘å¦ä¸€ä¸ªç‚¹æµå…¥ã€‚è¿™æ ·ï¼Œå¯¹äºç­‰å¼å³è¾¹çš„å¸¸æ•°ï¼Œå¦‚æœæ˜¯æ­£çš„ï¼Œå¯¹åº”ä»æºç‚¹å‘è¯¥ç‚¹è¿ä¸€æ¡æµé‡ Cï¼Œè´¹ç”¨ 0 çš„è¾¹ï¼›å¦‚æœæ˜¯è´Ÿçš„å¯¹åº”ä»è¯¥ç‚¹å‘æ±‡ç‚¹è¿ä¸€æ¡æµé‡ âˆ’Cï¼Œè´¹ç”¨ 0 çš„è¾¹ã€‚å¯¹äºæ¯ä¸ªå˜é‡ï¼Œä»å®ƒç³»æ•°ä¸ºæ­£çš„å¼å­å‘ç³»æ•°ä¸ºè´Ÿçš„å¼å­è¿ä¸€æ¡å®¹é‡ä¸º infï¼Œè´¹ç”¨ä¸ºå®ƒåœ¨ç›®æ ‡å‡½æ•°é‡Œç³»æ•°çš„è¾¹ã€‚è¿™æ ·ç½‘ç»œæµæ¨¡å‹å°±æ„é€ å®Œæ¯•äº†ã€‚</p>

<h2 id="æ¬§æ‹‰è·¯">æ¬§æ‹‰è·¯</h2>

<p><a href="https://vjudge.net/solution/16970884">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œç»™å®šæ— å­¤ç«‹ç»“ç‚¹å›¾ Gï¼Œè‹¥å­˜åœ¨ä¸€æ¡è·¯ï¼Œç»è¿‡å›¾ä¸­æ¯è¾¹ä¸€æ¬¡ä¸”ä»…ä¸€æ¬¡ï¼Œè¯¥æ¡è·¯ç§°ä¸ºæ¬§æ‹‰è·¯ã€‚</p>

<ul>
  <li>æ— å‘å›¾ï¼šå½“ä»…å½“è¯¥å›¾æ‰€æœ‰é¡¶ç‚¹çš„åº¦æ•°ä¸ºå¶æ•°ï¼ˆæ­¤æ—¶ä¸ºå›è·¯ï¼‰ï¼Œæˆ–é™¤ä¸¤ä¸ªåº¦æ•°ä¸ºå¥‡æ•°å¤–ï¼ˆä½œä¸ºè·¯å¾„çš„èµ·ç‚¹å’Œç»ˆç‚¹ï¼‰ã€å…¶ä½™å…¨ä¸ºå¶æ•°ã€‚</li>
  <li>æœ‰å‘å›¾ï¼šå½“ä»…å½“è¯¥å›¾æ‰€æœ‰é¡¶ç‚¹å‡ºåº¦=å…¥åº¦ï¼ˆæ­¤æ—¶ä¸ºå›è·¯ï¼‰ï¼Œæˆ–ä¸€ä¸ªé¡¶ç‚¹å‡ºåº¦=å…¥åº¦+1ï¼ˆä½œä¸ºèµ·ç‚¹ï¼‰ã€å¦ä¸€ä¸ªé¡¶ç‚¹å…¥åº¦=å‡ºåº¦+1ï¼ˆä½œä¸ºç»ˆç‚¹ï¼‰ã€å…¶ä»–é¡¶ç‚¹å‡ºåº¦=å…¥åº¦ã€‚</li>
</ul>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Fleury</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">,</span> <span class="n">cur</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">Fleury</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="c1">//éå†åŸå›¾çš„åå‘å›¾ï¼Œè¿™é‡ŒåŠ äº†ä¸€ä¸ªâ€œå½“å‰å¼§â€ä¼˜åŒ–</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">i</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>   <span class="c1">//æ— å‘å›¾éœ€è¦åŒæ—¶æ£€æŸ¥åå‘è¾¹æœªè¢«è®¿é—®è¿‡</span>
			<span class="p">{</span>
				<span class="n">vis</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">first</span><span class="p">);</span>
				<span class="n">p</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span> <span class="c1">//æŸ¥è¯¢æ¬§æ‹‰å›è·¯ï¼Œè·¯å¾„ä¸Šè¾¹çš„åºå·æŒ‰é¡ºåºå­˜åœ¨pä¸­</span>
	<span class="p">{</span>
		<span class="n">vis</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cur</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">p</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">i</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="n">dfs</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="æ··åˆå›¾æ¬§æ‹‰å›è·¯åˆ¤å®š">æ··åˆå›¾æ¬§æ‹‰å›è·¯åˆ¤å®š</h3>

<p>é¦–å…ˆç»™æ— å‘è¾¹éšä¾¿å®šä¸€ä¸ªæ–¹å‘ï¼Œè®¾$\deg x$ä¸º x è¿å‡ºå»çš„è¾¹æ•° âˆ’ è¿å…¥ x çš„è¾¹æ•°ã€‚è‹¥å­˜åœ¨$\deg x$ä¸ºå¥‡æ•°ï¼Œæˆ–è€…å›¾ä¸è¿é€šï¼Œåˆ™æ— è§£ã€‚å¦åˆ™å»ºç«‹æºç‚¹ Sï¼Œæ±‡ç‚¹ Tã€‚å¯¹äºä¸€ä¸ªç‚¹ xï¼Œè‹¥$\deg x&gt;0$ï¼Œåˆ™ S å‘ x è¿è¾¹ï¼Œå®¹é‡$\frac{\deg x}{2}$ï¼›è‹¥$\deg x&lt;0$ï¼Œåˆ™ x å‘ T è¿è¾¹ï¼Œå®¹é‡$-\frac{\deg x}{2}$ã€‚ å¯¹äºä¸€æ¡å®šäº†å‘çš„æ— å‘è¾¹$x\to y$ï¼Œx å‘ y è¿è¾¹ï¼Œå®¹é‡ 1ï¼Œæ±‚å‡ºæœ€å¤§æµï¼Œè‹¥ä¸ S å’Œ T è¿çš„æ¯æ¡è¾¹éƒ½æ»¡æµï¼Œåˆ™æœ‰è§£ã€‚</p>

<h2 id="è¿é€šæ€§">è¿é€šæ€§</h2>

<h3 id="æ— å‘å›¾æ±‚å‰²å’ŒåŒè¿é€šåˆ†é‡">æ— å‘å›¾æ±‚å‰²å’ŒåŒè¿é€šåˆ†é‡</h3>

<p><a href="https://vjudge.net/solution/19427352">ä½¿ç”¨ç¤ºä¾‹ 1</a></p>

<p><a href="https://vjudge.net/solution/19427379">ä½¿ç”¨ç¤ºä¾‹ 2</a></p>

<ul>
  <li>å‰²è¾¹ï¼šåœ¨è¿é€šå›¾ä¸­ï¼Œåˆ é™¤äº†è¿é€šå›¾çš„æŸæ¡è¾¹åï¼Œå›¾ä¸å†è¿é€šã€‚è¿™æ ·çš„è¾¹è¢«ç§°ä¸ºå‰²è¾¹ï¼Œä¹Ÿå«åšæ¡¥ã€‚</li>
  <li>å‰²ç‚¹ï¼šåœ¨è¿é€šå›¾ä¸­ï¼Œåˆ é™¤äº†è¿é€šå›¾çš„æŸä¸ªç‚¹ä»¥åŠä¸è¿™ä¸ªç‚¹ç›¸è¿çš„è¾¹åï¼Œå›¾ä¸å†è¿é€šã€‚è¿™æ ·çš„ç‚¹è¢«ç§°ä¸ºå‰²ç‚¹ã€‚æ„é€  dfs æœç´¢æ ‘ï¼Œåœ¨æ ‘ä¸Šæœ‰ä¸¤ç±»èŠ‚ç‚¹å¯ä»¥æˆä¸ºå‰²ç‚¹ï¼š
    <ul>
      <li>å¯¹æ ¹èŠ‚ç‚¹ uï¼Œè‹¥å…¶æœ‰ä¸¤æ£µæˆ–ä¸¤æ£µä»¥ä¸Šçš„å­æ ‘ï¼Œåˆ™è¯¥æ ¹ç»“ç‚¹ u ä¸ºå‰²ç‚¹ï¼›</li>
      <li>å¯¹éæ ¹éå¶èŠ‚ç‚¹ uï¼Œè‹¥å…¶ä¸­çš„æŸæ£µå­æ ‘çš„èŠ‚ç‚¹å‡æ²¡æœ‰æŒ‡å‘ u çš„ç¥–å…ˆèŠ‚ç‚¹çš„å›è¾¹ï¼Œè¯´æ˜åˆ é™¤ u ä¹‹åï¼Œæ ¹ç»“ç‚¹ä¸è¯¥æ£µå­æ ‘çš„èŠ‚ç‚¹ä¸å†è¿é€šï¼›åˆ™èŠ‚ç‚¹ u ä¸ºå‰²ç‚¹ã€‚</li>
    </ul>
  </li>
</ul>

<p>å¯¹äºä¸€ä¸ªæ— å‘å›¾çš„å­å›¾ï¼Œå½“åˆ é™¤å…¶ä¸­ä»»æ„ä¸€æ¡è¾¹åï¼Œä¸æ”¹å˜å›¾å†…ç‚¹çš„è¿é€šæ€§ï¼Œè¿™æ ·çš„å­å›¾å«åšè¾¹çš„åŒè¿é€šå­å›¾ã€‚è€Œå½“å­å›¾çš„è¾¹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œå«åšè¾¹çš„åŒè¿é€šåˆ†é‡ã€‚åŸç†æ˜¯å›¾ä¸­æ‰€æœ‰å‰²è¾¹å†æ±‚ä¸€æ¬¡ SCCï¼Œå¯<strong>ç›´æ¥</strong>ä½¿ç”¨æ±‚ SCC çš„ä»£ç ã€‚</p>

<p>å¯¹äºä¸€ä¸ªæ— å‘å›¾çš„å­å›¾ï¼Œå½“åˆ é™¤å…¶ä¸­ä»»æ„ä¸€ä¸ªç‚¹åï¼Œä¸æ”¹å˜å›¾å†…ç‚¹çš„è¿é€šæ€§ï¼Œè¿™æ ·çš„å­å›¾å«åšç‚¹çš„åŒè¿é€šå­å›¾ã€‚è€Œå½“å­å›¾çš„è¾¹æ•°è¾¾åˆ°æœ€å¤§æ—¶ï¼Œå«åšç‚¹çš„åŒè¿é€šåˆ†é‡ã€‚ä¸‹é¢ç»™å‡ºæ±‚ç‚¹åŒè¿é€šåˆ†é‡çš„ä»£ç ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">BiconnectedConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">bid</span><span class="p">,</span> <span class="n">stak</span><span class="p">,</span> <span class="n">cutPoint</span><span class="p">,</span> <span class="n">cutEdge</span><span class="p">;</span> <span class="c1">//bidè¾¹çš„ç«¯ç‚¹æ‰€å±åŒè¿é€šå—</span>
	<span class="n">BiconnectedConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">bid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">cutPoint</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">cutEdge</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">lowto</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="p">{</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">lowto</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lowto</span> <span class="o">&gt;</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
						<span class="n">cutEdge</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">cutEdge</span><span class="p">[</span><span class="n">k</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">lowto</span> <span class="o">&gt;=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
						<span class="k">for</span> <span class="p">(</span><span class="n">cutPoint</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">||</span> <span class="n">i</span><span class="p">;;)</span>
						<span class="p">{</span>
							<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
							<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
							<span class="n">bid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">bid</span><span class="p">[</span><span class="n">x</span> <span class="o">^</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">k</span><span class="p">)</span>
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
				<span class="p">{</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="åŒè¿é€šå›¾çš„æ„é€ ">åŒè¿é€šå›¾çš„æ„é€ </h4>

<p>å…ˆæ±‚å‡ºæ‰€æœ‰çš„æ¡¥ï¼Œç„¶ååˆ é™¤è¿™äº›æ¡¥è¾¹ï¼Œå‰©ä¸‹çš„æ¯ä¸ªè¿é€šå—éƒ½æ˜¯ä¸€ä¸ªåŒè¿é€šå­å›¾ã€‚æŠŠæ¯ä¸ªåŒè¿é€šå­å›¾æ”¶ç¼©ä¸ºä¸€ä¸ªé¡¶ç‚¹ï¼Œå†æŠŠæ¡¥è¾¹åŠ å›æ¥ï¼Œæœ€åçš„è¿™ä¸ªå›¾ä¸€å®šæ˜¯ä¸€æ£µæ ‘ï¼Œè¾¹è¿é€šåº¦ä¸º 1ã€‚ç»Ÿè®¡å‡ºæ ‘ä¸­åº¦ä¸º 1 çš„èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œå³ä¸ºå¶èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œè®°ä¸º<code class="highlighter-rouge">leaf</code>ã€‚è‡³å°‘åœ¨æ ‘ä¸Šæ·»åŠ <code class="highlighter-rouge">(leaf+1)/2</code>æ¡è¾¹ï¼Œå°±èƒ½ä½¿æ ‘è¾¾åˆ°è¾¹åŒè¿é€šï¼šå…ˆæŠŠä¸¤ä¸ªæœ€è¿‘å…¬å…±ç¥–å…ˆæœ€è¿œçš„ä¸¤ä¸ªå¶èŠ‚ç‚¹ä¹‹é—´è¿æ¥ä¸€æ¡è¾¹ï¼Œè¿™æ ·å¯ä»¥æŠŠè¿™ä¸¤ä¸ªç‚¹åˆ°ç¥–å…ˆçš„è·¯å¾„ä¸Šæ‰€æœ‰ç‚¹æ”¶ç¼©åˆ°ä¸€èµ·ï¼Œå› ä¸ºä¸€ä¸ªå½¢æˆçš„ç¯ä¸€å®šæ˜¯åŒè¿é€šçš„ï¼›ç„¶åå†æ‰¾ä¸¤ä¸ªæœ€è¿‘å…¬å…±ç¥–å…ˆæœ€è¿œçš„ä¸¤ä¸ªå¶èŠ‚ç‚¹ï¼Œè¿™æ ·ä¸€å¯¹ä¸€å¯¹æ‰¾å®Œï¼Œæ°å¥½æ˜¯<code class="highlighter-rouge">(leaf+1)/2</code>æ¬¡ï¼ŒæŠŠæ‰€æœ‰ç‚¹æ”¶ç¼©åˆ°äº†ä¸€èµ·ã€‚</p>

<h3 id="æ— å‘å›¾æ±‚è¾¹åŒè¿é€šåˆ†é‡æœ‰å‘å›¾æ±‚å¼ºè¿é€šåˆ†é‡">æ— å‘å›¾æ±‚è¾¹åŒè¿é€šåˆ†é‡&amp;æœ‰å‘å›¾æ±‚å¼ºè¿é€šåˆ†é‡</h3>

<p><a href="https://vjudge.net/solution/19427182">æ— å‘å›¾æ±‚è¾¹åŒè¿é€šåˆ†é‡</a></p>

<p><a href="https://vjudge.net/solution/19427243">æœ‰å‘å›¾æ±‚å¼ºè¿é€šåˆ†é‡</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">StronglyConnectedComponenet</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">dep</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">stak</span><span class="p">;</span> <span class="c1">//sid=ç‚¹æ‰€å±è¿é€šå—å†…ä¸€ç‚¹</span>
	<span class="n">StronglyConnectedComponenet</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">dep</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">sid</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fa</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">dep</span><span class="p">[</span><span class="n">fa</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="cm">/*, 1*/</span><span class="p">)</span> <span class="c1">//æ±‚å¼ºè¿é€šåˆ†é‡æŠŠæ³¨é‡Šå»æ‰ï¼Œå³å…è®¸èµ°å›è¾¹</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">));</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
					<span class="n">low</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">dep</span><span class="p">[</span><span class="n">to</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="n">dep</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">for</span> <span class="p">(;;)</span>
			<span class="p">{</span>
				<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
				<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
				<span class="n">sid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">u</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">low</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h4 id="2-sat">2-SAT</h4>

<p><a href="https://vjudge.net/solution/23340315">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œn ä¸ªå¸ƒå°”å˜é‡$x_0\ldots x_{n-1}$ï¼Œé€»è¾‘è¡¨è¾¾å¼$Y=(A_0+B_0)(A_1+B_1)\ldots(A_{m-1}+B_{m-1})$ï¼Œå…¶ä¸­$A_i,B_i\in{x_j,\overline{x_j}}$ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨$x_0\ldots x_{n-1}$çš„å–å€¼ä½¿å¾— Y å€¼ä¸º 1ã€‚å› ä¸º$A+B=(\overline A\to B)(\overline B\to A)$ï¼Œæ‰€ä»¥å¯¹äºä¸€ä¸ªè¦æ±‚$A+B$ï¼Œæˆ‘ä»¬è¿$\overline A\to B,\overline B\to A$ä¸¤æ¡è¾¹ã€‚å¦‚æœæœ‰ä¸€æ¡è¾¹$A\to B$ï¼Œæ„å‘³ç€å¦‚æœ A æˆç«‹é‚£ä¹ˆ B å¿…ç„¶æˆç«‹ã€‚è‹¥$\exists i,x_i,\overline{x_i}\in$åŒä¸€ SCCï¼Œåˆ™ä¸å­˜åœ¨ã€‚</p>

<p>æ¨¡æ¿è¦æ±‚é¡¶ç‚¹æ•°<code class="highlighter-rouge">v.size()</code>æ˜¯å¶æ•°ï¼Œ<code class="highlighter-rouge">i</code>ä¸<code class="highlighter-rouge">i ^ 1</code>äº’ä¸ºç›¸åå˜é‡ä¸”å¥‡æ•°ä¸‹æ ‡ä»£è¡¨å¸ƒå°”å˜é‡ä¸ºçœŸçš„æƒ…å†µã€‚æœ€åè¾“å‡ºç»“æœåœ¨<code class="highlighter-rouge">ok</code>ä¸­ã€‚ä¸æ»¡è¶³å¯¹ä»»æ„ i<code class="highlighter-rouge">ok[i] ^ ok[i ^ 1] == 1</code>æ—¶ï¼Œ<code class="highlighter-rouge">ask</code>å‡½æ•°è¿”å›<code class="highlighter-rouge">false</code>ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">TwoSat</span> <span class="o">:</span> <span class="n">StronglyConnectedComponenet</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ok</span><span class="p">;</span>
	<span class="n">TwoSat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">StronglyConnectedComponenet</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">addOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">({</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">}),</span> <span class="n">add</span><span class="p">({</span><span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">});</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXNOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">StronglyConnectedComponenet</span><span class="o">::</span><span class="n">ask</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">g</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ind</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">cf</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">stak</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">cf</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">j</span><span class="p">]].</span><span class="n">second</span><span class="p">]</span> <span class="o">!=</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">g</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">]].</span><span class="n">push_back</span><span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="o">++</span><span class="n">ind</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ok</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="o">!</span><span class="n">stak</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">stak</span><span class="p">.</span><span class="n">back</span><span class="p">();</span>
			<span class="n">stak</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ok</span><span class="p">[</span><span class="n">cf</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!--</span><span class="n">ind</span><span class="p">[</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
					<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ok</span><span class="p">[</span><span class="n">sid</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h5 id="2-sat-æš´åŠ›æœç´¢æ±‚å­—å…¸åºæœ€å°çš„è§£">2-SAT æš´åŠ›æœç´¢æ±‚å­—å…¸åºæœ€å°çš„è§£</h5>

<p><a href="https://vjudge.net/solution/23340324">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œæ—¶é—´å¤æ‚åº¦æœ€åä¸ºä¸º$O(VE)$ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">TwoSat</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">ok</span><span class="p">;</span>
	<span class="n">TwoSat</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">addOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">add</span><span class="p">({</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">}),</span> <span class="n">add</span><span class="p">({</span><span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">});</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">void</span> <span class="n">addXNOR</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">^</span> <span class="mi">1</span><span class="p">),</span> <span class="n">addOR</span><span class="p">(</span><span class="n">a</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">stak</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">ok</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">stak</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">ok</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">ok</span><span class="p">[</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">stak</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">stak</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
						<span class="n">ok</span><span class="p">[</span><span class="n">stak</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dfs</span><span class="p">(</span><span class="n">i</span> <span class="o">^</span> <span class="mi">1</span><span class="p">,</span> <span class="n">stak</span><span class="p">))</span>
						<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="äºŒåˆ†å›¾">äºŒåˆ†å›¾</h2>

<p>äºŒåˆ†å›¾çš„ä¸€ä¸ªç­‰ä»·å®šä¹‰æ˜¯ï¼šä¸å«æœ‰å«å¥‡æ•°æ¡è¾¹çš„ç¯çš„å›¾ã€‚</p>

<p>å®Œç¾åŒ¹é…å›¾ä¸­æ‰€æœ‰çš„é¡¶ç‚¹éƒ½æ˜¯åŒ¹é…ç‚¹ã€‚</p>

<p>äºŒåˆ†å›¾çš„æœ€å°ç‚¹è¦†ç›–ï¼ˆæœ€å°å‰²ï¼‰æ˜¯æŒ‡æœ€å°‘çš„é¡¶ç‚¹æ•°ä½¿å¾—äºŒåˆ†å›¾ G ä¸­çš„æ¯æ¡è¾¹éƒ½è‡³å°‘ä¸å…¶ä¸­ä¸€ä¸ªç‚¹ç›¸å…³è”ã€‚äºŒåˆ†å›¾ä¸­ï¼Œæœ€å°å‰²=æœ€å¤§åŒ¹é…ã€‚</p>

<p>äºŒåˆ†å›¾çš„æœ€å°è¾¹è¦†ç›–ï¼ˆæœ€å¤§ç‹¬ç«‹é›†ï¼‰æ˜¯æŒ‡ç”¨å°½é‡å°‘çš„ä¸ç›¸äº¤ç®€å•è·¯å¾„è¦†ç›–äºŒåˆ†å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ã€‚äºŒåˆ†å›¾ä¸­ï¼Œæœ€å°ç‚¹è¦†ç›–+æœ€å°è¾¹è¦†ç›–=æ€»ç‚¹æ•°ã€‚</p>

<p>Hall å®šç†ï¼šäºŒåˆ†å›¾ä¸­çš„ä¸¤éƒ¨åˆ†é¡¶ç‚¹ç»„æˆçš„é›†åˆåˆ†åˆ«ä¸º X,Y ï¼Œåˆ™æœ‰ä¸€ç»„æ— å…¬å…±ç‚¹çš„è¾¹ï¼Œä¸€ç«¯æ°å¥½ä¸ºç»„æˆ X çš„ç‚¹çš„å……åˆ†å¿…è¦æ¡ä»¶æ˜¯ï¼šX ä¸­çš„ä»»æ„ k ä¸ªç‚¹è‡³å°‘ä¸ Y ä¸­çš„ k ä¸ªç‚¹ç›¸é‚»ã€‚å¯¹äºåŒºé—´å›¾åªéœ€è¦è€ƒè™‘æç«¯æƒ…å†µï¼Œçº¿æ®µæ ‘ç»´æŠ¤ã€‚</p>

<p>å…³é”®ç‚¹ï¼šä¸€å®šåœ¨æœ€å¤§åŒ¹é…ä¸­çš„ç‚¹ã€‚ æ±‚å‡ºä»»æ„ä¸€ä¸ªæœ€å¤§åŒ¹é…ï¼Œé‚£ä¹ˆåªéœ€è¦è€ƒè™‘å“ªäº›åŒ¹é…ç‚¹ä¸ä¸€å®šåœ¨ã€‚ å‡è®¾æ˜¯è€ƒè™‘å·¦ä¾§çš„ç‚¹ï¼Œå³ä¾§ç±»ä¼¼ï¼š å°†åŒ¹é…è¾¹ä»å³å¾€å·¦ï¼ŒéåŒ¹é…è¾¹ä»å·¦åˆ°å³ï¼Œä»å·¦ä¾§æ¯ä¸ªæœªåŒ¹é…ç‚¹å¼€å§‹ DFS åˆ°çš„åŒ¹é…ç‚¹éƒ½ä¸æ˜¯å…³é”®ç‚¹ã€‚</p>

<p>å…³é”®è¾¹ï¼šæ±‚å‡ºä»»æ„ä¸€ä¸ªæœ€å¤§åŒ¹é…ï¼Œå°†åŒ¹é…è¾¹ä»å³åˆ°å·¦ï¼Œå‰©ä½™è¾¹ä»å·¦åˆ°å³ï¼Œæ±‚å‡º SCCã€‚ å¯¹äºä¸€æ¡è¾¹ï¼šè‹¥å®ƒä½äºå½“å‰åŒ¹é…ä¸­ï¼Œé‚£ä¹ˆè‹¥ä¸¤ç«¯ç‚¹ä½äºåŒä¸€ SCCï¼Œåˆ™æ˜¯å¯èƒ½åœ¨ï¼Œå¦åˆ™å¿…å®šåœ¨ï¼›è‹¥å®ƒä¸ä½äºå½“å‰åŒ¹é…ä¸­ï¼Œé‚£ä¹ˆè‹¥ä¸¤ç«¯ç‚¹ä½äºåŒä¸€ SCCï¼Œåˆ™æ˜¯å¯èƒ½åœ¨ï¼Œå¦åˆ™å¿…å®šä¸åœ¨ã€‚</p>

<h3 id="hungary-æ±‚æœ€å¤§åŒ¹é…">Hungary æ±‚æœ€å¤§åŒ¹é…</h3>

<p><a href="https://vjudge.net/solution/21880920">ä½¿ç”¨ç¤ºä¾‹</a></p>

<p>å·¦è¾¹ nl ä¸ªç‚¹$0\ldots nl-1$ï¼Œå³è¾¹ nr ä¸ªç‚¹$0\ldots nr-1$ï¼Œå–<code class="highlighter-rouge">n=max(nl,nr)</code>ï¼Œå·¦ i å³ j é—´ç›¸è¿åˆ™<code class="highlighter-rouge">g[i].push_back(j);</code>ã€‚</p>

<p>ç”Ÿæˆ<code class="highlighter-rouge">fl[i]</code>è¡¨ç¤ºå·¦è¾¹ç¬¬ i ä¸ªåŒ¹é…å³è¾¹ç¬¬<code class="highlighter-rouge">fl[i]</code>ä¸ªï¼Œ<code class="highlighter-rouge">fr</code>åŒç†ã€‚æ—¶é—´å¤æ‚åº¦$O(n^3)$ã€‚æœªåŒ¹é…çš„å€¼ä¸º<code class="highlighter-rouge">fl[i] == N</code>ã€‚åŒ¹é…æ˜¯ä¸€ä¸ªè¾¹é›†ï¼Œå…¶ä¸­ä»»æ„ä¸¤æ¡è¾¹éƒ½æ²¡æœ‰å…¬å…±é¡¶ç‚¹ï¼›æ‰«ä¸€é<code class="highlighter-rouge">fl</code>æˆ–<code class="highlighter-rouge">fr</code>åˆ¤æ–­æœ‰å¤šå°‘ä¸ç­‰äº<code class="highlighter-rouge">N</code>å³ä¸ºæœ€å¤§åŒ¹é…æ•°ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Hungary</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vr</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">rt</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span> <span class="o">||</span> <span class="n">dfs</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">rt</span><span class="p">))</span>
					<span class="k">return</span> <span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">vr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
				<span class="n">dfs</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span> <span class="c1">//æ‰¾å®Œå…¨åŒ¹é…æ—¶å¦‚æœè¿”å›å€¼ä¸º0å¯ç›´æ¥return</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="hopcroftkarp-æ±‚æœ€å¤§åŒ¹é…">HopcroftKarp æ±‚æœ€å¤§åŒ¹é…</h3>

<p><a href="https://vjudge.net/solution/21880796">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œæ—¶é—´å¤æ‚åº¦$O(\sqrt{\vert V\vert }\vert E\vert )$ï¼Œç¨€ç–å›¾ä¸Šæ•ˆæœæ˜æ˜¾ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">HopcroftKarp</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">g</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">bool</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span> <span class="o">||</span> <span class="n">dfs</span><span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]))</span>
					<span class="k">return</span> <span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">fl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">ok</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="n">fill</span><span class="p">(</span><span class="n">hl</span><span class="p">,</span> <span class="n">hl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">hr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ql</span> <span class="o">=</span> <span class="n">qr</span> <span class="o">=</span> <span class="n">ok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">while</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">y</span> <span class="o">:</span> <span class="n">g</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span><span class="o">++</span><span class="p">]])</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
							<span class="n">ok</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hl</span><span class="p">[</span><span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
							<span class="n">hl</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">fr</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hr</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ok</span><span class="p">)</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">x</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">==</span> <span class="n">N</span><span class="p">)</span>
					<span class="n">dfs</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="kuhnmunkres-æ±‚æœ€ä¼˜å®Œå¤‡åŒ¹é…">KuhnMunkres æ±‚æœ€ä¼˜å®Œå¤‡åŒ¹é…</h3>

<p><a href="https://vjudge.net/solution/21880965">ä½¿ç”¨ç¤ºä¾‹</a>ã€‚</p>

<p>å·¦ x å³ y ä»£ä»·<code class="highlighter-rouge">a[x][y]</code>ã€‚æœ€å¤§è´¹ç”¨æµæ—¶ï¼Œa åˆå§‹åŒ– 0ï¼›æœ€å¤§è´¹ç”¨æœ€å¤§æµæ—¶ï¼Œa åˆå§‹åŒ–<code class="highlighter-rouge">-N*INF</code>ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">KuhnMunkres</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span> <span class="n">hl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">hr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">slk</span><span class="p">[</span><span class="n">N</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">fr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vl</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">vr</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">pre</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">N</span><span class="p">],</span> <span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">check</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">N</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">vr</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">qr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">N</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fr</span><span class="p">[</span><span class="n">fl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]]);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">bfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">s</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">slk</span><span class="p">,</span> <span class="n">slk</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">INF</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vl</span><span class="p">,</span> <span class="n">vl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">vr</span><span class="p">,</span> <span class="n">vr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="n">ql</span> <span class="o">=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">qr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;;)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">d</span><span class="p">;</span> <span class="n">ql</span> <span class="o">&lt;</span> <span class="n">qr</span><span class="p">;)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">ql</span><span class="o">++</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">d</span> <span class="o">=</span> <span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">hr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]))</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
							<span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
						<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
							<span class="k">return</span><span class="p">;</span>
			<span class="n">ll</span> <span class="n">d</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">d</span> <span class="o">=</span> <span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">d</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">vr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">hr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">slk</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
					<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">fill</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">fl</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="n">fr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">fill</span><span class="p">(</span><span class="n">hr</span><span class="p">,</span> <span class="n">hr</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">hl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">max_element</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
			<span class="n">bfs</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="å¸¦èŠ±æ ‘">å¸¦èŠ±æ ‘</h2>

<h3 id="ä¸€èˆ¬å›¾æœ€å¤§åŒ¹é…">ä¸€èˆ¬å›¾æœ€å¤§åŒ¹é…</h3>

<p><a href="http://uoj.ac/submission/342734">ä½¿ç”¨ç¤ºä¾‹</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Blossom</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">Blossom</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">f</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">vis</span><span class="p">.</span><span class="n">back</span><span class="p">();</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">s</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
			<span class="p">{</span>
				<span class="n">UnionfindSet</span> <span class="n">ufs</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
				<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pre</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">flag</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">2</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">deque</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">q</span><span class="p">.</span><span class="n">pop_front</span><span class="p">())</span>
					<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]].</span><span class="n">second</span><span class="p">,</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
						<span class="p">{</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
							<span class="p">{</span>
								<span class="k">for</span> <span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="o">++</span><span class="n">cnt</span><span class="p">;;</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
									<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
									<span class="p">{</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span> <span class="o">=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span> <span class="o">==</span> <span class="n">cnt</span><span class="p">)</span>
											<span class="k">break</span><span class="p">;</span>
										<span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="n">pre</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span> <span class="o">:</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
									<span class="p">}</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
									<span class="n">pre</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
									<span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
								<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">},</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
									<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">a</span><span class="p">;</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
									<span class="p">{</span>
										<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">x</span><span class="p">]])</span> <span class="o">!=</span> <span class="n">a</span><span class="p">)</span>
											<span class="n">pre</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
										<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>
											<span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
										<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">[</span><span class="n">z</span><span class="p">])</span>
											<span class="n">flag</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
									<span class="p">}</span>
							<span class="p">}</span>
							<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
								<span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">flag</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]);</span>
							<span class="k">else</span>
							<span class="p">{</span>
								<span class="k">for</span> <span class="p">(</span><span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span> <span class="n">y</span> <span class="o">!=</span> <span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">();)</span>
									<span class="n">swap</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">f</span><span class="p">[</span><span class="n">f</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">y</span><span class="p">]]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span>
			<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="æ ‘å½¢å›¾">æ ‘å½¢å›¾</h2>

<h3 id="æœ€å°ç”Ÿæˆæ ‘">æœ€å°ç”Ÿæˆæ ‘</h3>

<h4 id="æ— å‘å›¾">æ— å‘å›¾</h4>

<p>åŒæ—¶ç»™å‡º Prim ç®—æ³•ï¼ˆç”Ÿæˆæ–°æ ‘ï¼‰ã€Kruskal ç®—æ³•ï¼ˆæ¶ˆè€—å°ï¼‰ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Prim</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">DisGreater</span>
	<span class="p">{</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Edge</span> <span class="o">&amp;</span><span class="n">e2</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">return</span> <span class="n">e1</span><span class="p">.</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">};</span>
	<span class="n">ll</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Edge</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DisGreater</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
	<span class="n">Prim</span><span class="p">(</span><span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="o">:</span> <span class="n">Tree</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ans</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//ç”Ÿæˆæ–°æ ‘ï¼Œæ¯æ¡è¾¹éƒ½è¦æœ‰ç­‰é•¿åå‘è¾¹</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span> <span class="o">!</span><span class="n">q</span><span class="p">.</span><span class="n">empty</span><span class="p">();)</span>
		<span class="p">{</span>
			<span class="n">Edge</span> <span class="n">ed</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">pop</span><span class="p">(),</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">])</span>
				<span class="n">insert</span><span class="p">(</span><span class="n">ed</span><span class="p">.</span><span class="n">second</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">ed</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="n">add</span><span class="p">(</span><span class="n">ed</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">insert</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span> <span class="c1">//æŠŠç‚¹å’Œå¯¹åº”çš„ç›¸è¿çš„è¾¹åŠ å…¥é›†åˆ</span>
	<span class="p">{</span>
		<span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">])</span>
				<span class="n">q</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="n">ll</span> <span class="nf">kruskal</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//ä¼šæ¸…ç©ºè¾¹é›†eï¼Œæ¯æ¡è¾¹è¢«è®¤ä½œæ— å‘è¾¹</span>
<span class="p">{</span>
	<span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">UnionFindSet</span> <span class="n">ufs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sort</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">e</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">DisGreater</span><span class="p">());</span> <span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span> <span class="n">e</span><span class="p">.</span><span class="n">pop_back</span><span class="p">())</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">from</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ufs</span><span class="p">.</span><span class="n">fa</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">to</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">ufs</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">from</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">to</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">+=</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">().</span><span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="k">return</span> <span class="cm">/*ufs.siz&gt;1?INF:*/</span> <span class="n">ret</span><span class="p">;</span> <span class="c1">//è§†æƒ…å†µé€‰æ‹©å»æ³¨é‡Š</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="æœ‰å‘å›¾">æœ‰å‘å›¾</h4>

<p><a href="https://vjudge.net/solution/16971789">ä½¿ç”¨ç¤ºä¾‹</a></p>

<p>æŒ‡å®šä»¥ root ä¸ºæ ¹ï¼Œå¦‚æœæ²¡æœ‰é™å®šæ ¹é‚£ä¹ˆæ–°å»ºä¸€ä¸ªè™šæ‹Ÿç‚¹ä½œä¸ºæ ¹ï¼Œå‘æ‰€æœ‰è¾¹è¿è¾¹é•¿<strong>æœ€å¤§è¾¹é•¿+1</strong>çš„è¾¹ï¼Œåœ¨æœ€åç”Ÿæˆçš„å›¾ä¸­å»æ‰æ­¤è¾¹ã€‚æ—¶é—´å¤æ‚åº¦$O(VE)$ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ll</span> <span class="nf">zhuLiu</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Edge</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="c1">//ä¸å­˜åœ¨è¿”å›INF</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;;)</span>
	<span class="p">{</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span> <span class="n">in</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">INF</span><span class="p">);</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">pre</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">==</span> <span class="p">(</span><span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">))</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="o">--</span><span class="p">],</span> <span class="n">e</span><span class="p">.</span><span class="n">back</span><span class="p">()),</span> <span class="n">e</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">)</span>
				<span class="n">in</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">pre</span><span class="p">[</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">in</span> <span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">INF</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">INF</span><span class="p">;</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">id</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">tn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ret</span> <span class="o">+=</span> <span class="n">in</span> <span class="p">[</span><span class="n">v</span> <span class="o">=</span> <span class="n">i</span><span class="p">];</span> <span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">!=</span> <span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">v</span> <span class="o">!=</span> <span class="n">root</span><span class="p">;</span> <span class="n">v</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
				<span class="n">vis</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">!=</span> <span class="n">root</span> <span class="o">&amp;&amp;</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">v</span><span class="p">];</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">v</span><span class="p">;</span> <span class="n">u</span> <span class="o">=</span> <span class="n">pre</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
					<span class="n">id</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="p">;</span>
				<span class="n">id</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tn</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>
				<span class="n">id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tn</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">e</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">first</span><span class="p">])</span> <span class="o">!=</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">v</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">second</span><span class="p">]))</span>
				<span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span> <span class="o">-=</span> <span class="n">in</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">tn</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="n">id</span><span class="p">[</span><span class="n">root</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æ ‘é“¾å‰–åˆ†ä¸-lca">æ ‘é“¾å‰–åˆ†ä¸ LCA</h3>

<p><a href="https://vjudge.net/solution/16971586">ä½¿ç”¨ç¤ºä¾‹</a></p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">Diagram</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="n">Fenwick</span> <span class="n">data</span><span class="p">;</span> <span class="c1">//æš‚ç”¨æ ‘çŠ¶æ•°ç»„ä½œä¸ºé»˜è®¤æ•°æ®ç»“æ„</span>
	<span class="n">Diagram</span><span class="p">(</span><span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">,</span> <span class="kt">int</span> <span class="n">root</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">data</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
	<span class="p">{</span>
		<span class="n">build</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">dfn</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">dep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">dfs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">root</span><span class="p">].</span><span class="n">top</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">build</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="k">const</span> <span class="n">Graph</span> <span class="o">&amp;</span><span class="n">g</span><span class="p">)</span> <span class="c1">//æ— å‘å›¾dfså»ºæ ‘ï¼Œä¸”é‡è¾¹åœ¨æœ€å‰ï¼Œuä¸ºæ ¹èŠ‚ç‚¹</span>
	<span class="p">{</span>
		<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">siz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">)</span> <span class="c1">//æ²¡è®¿é—®è¿‡çš„ç‚¹sizé»˜è®¤0</span>
			<span class="p">{</span>
				<span class="n">build</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">g</span><span class="p">);</span>
				<span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">siz</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">;</span>
				<span class="n">Graph</span><span class="o">::</span><span class="n">add</span><span class="p">(</span><span class="n">g</span><span class="p">.</span><span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">(</span><span class="n">u</span><span class="p">)].</span><span class="n">siz</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">siz</span><span class="p">)</span> <span class="c1">//é‡è¾¹ç§»åˆ°æœ€å‰</span>
					<span class="n">swap</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">front</span><span class="p">(),</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
			<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span> <span class="o">=</span> <span class="n">ch</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">i</span><span class="p">)].</span><span class="n">dfn</span> <span class="o">=</span> <span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">top</span> <span class="o">=</span> <span class="n">i</span> <span class="o">?</span> <span class="n">to</span> <span class="o">:</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">top</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">to</span><span class="p">].</span><span class="n">dep</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">dep</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">cnt</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">lca</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">y</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">data</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">data</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">ll</span> <span class="n">pv</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span> <span class="o">!=</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fa</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
				<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
			<span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">top</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dep</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dep</span><span class="p">)</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">data</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">y</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">dfn</span><span class="p">,</span> <span class="n">pv</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>

<h3 id="ç‚¹å‰–ç‚¹åˆ†æ²»">ç‚¹å‰–ï¼ˆç‚¹åˆ†æ²»ï¼‰</h3>

<p><a href="https://vjudge.net/solution/16971666">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œé›¶å·ç‚¹ä¸ºè™šèŠ‚ç‚¹ã€‚</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="nc">TreeDiv</span> <span class="o">:</span> <span class="n">Graph</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">root</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">mx</span><span class="p">,</span> <span class="n">siz</span><span class="p">,</span> <span class="n">vis</span><span class="p">;</span>
	<span class="n">TreeDiv</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">Graph</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">mx</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">siz</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">vis</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
	<span class="kt">void</span> <span class="n">dfsRoot</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dfsRoot</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
					<span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="o">++</span><span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">siz</span><span class="p">[</span><span class="n">u</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mx</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">mx</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
			<span class="n">root</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfsDis</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fa</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="c1">//ç”¨dæ›´æ–°ç­”æ¡ˆ</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fa</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">dfsDis</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="kt">int</span> <span class="n">cal</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">ll</span> <span class="n">d</span><span class="p">)</span> <span class="c1">//è¿”å›ç¬¦åˆè¦æ±‚çš„ç‚¹å¯¹æ•°</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">dfsDis</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="cm">/*å¾—åˆ°ç­”æ¡ˆ*/</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">dfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">u</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dfsRoot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ans</span> <span class="o">+=</span> <span class="n">cal</span><span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="n">root</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">vis</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">u</span><span class="p">].</span><span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">to</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">second</span><span class="p">,</span> <span class="o">!</span><span class="n">vis</span><span class="p">[</span><span class="n">to</span><span class="p">])</span>
				<span class="n">ans</span> <span class="o">-=</span> <span class="n">cal</span><span class="p">(</span><span class="n">to</span><span class="p">,</span> <span class="n">e</span><span class="p">[</span><span class="n">k</span><span class="p">].</span><span class="n">len</span><span class="p">),</span> <span class="n">mx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">siz</span><span class="p">[</span><span class="n">to</span><span class="p">],</span> <span class="n">dfs</span><span class="p">(</span><span class="n">to</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
:ET