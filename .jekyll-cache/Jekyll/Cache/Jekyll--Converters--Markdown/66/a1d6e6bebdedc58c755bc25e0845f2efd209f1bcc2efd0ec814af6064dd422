I"¿<p>è·Ÿç€<a href="https://blog.csdn.net/lwt36/article/details/48908031">è¿™ç¯‡åšå®¢</a>å¤ä¹ æ‰«æçº¿+çº¿æ®µæ ‘â€¦</p>

<h2 id="atlantis">Atlantis</h2>

<p><a href="https://vjudge.net/problem/HDU-1542">é¢˜ç›®é“¾æ¥</a></p>

<p>æ±‚çŸ©å½¢å¹¶ï¼Œå³å¹³é¢ä¸Šè‡³å°‘è¢«ä¸€ä¸ªçŸ©å½¢è¦†ç›–çš„é¢ç§¯ã€‚</p>

<blockquote>
  <p>ç¦»æ•£åŒ–: è¿™äº›æŠ€å·§éƒ½æ˜¯è€ç”Ÿå¸¸è°ˆçš„äº†ï¼Œä¸ç„¶æµ®ç‚¹æ•°æ€ä¹ˆå»ºæ ‘ï¼Œç¦»æ•£åŒ– x åæ ‡å°±å¯ä»¥äº†ã€‚</p>

  <p>æ‰«æçº¿: é¦–å…ˆæŠŠçŸ©å½¢æŒ‰ y è½´åˆ†æˆä¸¤æ¡è¾¹ï¼Œä¸Šè¾¹å’Œä¸‹è¾¹ï¼Œå¯¹ x è½´å»ºæ ‘ï¼Œæ‰«æçº¿å¯ä»¥çœ‹æˆä¸€æ ¹å¹³è¡Œäº x è½´çš„ç›´çº¿ã€‚ä» y=0 å¼€å§‹å¾€ä¸Šæ‰«ï¼Œä¸‹è¾¹è¡¨ç¤ºè¦è®¡ç®—é¢ç§¯+1ï¼Œä¸Šè¾¹è¡¨ç¤ºå·²ç»æ‰«è¿‡äº† âˆ’1ï¼Œç›´åˆ°æ‰«åˆ°æœ€åä¸€æ¡å¹³è¡Œäº xx è½´çš„è¾¹ä½†æ˜¯çœŸæ­£åœ¨åšçš„æ—¶å€™ï¼Œä¸éœ€è¦å®Œå…¨æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œä¸€æ¡ä¸€æ¡è¾¹åœ°æ’å…¥çº¿æ®µæ ‘å°±å¥½äº†ã€‚</p>

  <p>çº¿æ®µæ ‘: ç”¨äºåŠ¨æ€ç»´æŠ¤æ‰«æçº¿åœ¨å¾€ä¸Šèµ°æ—¶ï¼Œx è½´å“ªäº›åŒºåŸŸæ˜¯æœ‰åˆæ³•é¢ç§¯çš„ã€‚è¿™ç§çº¿æ®µæ ‘æ˜¯ä¸ç”¨æ‡’æ ‡è®°çš„ï¼Œå› ä¸ºæ²¡æœ‰æŸ¥è¯¢æ“ä½œ</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">double</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Ranker</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span> <span class="n">sort</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">()),</span> <span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">())</span> <span class="o">-</span> <span class="n">begin</span><span class="p">());</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">begin</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">AreaUnion</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Seg</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">f</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Seg</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">h</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="nc">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">sum</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Seg</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Ranker</span> <span class="n">rk</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">});</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">qr</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">qr</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">?</span> <span class="n">rk</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rk</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">:</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">?</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">v</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Node</span><span class="p">());</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">),</span> <span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">h</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">h</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">kase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span> <span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">n</span><span class="p">;)</span>
	<span class="p">{</span>
		<span class="n">AreaUnion</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%lf%lf%lf%lf"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
			<span class="n">a</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Test case #%d</span><span class="se">\n</span><span class="s">Total explored area: %.2lf</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="o">++</span><span class="n">kase</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">ask</span><span class="p">());</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="è¦†ç›–çš„é¢ç§¯">è¦†ç›–çš„é¢ç§¯</h2>

<p><a href="https://vjudge.net/problem/HDU-1255">é¢˜ç›®é“¾æ¥</a></p>

<p>æ±‚çŸ©å½¢äº¤ï¼Œå³å¹³é¢ä¸Šè‡³å°‘è¢«è¦†ç›–ä¸¤æ¬¡çš„é¢ç§¯ã€‚çº¿æ®µæ ‘ä¸Šç»´æŠ¤è¢«è¦†ç›–ä¸€æ¬¡çš„é•¿åº¦å’Œè¢«è¦†ç›–ä¸¤æ¬¡çš„é•¿åº¦ã€‚</p>

<blockquote>
  <p>å‰é¢çš„ä¸çŸ©å½¢é¢ç§¯å¹¶ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯è¦è€ƒè™‘è‡³å°‘è¦†ç›–ä¸€æ¬¡ one å’Œè‡³å°‘è¦†ç›–ä¸¤æ¬¡ two çš„æ›´æ–°ã€‚</p>

  <p>å°¤å…¶æ˜¯å½“å‰è¢«è¦†ç›–äº†ä¸€æ¬¡çš„æ—¶å€™ï¼Œç”±äºæ²¡æœ‰ down æ“ä½œï¼Œçˆ¶äº²èŠ‚ç‚¹çš„ä¿¡æ¯æ˜¯æ²¡æœ‰åŒæ­¥åˆ°å„¿å­èŠ‚ç‚¹çš„ï¼Œè¿™æ ·çš„è¯ up å°±è¦è€ƒè™‘äº†ã€‚</p>

  <p>çˆ¶äº²è¢«è®°å½•è¦†ç›–äº†ä¸€æ¬¡ï¼Œä½†æ˜¯å¦‚æœå„¿å­è¢«è¦†ç›–è¿‡ï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯åœ¨è¿™ä¸ªçˆ¶äº²è¿™ä¸ªå¤§åŒºé—´ä¸Šçš„ï¼Œå°±ç›¸å½“äºçˆ¶äº²åŒºé—´è¢«è¦†ç›–äº†è‡³å°‘ä¸¤æ¬¡ï¼Œæ‰€ä»¥ two å’Œ one éƒ½è¦æ›´æ–°ã€‚</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">double</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Ranker</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span> <span class="n">sort</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">()),</span> <span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">())</span> <span class="o">-</span> <span class="n">begin</span><span class="p">());</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">begin</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">AreaIntersection</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Seg</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">f</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Seg</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">h</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="nc">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">one</span><span class="p">,</span> <span class="n">two</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Seg</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Ranker</span> <span class="n">rk</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">});</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">qr</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">qr</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">one</span> <span class="o">=</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">r</span> <span class="o">?</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">one</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">one</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">two</span> <span class="o">=</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">r</span> <span class="o">?</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">two</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">two</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">one</span> <span class="o">=</span> <span class="n">rk</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rk</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">two</span> <span class="o">=</span> <span class="n">rk</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rk</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
			<span class="k">else</span>
				<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">two</span> <span class="o">=</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">r</span> <span class="o">?</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">one</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">one</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">v</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Node</span><span class="p">());</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">),</span> <span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">two</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">h</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">h</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span> <span class="n">t</span><span class="o">--</span><span class="p">;)</span>
	<span class="p">{</span>
		<span class="n">AreaIntersection</span> <span class="n">a</span><span class="p">;</span>
		<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="n">n</span><span class="o">--</span><span class="p">;)</span>
		<span class="p">{</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%lf%lf%lf%lf"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
			<span class="n">a</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"%.2lf</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">ask</span><span class="p">());</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="picture">Picture</h2>

<p><a href="https://vjudge.net/problem/HDU-1828">é¢˜ç›®é“¾æ¥</a></p>

<p>æ±‚çŸ©å½¢å‘¨é•¿å¹¶ã€‚</p>

<h3 id="è§£æ³•ä¸€">è§£æ³•ä¸€</h3>

<blockquote>
  <p>å¯ä»¥ç”¨ç±»ä¼¼çŸ©å½¢é¢ç§¯å¹¶çš„åŠæ³•ï¼Œä¸è¿‡è¿™æ¬¡æˆ‘ä»¬ï¼Œä¸ç®—é¢ç§¯ç½¢äº†ã€‚</p>

  <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå‘¨é•¿çš„çº¿ä¼šè¢«é‡å¤è¦†ç›–ï¼Œæ¯æ¬¡éœ€è¦å’Œä¸Šä¸€æ¬¡çš„ä½œå·®ã€‚</p>

  <p>ä½†æ˜¯è¿™æ ·ä»…ä»…æ˜¯ x è½´çš„ï¼Œä¸è¿‡å¯ä»¥å†å¯¹ y è½´åšä¸€æ¬¡åŠ èµ·æ¥å°±å¯ä»¥äº†ã€‚</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Ranker</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span> <span class="n">sort</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">()),</span> <span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">())</span> <span class="o">-</span> <span class="n">begin</span><span class="p">());</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">begin</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">HalfPerimeter</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Seg</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">f</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Seg</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">h</span> <span class="o">!=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">h</span> <span class="o">?</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">h</span> <span class="o">:</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">f</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="nc">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">sum</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Seg</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Ranker</span> <span class="n">rk</span><span class="p">;</span>
	<span class="n">ll</span> <span class="n">add</span><span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">});</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">L</span><span class="p">,</span> <span class="kt">int</span> <span class="n">R</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">L</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">R</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">L</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">R</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">?</span> <span class="n">rk</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rk</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">:</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">r</span> <span class="o">?</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">v</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Node</span><span class="p">());</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">last</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">),</span> <span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">-</span> <span class="n">last</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">;</span> <span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);)</span>
	<span class="p">{</span>
		<span class="n">HalfPerimeter</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d%d%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
			<span class="n">x</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
			<span class="n">y</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">ask</span><span class="p">()</span> <span class="o">+</span> <span class="n">y</span><span class="p">.</span><span class="n">ask</span><span class="p">());</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="è§£æ³•äºŒ">è§£æ³•äºŒ</h3>

<blockquote>
  <p>ä¹Ÿå¯ä»¥åªå¯¹ x è½´åšä¸€æ¬¡æ‰«æçº¿ï¼Œåªè¦åŒæ—¶ç»´æŠ¤ y è½´ç«–çº¿ï¼ˆå°±æ˜¯æ±‚çŸ©å½¢é¢ç§¯å¹¶çš„æ—¶å€™çš„é«˜ï¼‰çš„ä¸ªæ•° vtlã€‚</p>

  <p>éœ€è¦çš„æ³¨æ„çš„æ˜¯ç«–çº¿é‡åˆçš„æƒ…å†µï¼Œéœ€è¦å†å¼€å˜é‡ lbdã€rbd æ¥åˆ¤æ–­é‡åˆï¼Œé¿å…é‡å¤è®¡ç®—ã€‚</p>
</blockquote>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;bits/stdc++.h&gt;
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">struct</span> <span class="nc">Ranker</span> <span class="o">:</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">ll</span><span class="o">&gt;</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">init</span><span class="p">()</span> <span class="p">{</span> <span class="n">sort</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">()),</span> <span class="n">resize</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">())</span> <span class="o">-</span> <span class="n">begin</span><span class="p">());</span> <span class="p">}</span>
	<span class="kt">int</span> <span class="n">ask</span><span class="p">(</span><span class="n">ll</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">lower_bound</span><span class="p">(</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span><span class="p">(),</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">begin</span><span class="p">();</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">Perimeter</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Seg</span>
	<span class="p">{</span>
		<span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">f</span><span class="p">;</span>
		<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Seg</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="p">.</span><span class="n">h</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="nc">Node</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>
		<span class="n">ll</span> <span class="n">sum</span><span class="p">,</span> <span class="n">vtl</span><span class="p">,</span> <span class="n">lbd</span><span class="p">,</span> <span class="n">rbd</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Seg</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Ranker</span> <span class="n">rk</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">add</span><span class="p">(</span><span class="n">ll</span> <span class="n">l</span><span class="p">,</span> <span class="n">ll</span> <span class="n">b</span><span class="p">,</span> <span class="n">ll</span> <span class="n">r</span><span class="p">,</span> <span class="n">ll</span> <span class="n">t</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">l</span><span class="p">);</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">});</span>
		<span class="n">s</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">});</span>
	<span class="p">}</span>
	<span class="kt">void</span> <span class="n">upd</span><span class="p">(</span><span class="kt">int</span> <span class="n">ql</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rt</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">qr</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span> <span class="o">+=</span> <span class="n">c</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">m</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ql</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">qr</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
				<span class="n">upd</span><span class="p">(</span><span class="n">ql</span><span class="p">,</span> <span class="n">qr</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">cnt</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lbd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rbd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">rk</span><span class="p">[</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">rk</span><span class="p">[</span><span class="n">l</span><span class="p">];</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">vtl</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">==</span> <span class="n">r</span><span class="p">)</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">vtl</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lbd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rbd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">lbd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">lbd</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">rbd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">rbd</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">sum</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
			<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">vtl</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">vtl</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">vtl</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">].</span><span class="n">rbd</span> <span class="o">&amp;&amp;</span> <span class="n">v</span><span class="p">[</span><span class="n">rt</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="mi">1</span><span class="p">].</span><span class="n">lbd</span><span class="p">)</span>
				<span class="n">v</span><span class="p">[</span><span class="n">rt</span><span class="p">].</span><span class="n">vtl</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ask</span><span class="p">()</span>
	<span class="p">{</span>
		<span class="n">rk</span><span class="p">.</span><span class="n">init</span><span class="p">();</span>
		<span class="n">sort</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
		<span class="n">v</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Node</span><span class="p">());</span>
		<span class="n">ll</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">ll</span> <span class="n">pre</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span><span class="p">;</span>
			<span class="n">upd</span><span class="p">(</span><span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">),</span> <span class="n">rk</span><span class="p">.</span><span class="n">ask</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rk</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">ans</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">vtl</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">h</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span> <span class="o">-</span> <span class="n">pre</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">sum</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">;</span> <span class="o">~</span><span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">);)</span>
	<span class="p">{</span>
		<span class="n">Perimeter</span> <span class="n">p</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">scanf</span><span class="p">(</span><span class="s">"%d%d%d%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
			<span class="n">p</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">ask</span><span class="p">());</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
:ET