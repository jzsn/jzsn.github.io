<h2 id="实验题目">实验题目</h2>

<p>静态路由实验</p>

<h2 id="实验目的">实验目的</h2>

<p>掌握静态路由的配置和使用方法。</p>

<h2 id="实验命令">实验命令</h2>

<h3 id="查看接口">查看接口</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#show interface</span>
<span class="c">#show ip interface brief</span>
<span class="c">#show ip interface f0/1</span>
</code></pre></div></div>

<h3 id="配置-ip-地址和子网掩码">配置 IP 地址和子网掩码</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>config<span class="o">)</span><span class="c">#interface serial 1/2                       !进行接口模式</span>
<span class="o">(</span>config-if<span class="o">)</span><span class="c">#ip address 192.168.1.11  255.255.255.0   !配置接口的IP地址和子网掩码</span>
</code></pre></div></div>

<h3 id="配置串口时钟和带宽">配置串口时钟和带宽</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>config-if<span class="o">)</span><span class="c">#clock rate 64000               !配置时钟频率64000（在DCE上配置，DTE不用配置）</span>
<span class="o">(</span>config-if<span class="o">)</span><span class="c">#bandwidth 512                !配置端口的带宽速率为512KB</span>
</code></pre></div></div>

<h3 id="配置静态路由">配置静态路由</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>config<span class="o">)</span><span class="c">#ip route network net-mask next-hop  ! next-hop可以为转发的串行接口名或下一跳的IP地址</span>
</code></pre></div></div>

<p>例：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip route  192.168.3.0  255.255.255.0  192.168.2.2
ip route  192.168.3.0  255.255.255.0  S2/0
</code></pre></div></div>

<h3 id="显示路由表">显示路由表</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#show ip route</span>
</code></pre></div></div>

<h3 id="配置静态路由参数">配置静态路由参数</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>config<span class="o">)</span><span class="c">#ip route network net-mask next-hop  [distance]  [weight number]  [disable|enable]</span>
！distance设置管理距离（默认为1），weight为权重。
<span class="o">!</span> 将distance设置为一个大的值<span class="o">(</span>例如，125。这大于OSPF的110<span class="o">)</span>可以作为备份路由。
</code></pre></div></div>

<h3 id="配置默认路由">配置默认路由</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>config<span class="o">)</span><span class="c"># ip route 0.0.0.0  0.0.0.0  next-hop</span>
</code></pre></div></div>

<p>例：</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ip route  0.0.0.0  0.0.0.0  192.168.2.1
</code></pre></div></div>

<h3 id="配置交换机端口镜像">配置交换机端口镜像</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Switch<span class="o">(</span>config<span class="o">)</span><span class="c">#monitor  session 1  source  interface  f0/15    ! 监控f0/15</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c">#monitor  session 1  destination  interface  f0/5  ! 用f0/5监控</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c">#show  monitor  session  1                	! 显示监控情况</span>
Switch<span class="o">(</span>config<span class="o">)</span><span class="c">#no  monitor  session  1                  	! 取消监控</span>
</code></pre></div></div>

<h2 id="实验说明">实验说明</h2>

<ul>
  <li>配置前先重启路由器<code class="highlighter-rouge">#reload</code></li>
  <li>参与 ping 的主机要删除校园网网关。</li>
  <li>注意关闭 Windows 的防火墙</li>
</ul>

<h2 id="实验任务">实验任务</h2>

<p>由于实际上所用的接口名不一定是上面标明的，先用#show interface 查看接口名，并根据实际接线修改上图的接口和 IP 地址标记。
配置好 PC 机实验网网卡的 IP 地址、子网掩码和默认网关，按下面步骤依次进行配置和检测：</p>

<h3 id="配置-router1-和-router2-的-ip-地址和子网掩码-见上面实验命令">配置 Router1 和 Router2 的 IP 地址和子网掩码 (见上面“实验命令”)。</h3>

<h4 id="显示-router1-的路由表并截屏">显示 Router1 的路由表并截屏</h4>

<p><img src="/assets/image/2019-05-05-1.jpg" alt="图片描述" /></p>

<h4 id="显示-router2-的路由表并截屏">显示 Router2 的路由表并截屏</h4>

<p><img src="/assets/image/2019-05-05-2.jpg" alt="图片描述" /></p>

<h4 id="pc1-依次-ping-到-pc2-路经上的所有-ip-地址并截屏">PC1 依次 ping 到 PC2 路经上的所有 IP 地址，并截屏</h4>

<p><img src="/assets/image/2019-05-05-3.jpg" alt="图片描述" /></p>

<h4 id="分析-router1-路由表和-router2-路由表的路由组成">分析 Router1 路由表和 Router2 路由表的路由组成</h4>

<p>第一行和第三行是此次实验新设的 IP 地址以及对应的连接端口。而第二和第四行则说明本路由器拥有的 IP 地址和对应的端口。</p>

<h3 id="在-router1-和-router2-上配置静态路由见上面命令或课件要求-pc1-可以-ping-通-pc2">在 Router1 和 Router2 上配置静态路由(见上面命令或课件)，要求 PC1 可以 ping 通 PC2。</h3>

<h4 id="显示-router1-的路由表并截屏-1">显示 Router1 的路由表并截屏</h4>

<p><img src="/assets/image/2019-05-05-4.jpg" alt="图片描述" /></p>

<h4 id="显示-router2-的路由表并截屏-1">显示 Router2 的路由表并截屏</h4>

<p><img src="/assets/image/2019-05-05-5.jpg" alt="图片描述" /></p>

<h4 id="pc1-ping-pc2-并截屏">PC1 ping PC2 并截屏</h4>

<p><img src="/assets/image/2019-05-05-6.jpg" alt="图片描述" /></p>

<h4 id="分析-router1-路由表和-router2-路由表的路由组成-1">分析 Router1 路由表和 Router2 路由表的路由组成</h4>

<p>此时相比于（1），每一个路由器多了一行“S 192.168.X.X”，这是新配置的静态路由。路由器 1 的静态路由配置为网络号：192.168.3.0，端口为 192.168.2.2.路由器 2 的静态路由配置为网络号：192.168.1.0，端口为 192.168.2.1.</p>

<h3 id="如果只在-router1-上配置静态路由删除-router2-上配置的静态路由-pc1-和-pc2-都-ping-到对方路径上的-ip-地址最远可以-ping-通哪个接口为什么">如果只在 Router1 上配置静态路由（删除 Router2 上配置的静态路由）, PC1 和 PC2 都 ping 到对方路径上的 IP 地址，最远可以 ping 通哪个接口？为什么？</h3>

<p>删除配置命令的方法是在原配置命令前加 no（和一个空格）。用上下键可以显示出历史命令。</p>

<h4 id="pc1-依次-ping-到-pc2-路经上的所有-ip-地址并截屏-1">PC1 依次 ping 到 PC2 路经上的所有 IP 地址，并截屏</h4>

<p><img src="/assets/image/2019-05-05-7.jpg" alt="图片描述" /></p>

<h4 id="pc2-依次-ping-到-pc1-路经上的所有-ip-地址并截屏">PC2 依次 ping 到 PC1 路经上的所有 IP 地址，并截屏</h4>

<p><img src="/puclic/image/2019-05-05-8.jpg" alt="图片描述" /></p>

<h4 id="分析结果">分析结果</h4>

<p>此时的 PC2 由于路由器 1 的静态路由没有删除，所以可以有路由表找到前往 192.168.2.1 的路径，但由于路由器 2 的静态路由删除，所以并不能找到对应的路径前往 PC1.</p>

<p>PC1 可以到达路由器 1 的两端。由于路由器 2 的原因，不能 ping 通路由器 2 的两个端口以及 PC2.</p>

<h3 id="如果在路由器-router1-和-router2-只配置默认路由指向对方要先删除原静态路由pc1-是否可以-ping-通-pc2为什么写下分析">如果在路由器 Router1 和 Router2 只配置默认路由指向对方（要先删除原静态路由），PC1 是否可以 ping 通 PC2？为什么？写下分析。</h3>

<h4 id="pc1-ping-pc2并截屏">PC1 ping PC2，并截屏</h4>

<p><img src="/assets/image/2019-05-05-9.jpg" alt="图片描述" /></p>

<h4 id="显示-router1-的路由表并截屏-2">显示 Router1 的路由表并截屏</h4>

<p><img src="/assets/image/2019-05-05-10.jpg" alt="图片描述" /></p>

<h4 id="分析结果-1">分析结果</h4>

<p>由于在 router1 的路由表中没有目的地址与要前往的目的地址符合，所以选择默认路由的路径，发往 router2，而 router2 的路由表里有对应的目的地址，从 192.168.3.1 发到 PC2.所以可以 ping 通。</p>

<h3 id="在路由器之间加入一台交换机-switch1不用配置并连上一台主机pc3见下图在-switch1-上配置端口镜像见上面实验命令捕捉经过-f015-的-ip-分组并送往-f05-pc3-可以用-wireshark-捕捉-icmp-包filteripproto1">在路由器之间加入一台交换机 Switch1（不用配置），并连上一台主机（PC3），见下图。在 Switch1 上配置端口镜像(见上面“实验命令”)，捕捉经过 F0/15 的 IP 分组，并送往 F0/5， PC3 可以用 WireShark 捕捉 ICMP 包（filter：ip.proto==1）。</h3>

<h4 id="用-pc1-ping-一个外部网络的无主-ip-地址会出现什么现象截屏并分析结果">用 PC1 ping 一个外部网络的无主 IP 地址会出现什么现象？截屏并分析结果</h4>

<p><img src="/assets/image/2019-05-05-11.jpg" alt="图片描述" /></p>

<h3 id="见下图拆除-router1-和-router2-之间的以太网线并用串行接口做实验串行接口已经接好了但不一定是下图标志的名称要用show-interface或show-ip-interface-brief-或show-ip-interface-s01查看哪个串行接口已经接好line-is-upprotocol-is-up配置-router1-和-router2-串行口的时钟ip-地址和子网掩码删除默认路由配置静态路由见上面命令或课件令-pc1-可以-ping-通-pc2">见下图，拆除 Router1 和 Router2 之间的以太网线，并用串行接口做实验，串行接口已经接好了，但不一定是下图标志的名称，要用#show interface（或#show ip interface brief 或#show ip interface s0/1）查看哪个串行接口已经接好(line is up，protocol is up)。配置 Router1 和 Router2 串行口的时钟、IP 地址和子网掩码，删除默认路由，配置静态路由(见上面命令或课件)，令 PC1 可以 ping 通 PC2。</h3>

<h4 id="用-pc1-ping-pc2-并截屏">用 PC1 ping PC2 并截屏</h4>

<p><img src="/assets/image/2019-05-05-12.jpg" alt="图片描述" /></p>

<p>此时由于 router1 的路由表里没有对应的目的地址，所以发往默认路由，即从 12.0168.2.1 发出，经过交换机，PC3 收到。而 router2 收到后，也是没有符合的目的地址，所以发往默认路由，经过交换机，到达 router1.重复上述操作，直至该帧的 TTL 减为 0,。在此过程中，PC3 一直收到。所以出现了上面的结果。</p>

<h4 id="显示-router1-的路由表并截屏-3">显示 Router1 的路由表并截屏</h4>

<p><img src="/assets/image/2019-05-05-13.jpg" alt="图片描述" /></p>

<h4 id="显示-router2-的路由表并截屏-2">显示 Router2 的路由表并截屏</h4>

<p><img src="/publuc/image/2019-05-05-14.jpg" alt="图片描述" /></p>

<h4 id="用show-running-config-显示-router1-的当前配置并粘贴在下面">用#show running-config 显示 Router1 的当前配置，并粘贴在下面</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Building configuration...
Current configuration : 1913 bytes

<span class="o">!</span>
version RGOS 10.4<span class="o">(</span>3b23<span class="o">)</span> Release<span class="o">(</span>176514<span class="o">)(</span>Mon Jul 28 18:19:31 CST 2014 <span class="nt">-ngcf62</span><span class="o">)</span>
<span class="nb">hostname </span>18-RSR20-1
webmaster level 0 username admin password 7 06073a0e261b
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
diffserv domain default
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
cwmp
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
vlan 1
<span class="o">!</span>
<span class="o">!</span>
no service password-encryption
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
control-plane
<span class="o">!</span>
control-plane protocol
 no acpp
<span class="o">!</span>
control-plane manage
 no port-filter
 no arp-car
 no acpp
<span class="o">!</span>
control-plane data
 no glean-car
 no acpp
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="nb">enable </span>service web-server http
<span class="nb">enable </span>service web-server https
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
interface Serial 2/0
 encapsulation HDLC
 ip address 192.168.2.1 255.255.255.0
 bandwidth 512
<span class="o">!</span>
interface FastEthernet 1/0
<span class="o">!</span>
interface FastEthernet 1/1
<span class="o">!</span>
interface FastEthernet 1/2
<span class="o">!</span>
interface FastEthernet 1/3
<span class="o">!</span>
interface FastEthernet 1/4
<span class="o">!</span>
interface FastEthernet 1/5
<span class="o">!</span>
interface FastEthernet 1/6
<span class="o">!</span>
interface FastEthernet 1/7
<span class="o">!</span>
interface FastEthernet 1/8
<span class="o">!</span>
interface FastEthernet 1/9
<span class="o">!</span>
interface FastEthernet 1/10
<span class="o">!</span>
interface FastEthernet 1/11
<span class="o">!</span>
interface FastEthernet 1/12
<span class="o">!</span>
interface FastEthernet 1/13
<span class="o">!</span>
interface FastEthernet 1/14
<span class="o">!</span>
interface FastEthernet 1/15
<span class="o">!</span>
interface FastEthernet 1/16
<span class="o">!</span>
interface FastEthernet 1/17
<span class="o">!</span>
interface FastEthernet 1/18
<span class="o">!</span>
interface FastEthernet 1/19
<span class="o">!</span>
interface FastEthernet 1/20
<span class="o">!</span>
interface FastEthernet 1/21
<span class="o">!</span>
interface FastEthernet 1/22
<span class="o">!</span>
interface FastEthernet 1/23
<span class="o">!</span>
interface GigabitEthernet 0/0
 ip address 192.168.1.1 255.255.255.0
 duplex auto
 speed auto
<span class="o">!</span>
interface GigabitEthernet 0/1
 duplex auto
 speed auto
<span class="o">!</span>
interface VLAN 1
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
ip route 192.168.3.0 255.255.255.0 192.168.2.2
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
ref parameter 75 140
line con 0
line aux 0
line <span class="nb">tty </span>1
 modem InOut
line vty 0 4
 login
 password b402
<span class="o">!</span>
<span class="o">!</span>
end
</code></pre></div></div>

<h4 id="用show-running-config-显示-router2-的当前配置并粘贴在下面">用#show running-config 显示 Router2 的当前配置，并粘贴在下面</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>18-RSR20-2<span class="o">(</span>config<span class="o">)</span><span class="c">#show running-config</span>

Building configuration...
Current configuration : 1971 bytes

<span class="o">!</span>
version RGOS 10.4<span class="o">(</span>3b23<span class="o">)</span> Release<span class="o">(</span>176514<span class="o">)(</span>Mon Jul 28 18:19:31 CST 2014 <span class="nt">-ngcf62</span><span class="o">)</span>
<span class="nb">hostname </span>18-RSR20-2
webmaster level 0 username admin password 7 073f07221c1c
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
diffserv domain default
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
cwmp
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
vlan 1
<span class="o">!</span>
<span class="o">!</span>
no service password-encryption
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
control-plane
<span class="o">!</span>
control-plane protocol
 no acpp
<span class="o">!</span>
control-plane manage
 no port-filter
 no arp-car
 no acpp
<span class="o">!</span>
control-plane data
 no glean-car
 no acpp
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="nb">enable </span>service web-server http
<span class="nb">enable </span>service web-server https
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
interface Serial 2/0
 encapsulation HDLC
 ip address 192.168.2.2 255.255.255.0
 clock rate 64000
 bandwidth 512
<span class="o">!</span>
interface Serial 3/0
 encapsulation HDLC
 clock rate 64000
<span class="o">!</span>
interface FastEthernet 1/0
<span class="o">!</span>
interface FastEthernet 1/1
<span class="o">!</span>
interface FastEthernet 1/2
<span class="o">!</span>
interface FastEthernet 1/3
<span class="o">!</span>
interface FastEthernet 1/4
<span class="o">!</span>
interface FastEthernet 1/5
<span class="o">!</span>
interface FastEthernet 1/6
<span class="o">!</span>
interface FastEthernet 1/7
<span class="o">!</span>
interface FastEthernet 1/8
<span class="o">!</span>
interface FastEthernet 1/9
<span class="o">!</span>
interface FastEthernet 1/10
<span class="o">!</span>
interface FastEthernet 1/11
<span class="o">!</span>
interface FastEthernet 1/12
<span class="o">!</span>
interface FastEthernet 1/13
<span class="o">!</span>
interface FastEthernet 1/14
<span class="o">!</span>
interface FastEthernet 1/15
<span class="o">!</span>
interface FastEthernet 1/16
<span class="o">!</span>
interface FastEthernet 1/17
<span class="o">!</span>
interface FastEthernet 1/18
<span class="o">!</span>
interface FastEthernet 1/19
<span class="o">!</span>
interface FastEthernet 1/20
<span class="o">!</span>
interface FastEthernet 1/21
<span class="o">!</span>
interface FastEthernet 1/22
<span class="o">!</span>
interface FastEthernet 1/23
<span class="o">!</span>
interface GigabitEthernet 0/0
 duplex auto
 speed auto
<span class="o">!</span>
interface GigabitEthernet 0/1
 ip address 192.168.3.2 255.255.255.0
 duplex auto
 speed auto
<span class="o">!</span>
interface VLAN 1
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
ip route 192.168.1.0 255.255.255.0 192.168.2.1
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
<span class="o">!</span>
ref parameter 75 140
line con 0
line aux 0
line vty 0 4
 login
 password b402
<span class="o">!</span>
<span class="o">!</span>
end
</code></pre></div></div>

<h2 id="实验体会">实验体会</h2>

<p>本次实验中，我们遇到了一些问题，有时配置是（我们认为）正确的但是总是 ping 不通，然后过了一段时间后结果又正常了，有些让人抓不到头脑。所幸最终是把实验做完了。在本次实验中我了解了静态路由的一些配置，对于一些情况也可以判断出问题所在。</p>
