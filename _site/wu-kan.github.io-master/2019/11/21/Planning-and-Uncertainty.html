<h2 id="2times-2-rubiks-cube">$2\times 2$ Rubik’s Cube</h2>

<p>Please solve the $2\times 2$ Rubik’s Cube by using FF planner. Here are 4 cases for you to verify the correctness of your programs. You should hand in 5 files, including a domain file (<code class="highlighter-rouge">cube_domain.pddl</code>) and 4 data files (<code class="highlighter-rouge">cube1.pddl</code>, <code class="highlighter-rouge">cube2.pddl</code>, <code class="highlighter-rouge">cube3.pddl</code>,<code class="highlighter-rouge">cube4.pddl</code>).</p>

<p>For more information about $2\times 2$ Rubik’s Cube, such as actions R, U and F, please refer to <a href="https://rubiks-cube-solver.com/2x2/">https://rubiks-cube-solver.com/2x2/</a>.</p>

<p>做的时候遇到一些问题，网页版的<a href="http://editor.planning.domains">PDDL Editor</a>仅能跑出第一组数据，其他几组数据会超时。多次修改无效的情况下，我选择在 linux 系统下本地安装规划器完成这一项。依次运行下述指令，安装规划器。注意<code class="highlighter-rouge">make</code>的时候，如果提示缺少库文件，需要自己手动装。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://fai.cs.uni-saarland.de/hoffmann/ff/FF-v2.3.tgz
<span class="nb">tar </span>zxvf FF-v2.3.tgz
<span class="nb">cd </span>FF-v2.3
make
</code></pre></div></div>

<p>将生成目录<code class="highlighter-rouge">/FF-v2.3</code>下的二进制文件<code class="highlighter-rouge">ff</code>拷贝到当前目录下，终端下依次执行如下四条指令运行规划并将结果写到对应文本文件内。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./ff <span class="nt">-o</span> cube_domain.pddl <span class="nt">-f</span> cube1.pddl <span class="o">&gt;</span> cube1.txt
./ff <span class="nt">-o</span> cube_domain.pddl <span class="nt">-f</span> cube2.pddl <span class="o">&gt;</span> cube2.txt
./ff <span class="nt">-o</span> cube_domain.pddl <span class="nt">-f</span> cube3.pddl <span class="o">&gt;</span> cube3.txt
./ff <span class="nt">-o</span> cube_domain.pddl <span class="nt">-f</span> cube4.pddl <span class="o">&gt;</span> cube4.txt
</code></pre></div></div>

<p>以下是源代码和运行结果。其中，<code class="highlighter-rouge">cube1 ?x ?y ?z</code>指某一块方块在 x 轴、y 轴、z 轴三个方向上可视面的颜色，其它同。</p>

<h3 id="cube_domainpddl"><code class="highlighter-rouge">cube_domain.pddl</code></h3>

<pre><code class="language-pddl">(define
    (domain cube)
    (:predicates
        (cube1 ?x ?y ?z)
        (cube2 ?x ?y ?z)
        (cube3 ?x ?y ?z)
        (cube4 ?x ?y ?z)
        (cube5 ?x ?y ?z)
        (cube6 ?x ?y ?z)
        (cube7 ?x ?y ?z)
        (cube8 ?x ?y ?z)
    )
    (:action U:effect
        (and
            (forall
                (?x ?y ?z)
                (when
                    (cube5 ?x ?y ?z)
                    (and
                        (not
                            (cube5 ?x ?y ?z)
                        )
                        (cube7 ?y ?x ?z)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube7 ?x ?y ?z)
                    (and
                        (not
                            (cube7 ?x ?y ?z)
                        )
                        (cube8 ?y ?x ?z)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube8 ?x ?y ?z)
                    (and
                        (not
                            (cube8 ?x ?y ?z)
                        )
                        (cube6 ?y ?x ?z)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube6 ?x ?y ?z)
                    (and
                        (not
                            (cube6 ?x ?y ?z)
                        )
                        (cube5 ?y ?x ?z)
                    )
                )
            )
        )
    )
    (:action Urev:effect
        (and
            (forall
                (?x ?y ?z)
                (when
                    (cube5 ?x ?y ?z)
                    (and
                        (not
                            (cube5 ?x ?y ?z)
                        )
                        (cube6 ?y ?x ?z)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube6 ?x ?y ?z)
                    (and
                        (not
                            (cube6 ?x ?y ?z)
                        )
                        (cube8 ?y ?x ?z)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube8 ?x ?y ?z)
                    (and
                        (not
                            (cube8 ?x ?y ?z)
                        )
                        (cube7 ?y ?x ?z)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube7 ?x ?y ?z)
                    (and
                        (not
                            (cube7 ?x ?y ?z)
                        )
                        (cube5 ?y ?x ?z)
                    )
                )
            )
        )
    )
    (:action R:effect
        (and
            (forall
                (?x ?y ?z)
                (when
                    (cube2 ?x ?y ?z)
                    (and
                        (not
                            (cube2 ?x ?y ?z)
                        )
                        (cube6 ?x ?z ?y)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube6 ?x ?y ?z)
                    (and
                        (not
                            (cube6 ?x ?y ?z)
                        )
                        (cube8 ?x ?z ?y)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube8 ?x ?y ?z)
                    (and
                        (not
                            (cube8 ?x ?y ?z)
                        )
                        (cube4 ?x ?z ?y)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube4 ?x ?y ?z)
                    (and
                        (not
                            (cube4 ?x ?y ?z)
                        )
                        (cube2 ?x ?z ?y)
                    )
                )
            )
        )
    )
    (:action Rrev:effect
        (and
            (forall
                (?x ?y ?z)
                (when
                    (cube2 ?x ?y ?z)
                    (and
                        (not
                            (cube2 ?x ?y ?z)
                        )
                        (cube4 ?x ?z ?y)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube4 ?x ?y ?z)
                    (and
                        (not
                            (cube4 ?x ?y ?z)
                        )
                        (cube8 ?x ?z ?y)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube8 ?x ?y ?z)
                    (and
                        (not
                            (cube8 ?x ?y ?z)
                        )
                        (cube6 ?x ?z ?y)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube6 ?x ?y ?z)
                    (and
                        (not
                            (cube6 ?x ?y ?z)
                        )
                        (cube2 ?x ?z ?y)
                    )
                )
            )
        )
    )
    (:action F:effect
        (and
            (forall
                (?x ?y ?z)
                (when
                    (cube1 ?x ?y ?z)
                    (and
                        (not
                            (cube1 ?x ?y ?z)
                        )
                        (cube5 ?z ?y ?x)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube5 ?x ?y ?z)
                    (and
                        (not
                            (cube5 ?x ?y ?z)
                        )
                        (cube6 ?z ?y ?x)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube6 ?x ?y ?z)
                    (and
                        (not
                            (cube6 ?x ?y ?z)
                        )
                        (cube2 ?z ?y ?x)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube2 ?x ?y ?z)
                    (and
                        (not
                            (cube2 ?x ?y ?z)
                        )
                        (cube1 ?z ?y ?x)
                    )
                )
            )
        )
    )
    (:action Frev:effect
        (and
            (forall
                (?x ?y ?z)
                (when
                    (cube1 ?x ?y ?z)
                    (and
                        (not
                            (cube1 ?x ?y ?z)
                        )
                        (cube2 ?z ?y ?x)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube2 ?x ?y ?z)
                    (and
                        (not
                            (cube2 ?x ?y ?z)
                        )
                        (cube6 ?z ?y ?x)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube6 ?x ?y ?z)
                    (and
                        (not
                            (cube6 ?x ?y ?z)
                        )
                        (cube5 ?z ?y ?x)
                    )
                )
            )
            (forall
                (?x ?y ?z)
                (when
                    (cube5 ?x ?y ?z)
                    (and
                        (not
                            (cube5 ?x ?y ?z)
                        )
                        (cube1 ?z ?y ?x)
                    )
                )
            )
        )
    )
)
</code></pre>

<h3 id="cube1pddl"><code class="highlighter-rouge">cube1.pddl</code></h3>

<pre><code class="language-pddl">(define
    (problem cube1)
    (:domain cube)
    (:objects Y W B G O R)
    (:init
        (cube1 B O Y)
        (cube2 G R W)
        (cube3 R Y B)
        (cube4 O B W)
        (cube5 O Y G)
        (cube6 B R W)
        (cube7 O W G)
        (cube8 Y R G)
    )
    (:goal
        (and
            (cube1 R W B)
            (cube2 O W B)
            (cube3 R Y B)
            (cube4 O Y B)
            (cube5 R W G)
            (cube6 O W G)
            (cube7 R Y G)
            (cube8 O Y G)
        )
    )
)
</code></pre>

<h3 id="cube1txt"><code class="highlighter-rouge">cube1.txt</code></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ff: parsing domain file
domain <span class="s1">'CUBE'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>
ff: parsing problem file
problem <span class="s1">'CUBE1'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>



Cueing down from goal distance:   10 into depth <span class="o">[</span>1]
                                   8            <span class="o">[</span>1][2][3]
                                   7            <span class="o">[</span>1]
                                   6            <span class="o">[</span>1]
                                   5            <span class="o">[</span>1][2]
                                   4            <span class="o">[</span>1][2][3][4][5][6][7]
                                   1            <span class="o">[</span>1]
                                   0

ff: found legal plan as follows

step    0: R
        1: UREV
        2: RREV
        3: UREV
        4: FREV
        5: R
        6: F
        7: R
        8: FREV
        9: UREV
       10: F
       11: U
       12: RREV
       13: UREV
       14: FREV
       15: U


<span class="nb">time </span>spent:    0.02 seconds instantiating 6 easy, 0 hard action templates
               0.00 seconds reachability analysis, yielding 1512 facts and 6 actions
               0.00 seconds creating final representation with 1512 relevant facts
               0.10 seconds building connectivity graph
               0.04 seconds searching, evaluating 194 states, to a max depth of 7
               0.16 seconds total <span class="nb">time</span>


</code></pre></div></div>

<h3 id="cube2pddl"><code class="highlighter-rouge">cube2.pddl</code></h3>

<pre><code class="language-pddl">(define
    (problem cube2)
    (:domain cube)
    (:objects Y W B G O R)
    (:init
        (cube1 B R W)
        (cube2 O B Y)
        (cube3 W G R)
        (cube4 R Y G)
        (cube5 G O Y)
        (cube6 B W O)
        (cube7 R B Y)
        (cube8 O G W)
    )
    (:goal
        (and
            (cube1 W B R)
            (cube2 Y B R)
            (cube3 W G R)
            (cube4 Y G R)
            (cube5 W B O)
            (cube6 Y B O)
            (cube7 W G O)
            (cube8 Y G O)
        )
    )
)
</code></pre>

<h3 id="cube2txt"><code class="highlighter-rouge">cube2.txt</code></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ff: parsing domain file
domain <span class="s1">'CUBE'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>
ff: parsing problem file
problem <span class="s1">'CUBE2'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>



Cueing down from goal distance:   13 into depth <span class="o">[</span>1][2]
                                  12            <span class="o">[</span>1]
                                  11            <span class="o">[</span>1][2]
                                  10            <span class="o">[</span>1]
                                   8            <span class="o">[</span>1][2]
                                   6            <span class="o">[</span>1][2][3][4][5]
                                   5            <span class="o">[</span>1][2][3][4][5][6]
                                   4            <span class="o">[</span>1][2][3][4][5]
                                   3            <span class="o">[</span>1][2][3][4][5][6][7][8][9]
                                   2            <span class="o">[</span>1][2][3]

Enforced Hill-climbing failed <span class="o">!</span>
switching to Best-first Search now.

advancing to distance :   13
                          12
                          10
                           8
                           6
                           5
                           4
                           3
                           2
                           1
                           0

ff: found legal plan as follows

step    0: RREV
        1: FREV
        2: U
        3: FREV
        4: U
        5: FREV
        6: R
        7: FREV
        8: U
        9: RREV
       10: FREV
       11: R
       12: UREV
       13: F
       14: U
       15: RREV
       16: UREV
       17: FREV
       18: U
       19: F
       20: UREV
       21: RREV
       22: F
       23: R
       24: FREV
       25: R
       26: F
       27: R
       28: FREV
       29: RREV
       30: UREV
       31: R
       32: U
       33: RREV
       34: U
       35: F
       36: UREV
       37: FREV
       38: UREV
       39: RREV
       40: F
       41: R
       42: U
       43: R
       44: UREV
       45: RREV


<span class="nb">time </span>spent:    0.02 seconds instantiating 6 easy, 0 hard action templates
               0.00 seconds reachability analysis, yielding 1512 facts and 6 actions
               0.01 seconds creating final representation with 1512 relevant facts
               0.09 seconds building connectivity graph
               0.67 seconds searching, evaluating 8733 states, to a max depth of 9
               0.79 seconds total <span class="nb">time</span>

</code></pre></div></div>

<h3 id="cube3pddl"><code class="highlighter-rouge">cube3.pddl</code></h3>

<pre><code class="language-pddl">(define
    (problem cube3)
    (:domain cube)
    (:objects Y W B G O R)
    (:init
        (cube1 R Y G)
        (cube2 O G W)
        (cube3 Y O B)
        (cube4 W B R)
        (cube5 O W B)
        (cube6 Y O G)
        (cube7 W R G)
        (cube8 R Y B)
    )
    (:goal
        (and
            (cube1 Y R B)
            (cube2 W R B)
            (cube3 Y O B)
            (cube4 W O B)
            (cube5 Y R G)
            (cube6 W R G)
            (cube7 Y O G)
            (cube8 W O G)
        )
    )
)
</code></pre>

<h3 id="cube3txt"><code class="highlighter-rouge">cube3.txt</code></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ff: parsing domain file
domain <span class="s1">'CUBE'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>
ff: parsing problem file
problem <span class="s1">'CUBE3'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>



Cueing down from goal distance:   10 into depth <span class="o">[</span>1]
                                   9            <span class="o">[</span>1][2]
                                   8            <span class="o">[</span>1]
                                   7            <span class="o">[</span>1][2][3][4]
                                   5            <span class="o">[</span>1][2][3][4]
                                   4            <span class="o">[</span>1][2][3][4][5][6][7][8][9]
                                   3            <span class="o">[</span>1]
                                   2            <span class="o">[</span>1][2]

Enforced Hill-climbing failed <span class="o">!</span>
switching to Best-first Search now.

advancing to distance :   10
                           9
                           8
                           7
                           6
                           5
                           4
                           1
                           0

ff: found legal plan as follows

step    0: UREV
        1: R
        2: UREV
        3: RREV
        4: UREV
        5: FREV
        6: R
        7: FREV
        8: RREV
        9: U
       10: R
       11: F
       12: R
       13: FREV
       14: RREV
       15: U
       16: FREV
       17: UREV
       18: F
       19: UREV
       20: RREV
       21: F
       22: R
       23: FREV
       24: R
       25: F
       26: R
       27: FREV
       28: RREV
       29: UREV
       30: R
       31: U
       32: RREV
       33: U
       34: F
       35: UREV
       36: FREV
       37: UREV
       38: RREV
       39: F
       40: R
       41: U
       42: R
       43: UREV
       44: RREV


<span class="nb">time </span>spent:    0.00 seconds instantiating 6 easy, 0 hard action templates
               0.00 seconds reachability analysis, yielding 1512 facts and 6 actions
               0.02 seconds creating final representation with 1512 relevant facts
               0.08 seconds building connectivity graph
               0.13 seconds searching, evaluating 1710 states, to a max depth of 9
               0.23 seconds total <span class="nb">time</span>


</code></pre></div></div>

<h3 id="cube4pddl"><code class="highlighter-rouge">cube4.pddl</code></h3>

<pre><code class="language-pddl">(define
    (problem cube4)
    (:domain cube)
    (:objects Y W B G O R)
    (:init
        (cube1 B O Y)
        (cube2 W O G)
        (cube3 B O W)
        (cube4 R G W)
        (cube5 G Y R)
        (cube6 Y O G)
        (cube7 B Y R)
        (cube8 R B W)
    )
    (:goal
        (and
            (cube1 B R W)
            (cube2 G R W)
            (cube3 B O W)
            (cube4 G O W)
            (cube5 B R Y)
            (cube6 G R Y)
            (cube7 B O Y)
            (cube8 G O Y)
        )
    )
)
</code></pre>

<h3 id="cube4txt"><code class="highlighter-rouge">cube4.txt</code></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ff: parsing domain file
domain <span class="s1">'CUBE'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>
ff: parsing problem file
problem <span class="s1">'CUBE4'</span> defined
 ... <span class="k">done</span><span class="nb">.</span>



Cueing down from goal distance:   14 into depth <span class="o">[</span>1]
                                  12            <span class="o">[</span>1][2]
                                  11            <span class="o">[</span>1]
                                   9            <span class="o">[</span>1]
                                   7            <span class="o">[</span>1][2][3]
                                   6            <span class="o">[</span>1][2]
                                   5            <span class="o">[</span>1][2][3][4]
                                   4            <span class="o">[</span>1][2][3][4][5][6][7]
                                   2            <span class="o">[</span>1][2][3]

Enforced Hill-climbing failed <span class="o">!</span>
switching to Best-first Search now.

advancing to distance :   14
                          12
                          11
                           9
                           7
                           6
                           5
                           2
                           1
                           0

ff: found legal plan as follows

step    0: FREV
        1: R
        2: FREV
        3: R
        4: FREV
        5: RREV
        6: UREV
        7: F
        8: R
        9: U
       10: R
       11: F
       12: RREV
       13: FREV
       14: R
       15: F
       16: RREV
       17: FREV
       18: R
       19: F
       20: U
       21: FREV
       22: UREV
       23: F
       24: R
       25: F
       26: RREV
       27: FREV
       28: R
       29: FREV
       30: UREV
       31: RREV
       32: U
       33: FREV
       34: UREV
       35: R
       36: U
       37: F
       38: U
       39: FREV
       40: UREV


<span class="nb">time </span>spent:    0.00 seconds instantiating 6 easy, 0 hard action templates
               0.01 seconds reachability analysis, yielding 1512 facts and 6 actions
               0.00 seconds creating final representation with 1512 relevant facts
               0.08 seconds building connectivity graph
               0.15 seconds searching, evaluating 2462 states, to a max depth of 7
               0.24 seconds total <span class="nb">time</span>


</code></pre></div></div>

<h2 id="diagnosing-by-bayesian-networks">Diagnosing by Bayesian Networks</h2>

<p>终端运行下述指令，将结果写到文本文件中。</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python Diagnosing.py <span class="o">&gt;</span> Diagnosing.txt
</code></pre></div></div>

<h3 id="variables-and-their-domais">Variables and their domais</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># (1)PatientAge:['0-30','31-65','65+']
# (2)CTScanResult:['Ischemic Stroke','Hemmorraghic Stroke']
# (3)MRIScanResult: ['Ischemic Stroke','Hemmorraghic Stroke']
# (4)StrokeType: ['Ischemic Stroke','Hemmorraghic Stroke', 'Stroke Mimic']
# (5)Anticoagulants: ['Used','Not used']
# (6)Mortality:['True', 'False']
# (7)Disability: ['Negligible', 'Moderate', 'Severe']
</span></code></pre></div></div>

<h3 id="cpts">CPTS</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># (1)
</span><span class="p">[</span><span class="n">PatientAge</span><span class="p">]</span>

<span class="p">[</span><span class="s">'0-30'</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">],</span>
<span class="p">[</span><span class="s">'31-65'</span><span class="p">,</span> <span class="mf">0.30</span><span class="p">],</span>
<span class="p">[</span><span class="s">'65+'</span><span class="p">,</span> <span class="mf">0.60</span><span class="p">]</span>

<span class="c1"># (2)
</span><span class="p">[</span><span class="n">CTScanResult</span><span class="p">]</span>

<span class="p">[</span><span class="s">'Ischemic Stroke'</span><span class="p">,</span><span class="mf">0.7</span><span class="p">],</span>
<span class="p">[</span> <span class="s">'Hemmorraghic Stroke'</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>

<span class="c1"># (3)
</span><span class="p">[</span><span class="n">MRIScanResult</span><span class="p">]</span>

<span class="p">[</span><span class="s">'Ischemic Stroke'</span><span class="p">,</span><span class="mf">0.7</span><span class="p">],</span>
<span class="p">[</span> <span class="s">'Hemmorraghic Stroke'</span><span class="p">,</span><span class="mf">0.3</span><span class="p">]</span>

<span class="c1"># (4)
</span><span class="p">[</span><span class="n">Anticoagulants</span><span class="p">]</span>

<span class="p">[</span><span class="n">Used</span><span class="s">',0.5],
['</span><span class="n">Not</span> <span class="n">used</span><span class="s">',0.5]

# (5)
[CTScanResult, MRIScanResult,StrokeType])

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',0.8],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',0.5],
[ '</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',0.5],
[ '</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',0],

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">',0],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">',0.4],
[ '</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">',0.4],
[ '</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">',0.9],

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',0.2],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',0.1],
[ '</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',0.1],
[ '</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',0.1],

# (6)
[StrokeType, Anticoagulants, Mortality]

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="n">Used</span><span class="s">', '</span><span class="bp">False</span><span class="s">',0.28],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="n">Used</span><span class="s">', '</span><span class="bp">False</span><span class="s">',0.99],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">', '</span><span class="n">Used</span><span class="s">', '</span><span class="bp">False</span><span class="s">',0.1],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">','</span><span class="n">Not</span> <span class="n">used</span><span class="s">', '</span><span class="bp">False</span><span class="s">',0.56],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="n">Not</span> <span class="n">used</span><span class="s">', '</span><span class="bp">False</span><span class="s">',0.58],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">', '</span><span class="n">Not</span> <span class="n">used</span><span class="s">', '</span><span class="bp">False</span><span class="s">',0.05],

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',  '</span><span class="n">Used</span><span class="s">' ,'</span><span class="bp">True</span><span class="s">',0.72],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="n">Used</span><span class="s">', '</span><span class="bp">True</span><span class="s">',0.01],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">', '</span><span class="n">Used</span><span class="s">', '</span><span class="bp">True</span><span class="s">',0.9],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',  '</span><span class="n">Not</span> <span class="n">used</span><span class="s">' ,'</span><span class="bp">True</span><span class="s">',0.44],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="n">Not</span> <span class="n">used</span><span class="s">', '</span><span class="bp">True</span><span class="s">',0.42 ],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">', '</span><span class="n">Not</span> <span class="n">used</span><span class="s">', '</span><span class="bp">True</span><span class="s">',0.95]

# (7)
[StrokeType, PatientAge, Disability]

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',   '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">','</span><span class="n">Negligible</span><span class="s">', 0.80],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">','</span><span class="n">Negligible</span><span class="s">', 0.70],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">', '</span><span class="n">Negligible</span><span class="s">',0.9],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Negligible</span><span class="s">', 0.60],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Negligible</span><span class="s">', 0.50],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">', '</span><span class="n">Negligible</span><span class="s">',0.4],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  , '</span><span class="n">Negligible</span><span class="s">',0.30],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  , '</span><span class="n">Negligible</span><span class="s">',0.20],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  , '</span><span class="n">Negligible</span><span class="s">',0.1],

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">' ,'</span><span class="n">Moderate</span><span class="s">',0.1],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">' ,'</span><span class="n">Moderate</span><span class="s">',0.2],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">' ,'</span><span class="n">Moderate</span><span class="s">',0.05],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Moderate</span><span class="s">',0.3],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Moderate</span><span class="s">',0.4],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Moderate</span><span class="s">',0.3],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  ,'</span><span class="n">Moderate</span><span class="s">',0.4],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  ,'</span><span class="n">Moderate</span><span class="s">',0.2],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  ,'</span><span class="n">Moderate</span><span class="s">',0.1],

['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">' ,'</span><span class="n">Severe</span><span class="s">',0.1],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">' ,'</span><span class="n">Severe</span><span class="s">',0.1],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">0</span><span class="o">-</span><span class="mi">30</span><span class="s">' ,'</span><span class="n">Severe</span><span class="s">',0.05],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Severe</span><span class="s">',0.1],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Severe</span><span class="s">',0.1],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">31</span><span class="o">-</span><span class="mi">65</span><span class="s">','</span><span class="n">Severe</span><span class="s">',0.3],
['</span><span class="n">Ischemic</span> <span class="n">Stroke</span><span class="s">',     '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  ,'</span><span class="n">Severe</span><span class="s">',0.3],
['</span><span class="n">Hemmorraghic</span> <span class="n">Stroke</span><span class="s">', '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  ,'</span><span class="n">Severe</span><span class="s">',0.6],
['</span><span class="n">Stroke</span> <span class="n">Mimic</span><span class="s">',        '</span><span class="mi">65</span><span class="o">+</span><span class="s">'  ,'</span><span class="n">Severe</span><span class="s">',0.8]
</span></code></pre></div></div>

<h3 id="calculation">Calculation</h3>

<p>Please implement the VE algorithm (C++ or Python) to calculate the following probability value:</p>

<ol>
  <li>p1 = P(Mortality=’True’ $\land$ CTScanResult=’Ischemic Stroke’ $\mid$ PatientAge=’31-65’ )</li>
  <li>p2 = P(Disability=’Moderate’ $\land$ CTScanResult=’Hemmorraghic Stroke’ $\mid$ PatientAge=’65+’ $\land$ MRIScanResult=’Hemmorraghic Stroke’)</li>
  <li>p3 = P(StrokeType=’Hemmorraghic Stroke’ $\mid$ PatientAge=’65+’ $\land$ CTScanResult=’Hemmorraghic Stroke’ $\land$ MRIScanResult=’Ischemic Stroke’)</li>
  <li>p4 = P(Anticoagulants=’Used’ $\mid$ PatientAge=’31-65’)</li>
  <li>p5 = P(Disability=’Negligible’)</li>
</ol>

<h3 id="codediagnosingpy">Code<code class="highlighter-rouge">Diagnosing.py</code></h3>

<p>为了简化代码实现，下面变量取值的<code class="highlighter-rouge">0</code>、<code class="highlighter-rouge">1</code>、<code class="highlighter-rouge">2</code>代表该变量取值在对应 domain 中的下标。在<a href="https://wu-kan.cn/_posts/2019-11-14-Variable-Elimination/">之前做过的实验</a>上改改就成功了。</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">VariableElimination</span><span class="p">:</span>
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="n">factorList</span><span class="p">,</span> <span class="n">queryVariables</span><span class="p">,</span>
                  <span class="n">orderedListOfHiddenVariables</span><span class="p">,</span> <span class="n">evidenceList</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">evidenceList</span><span class="p">:</span>
             <span class="c1"># Your code here
</span>            <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">factorList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">.</span><span class="n">varList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">factor</span><span class="p">.</span><span class="n">varList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">factorList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">factor</span><span class="p">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">ev</span><span class="p">,</span> <span class="n">evidenceList</span><span class="p">[</span><span class="n">ev</span><span class="p">]))</span>
                    <span class="n">factorList</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">orderedListOfHiddenVariables</span><span class="p">:</span>
            <span class="c1"># Your code here
</span>            <span class="n">new_var_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">factorList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">e</span><span class="p">.</span><span class="n">varList</span><span class="p">:</span>
                    <span class="n">new_var_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">new_var_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">factorList</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">:</span>
                        <span class="n">factorList</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
                    <span class="n">new_var</span> <span class="o">=</span> <span class="n">e</span>
                    <span class="n">first</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_var</span> <span class="o">=</span> <span class="n">new_var</span><span class="p">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">factorList</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_var</span><span class="p">.</span><span class="n">sumout</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"RESULT:"</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">factorList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">factorList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">cpt</span><span class="p">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">res</span><span class="p">.</span><span class="n">cpt</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">/</span><span class="n">total</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">res</span><span class="p">.</span><span class="n">cpt</span><span class="p">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">res</span><span class="p">.</span><span class="n">printInf</span><span class="p">()</span>

    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">printFactors</span><span class="p">(</span><span class="n">factorList</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">factorList</span><span class="p">:</span>
            <span class="n">factor</span><span class="p">.</span><span class="n">printInf</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Util</span><span class="p">:</span>
    <span class="o">@</span><span class="nb">staticmethod</span>
    <span class="k">def</span> <span class="nf">to_binary</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="nb">len</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s">'0'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span> <span class="o">+</span> <span class="s">'b'</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">var_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">varList</span> <span class="o">=</span> <span class="n">var_list</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cpt</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">setCpt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cpt</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">cpt</span> <span class="o">=</span> <span class="n">cpt</span>

    <span class="k">def</span> <span class="nf">printInf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Name = "</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">" vars "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">cpt</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"   key: "</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="s">" val : "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">cpt</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">print</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">):</span>
        <span class="s">"""function that multiplies with another factor"""</span>
        <span class="c1"># Your code here
</span>        <span class="n">new_cpt</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">new_var_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">)</span>
        <span class="n">idx1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">idx2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">.</span><span class="n">varList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">new_var_list</span><span class="p">:</span>
                <span class="n">idx1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
                <span class="n">idx2</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">factor</span><span class="p">.</span><span class="n">varList</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_var_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k1</span><span class="p">,</span> <span class="n">v1</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">cpt</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">k2</span><span class="p">,</span> <span class="n">v2</span> <span class="ow">in</span> <span class="n">factor</span><span class="p">.</span><span class="n">cpt</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx1</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">k1</span><span class="p">[</span><span class="n">idx1</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">!=</span> <span class="n">k2</span><span class="p">[</span><span class="n">idx2</span><span class="p">[</span><span class="n">i</span><span class="p">]]:</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="n">new_key</span> <span class="o">=</span> <span class="n">k1</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k2</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx2</span><span class="p">:</span>
                            <span class="n">new_key</span> <span class="o">+=</span> <span class="n">k2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">new_cpt</span><span class="p">[</span><span class="n">new_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">*</span> <span class="n">v2</span>

        <span class="n">new_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"f"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_var_list</span><span class="p">),</span> <span class="n">new_var_list</span><span class="p">)</span>
        <span class="n">new_node</span><span class="p">.</span><span class="n">setCpt</span><span class="p">(</span><span class="n">new_cpt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_node</span>

    <span class="k">def</span> <span class="nf">sumout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
        <span class="s">"""function that sums out a variable given a factor"""</span>
        <span class="c1"># Your code here
</span>        <span class="n">new_cpt</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">new_var_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">)</span>
        <span class="n">new_var_list</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">cpt</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">k</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_cpt</span><span class="p">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">new_cpt</span><span class="p">[</span><span class="n">tmp</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_cpt</span><span class="p">[</span><span class="n">tmp</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span>

        <span class="n">new_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"f"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_var_list</span><span class="p">),</span> <span class="n">new_var_list</span><span class="p">)</span>
        <span class="n">new_node</span><span class="p">.</span><span class="n">setCpt</span><span class="p">(</span><span class="n">new_cpt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_node</span>

    <span class="k">def</span> <span class="nf">restrict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s">"""function that restricts a variable to some value
        in a given factor"""</span>
        <span class="c1"># Your code here
</span>        <span class="n">new_cpt</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">new_var_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">)</span>
        <span class="n">new_var_list</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">varList</span><span class="p">.</span><span class="n">index</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">cpt</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">new_cpt</span><span class="p">[</span><span class="n">k</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">v</span>

        <span class="n">new_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"f"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_var_list</span><span class="p">),</span> <span class="n">new_var_list</span><span class="p">)</span>
        <span class="n">new_node</span><span class="p">.</span><span class="n">setCpt</span><span class="p">(</span><span class="n">new_cpt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_node</span>


<span class="n">PatientAge</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"PatientAge"</span><span class="p">,</span> <span class="p">[</span><span class="s">"PatientAge"</span><span class="p">])</span>
<span class="n">MRIScanResult</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"MRIScanResult"</span><span class="p">,</span> <span class="p">[</span><span class="s">"MRIScanResult"</span><span class="p">])</span>
<span class="n">CTScanResult</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"CTScanResult"</span><span class="p">,</span> <span class="p">[</span><span class="s">"CTScanResult"</span><span class="p">])</span>
<span class="n">Anticoagulants</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"Anticoagulants"</span><span class="p">,</span> <span class="p">[</span><span class="s">"Anticoagulants"</span><span class="p">])</span>
<span class="n">StrokeType</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"StrokeType"</span><span class="p">,</span> <span class="p">[</span><span class="s">"StrokeType"</span><span class="p">,</span>
                                 <span class="s">"CTScanResult"</span><span class="p">,</span> <span class="s">"MRIScanResult"</span><span class="p">])</span>
<span class="n">Disability</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"Disability"</span><span class="p">,</span> <span class="p">[</span><span class="s">"Disability"</span><span class="p">,</span> <span class="s">"StrokeType"</span><span class="p">,</span> <span class="s">"PatientAge"</span><span class="p">])</span>
<span class="n">Mortality</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="s">"Mortality"</span><span class="p">,</span> <span class="p">[</span><span class="s">"Mortality"</span><span class="p">,</span> <span class="s">"StrokeType"</span><span class="p">,</span> <span class="s">"Anticoagulants"</span><span class="p">])</span>
<span class="n">PatientAge</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'0'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s">'1'</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="s">'2'</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">})</span>
<span class="n">CTScanResult</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'0'</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s">'1'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">})</span>
<span class="n">MRIScanResult</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'0'</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s">'1'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">})</span>
<span class="n">Anticoagulants</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'0'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">'1'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">})</span>
<span class="n">StrokeType</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'000'</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span> <span class="s">'001'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                   <span class="s">'010'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s">'011'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                   <span class="s">'100'</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s">'101'</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
                   <span class="s">'110'</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s">'111'</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
                   <span class="s">'200'</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s">'201'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                   <span class="s">'210'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s">'211'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">})</span>
<span class="n">Mortality</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'000'</span><span class="p">:</span> <span class="mf">0.56</span><span class="p">,</span> <span class="s">'001'</span><span class="p">:</span> <span class="mf">0.28</span><span class="p">,</span>
                  <span class="s">'010'</span><span class="p">:</span> <span class="mf">0.58</span><span class="p">,</span> <span class="s">'011'</span><span class="p">:</span> <span class="mf">0.99</span><span class="p">,</span>
                  <span class="s">'020'</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s">'021'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span>
                  <span class="s">'100'</span><span class="p">:</span> <span class="mf">0.44</span><span class="p">,</span> <span class="s">'101'</span><span class="p">:</span> <span class="mf">0.72</span><span class="p">,</span>
                  <span class="s">'110'</span><span class="p">:</span> <span class="mf">0.42</span><span class="p">,</span> <span class="s">'111'</span><span class="p">:</span> <span class="mf">0.01</span><span class="p">,</span>
                  <span class="s">'120'</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s">'121'</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">})</span>
<span class="n">Disability</span><span class="p">.</span><span class="n">setCpt</span><span class="p">({</span><span class="s">'000'</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">,</span> <span class="s">'010'</span><span class="p">:</span> <span class="mf">0.70</span><span class="p">,</span> <span class="s">'020'</span><span class="p">:</span> <span class="mf">0.90</span><span class="p">,</span>
                   <span class="s">'001'</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span> <span class="s">'011'</span><span class="p">:</span> <span class="mf">0.50</span><span class="p">,</span> <span class="s">'021'</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span>
                   <span class="s">'002'</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="s">'012'</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="s">'022'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span>
                   <span class="s">'100'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s">'110'</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="s">'120'</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                   <span class="s">'101'</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="s">'111'</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span> <span class="s">'121'</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
                   <span class="s">'102'</span><span class="p">:</span> <span class="mf">0.40</span><span class="p">,</span> <span class="s">'112'</span><span class="p">:</span> <span class="mf">0.20</span><span class="p">,</span> <span class="s">'122'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span>
                   <span class="s">'200'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s">'210'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s">'220'</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
                   <span class="s">'201'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s">'211'</span><span class="p">:</span> <span class="mf">0.10</span><span class="p">,</span> <span class="s">'221'</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span>
                   <span class="s">'202'</span><span class="p">:</span> <span class="mf">0.30</span><span class="p">,</span> <span class="s">'212'</span><span class="p">:</span> <span class="mf">0.60</span><span class="p">,</span> <span class="s">'222'</span><span class="p">:</span> <span class="mf">0.80</span><span class="p">})</span>


<span class="k">print</span><span class="p">(</span><span class="s">"P1 **********************"</span><span class="p">)</span>
<span class="n">VariableElimination</span><span class="p">.</span><span class="n">inference</span><span class="p">(</span>
    <span class="p">[</span><span class="n">PatientAge</span><span class="p">,</span> <span class="n">MRIScanResult</span><span class="p">,</span> <span class="n">CTScanResult</span><span class="p">,</span> <span class="n">Anticoagulants</span><span class="p">,</span> <span class="n">StrokeType</span><span class="p">,</span>
        <span class="n">Disability</span><span class="p">,</span> <span class="n">Mortality</span><span class="p">],</span> <span class="p">[</span><span class="s">'Mortality'</span><span class="p">,</span> <span class="s">'CTScanResult'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">'MRIScanResult'</span><span class="p">,</span> <span class="s">'Anticoagulants'</span><span class="p">,</span> <span class="s">'StrokeType'</span><span class="p">,</span> <span class="s">'Disability'</span><span class="p">],</span>
    <span class="p">{</span><span class="s">'PatientAge'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"P2 **********************"</span><span class="p">)</span>
<span class="n">VariableElimination</span><span class="p">.</span><span class="n">inference</span><span class="p">(</span>
    <span class="p">[</span><span class="n">PatientAge</span><span class="p">,</span> <span class="n">MRIScanResult</span><span class="p">,</span> <span class="n">CTScanResult</span><span class="p">,</span> <span class="n">Anticoagulants</span><span class="p">,</span> <span class="n">StrokeType</span><span class="p">,</span>
        <span class="n">Disability</span><span class="p">,</span> <span class="n">Mortality</span><span class="p">],</span> <span class="p">[</span><span class="s">'Disability'</span><span class="p">,</span> <span class="s">'CTScanResult'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">'Anticoagulants'</span><span class="p">,</span> <span class="s">'StrokeType'</span><span class="p">,</span> <span class="s">'Mortality'</span><span class="p">],</span>
    <span class="p">{</span><span class="s">'PatientAge'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'MRIScanResult'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"P3 **********************"</span><span class="p">)</span>
<span class="n">VariableElimination</span><span class="p">.</span><span class="n">inference</span><span class="p">(</span>
    <span class="p">[</span><span class="n">PatientAge</span><span class="p">,</span> <span class="n">MRIScanResult</span><span class="p">,</span> <span class="n">CTScanResult</span><span class="p">,</span> <span class="n">Anticoagulants</span><span class="p">,</span>
        <span class="n">StrokeType</span><span class="p">,</span> <span class="n">Disability</span><span class="p">,</span> <span class="n">Mortality</span><span class="p">],</span> <span class="p">[</span><span class="s">'StrokeType'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">'Disability'</span><span class="p">,</span> <span class="s">'Anticoagulants'</span><span class="p">,</span> <span class="s">'Mortality'</span><span class="p">],</span>
    <span class="p">{</span><span class="s">'PatientAge'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s">'CTScanResult'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'MRIScanResult'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"P4 **********************"</span><span class="p">)</span>
<span class="n">VariableElimination</span><span class="p">.</span><span class="n">inference</span><span class="p">(</span>
    <span class="p">[</span><span class="n">PatientAge</span><span class="p">,</span> <span class="n">MRIScanResult</span><span class="p">,</span> <span class="n">CTScanResult</span><span class="p">,</span> <span class="n">Anticoagulants</span><span class="p">,</span>
        <span class="n">StrokeType</span><span class="p">,</span> <span class="n">Disability</span><span class="p">,</span> <span class="n">Mortality</span><span class="p">],</span> <span class="p">[</span><span class="s">'Anticoagulants'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">'MRIScanResult'</span><span class="p">,</span> <span class="s">'CTScanResult'</span><span class="p">,</span> <span class="s">'StrokeType'</span><span class="p">,</span> <span class="s">'Disability'</span><span class="p">,</span> <span class="s">'Mortality'</span><span class="p">],</span>
    <span class="p">{</span><span class="s">'PatientAge'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s">"P5 **********************"</span><span class="p">)</span>
<span class="n">VariableElimination</span><span class="p">.</span><span class="n">inference</span><span class="p">(</span>
    <span class="p">[</span><span class="n">PatientAge</span><span class="p">,</span> <span class="n">MRIScanResult</span><span class="p">,</span> <span class="n">CTScanResult</span><span class="p">,</span> <span class="n">Anticoagulants</span><span class="p">,</span>
        <span class="n">StrokeType</span><span class="p">,</span> <span class="n">Disability</span><span class="p">,</span> <span class="n">Mortality</span><span class="p">],</span> <span class="p">[</span><span class="s">'Disability'</span><span class="p">],</span>
    <span class="p">[</span><span class="s">'PatientAge'</span><span class="p">,</span> <span class="s">'MRIScanResult'</span><span class="p">,</span> <span class="s">'CTScanResult'</span><span class="p">,</span>
        <span class="s">'Anticoagulants'</span><span class="p">,</span> <span class="s">'StrokeType'</span><span class="p">,</span> <span class="s">'Mortality'</span><span class="p">],</span>
    <span class="p">{}</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="resultdiagnosingtxt">Result<code class="highlighter-rouge">Diagnosing.txt</code></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>P1 <span class="k">**********************</span>
RESULT:
Name <span class="o">=</span> f[<span class="s1">'CTScanResult'</span>, <span class="s1">'Mortality'</span><span class="o">]</span>
 vars <span class="o">[</span><span class="s1">'CTScanResult'</span>, <span class="s1">'Mortality'</span><span class="o">]</span>
   key: 00 val : 0.283605
   key: 01 val : 0.41639499999999996
   key: 10 val : 0.17587499999999998
   key: 11 val : 0.12412500000000001

P2 <span class="k">**********************</span>
RESULT:
Name <span class="o">=</span> f[<span class="s1">'CTScanResult'</span>, <span class="s1">'Disability'</span><span class="o">]</span>
 vars <span class="o">[</span><span class="s1">'CTScanResult'</span>, <span class="s1">'Disability'</span><span class="o">]</span>
   key: 00 val : 0.16800000000000004
   key: 01 val : 0.20300000000000004
   key: 02 val : 0.329
   key: 10 val : 0.057
   key: 11 val : 0.057
   key: 12 val : 0.18600000000000005

P3 <span class="k">**********************</span>
RESULT:
Name <span class="o">=</span> f[<span class="s1">'StrokeType'</span><span class="o">]</span>
 vars <span class="o">[</span><span class="s1">'StrokeType'</span><span class="o">]</span>
   key: 0 val : 0.5000000000000001
   key: 1 val : 0.4
   key: 2 val : 0.10000000000000002

P4 <span class="k">**********************</span>
RESULT:
Name <span class="o">=</span> f[<span class="s1">'Anticoagulants'</span><span class="o">]</span>
 vars <span class="o">[</span><span class="s1">'Anticoagulants'</span><span class="o">]</span>
   key: 0 val : 0.5000000000000001
   key: 1 val : 0.49999999999999994

P5 <span class="k">**********************</span>
RESULT:
Name <span class="o">=</span> f[<span class="s1">'Disability'</span><span class="o">]</span>
 vars <span class="o">[</span><span class="s1">'Disability'</span><span class="o">]</span>
   key: 0 val : 0.38977
   key: 1 val : 0.292515
   key: 2 val : 0.317715


</code></pre></div></div>
