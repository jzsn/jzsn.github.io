<h2 id="二维">二维</h2>

<p>点和向量化为坐标 Coord 进行运算，使用 stl 中的 complex 实现。</p>

<p>复数相乘的几何意义为长度相乘，极角相加。</p>

<p>用直线上的一点 p 和方向向量 v 表示一条经过 p 的直线，直线上的所有点 q 满足 q=p+t*v，其中 t 是参数；当限制 t≥0 时，该参数方程表示射线；限制 0≤t≤1 时，该参数方程表示线段。</p>

<p>此外，如果已知线段端点 a1 和 a2，可以通过 Line(a1,a2-a1)来得到对应的参数形式。</p>

<p>Morley 定理：三角形每个内角的三等分线相交成等边三角形。</p>

<p>欧拉定理：平面图的点数 V、边数 E 和面数 F 满足 V+F-E=2。</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">complex</span><span class="o">&lt;</span><span class="n">lf</span><span class="o">&gt;</span> <span class="n">Coord</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span>
<span class="cp">#define X real()
#define Y imag()
</span><span class="k">struct</span> <span class="nc">Line</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">p</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">Line</span><span class="p">(</span><span class="n">Coord</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">Coord</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">())</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="n">v</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">Circle</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Circle</span><span class="p">(</span><span class="n">Coord</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Coord</span><span class="p">(),</span> <span class="n">lf</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">c</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{}</span>
	<span class="n">Coord</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="n">polar</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//t为参数，幅角</span>
<span class="p">};</span>
<span class="cm">/*
Coord(lf x=0,lf y=0);//构造函数
lf real(Coord a);//a的实部（复平面的横坐标）,也可写作a.real()
lf imag(Coord a);//a的虚部（复平面的纵坐标）,也可写作a.imag()

lf abs(Coord a);//向量a的模长，或是点a到原点的距离
lf norm(Coord a);//abs的平方，比abs快，但是要注意浮点数精度溢出

lf arg(Coord a);//a的幅角，与atan2(a.real(),a.imag())等价
Coord polar(lf r,lf t);//极坐标生成方式，r为幅值，t为幅角

//运算符重载+、-、*、/（以及对应的赋值运算，但是赋值运算不能写在表达式中，详见参考地址）、&lt;&lt;、&gt;&gt;（输出括号形式的坐标）
*/</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//不等运算符，涉及到浮点数比较要重写</span>

<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">A</span> <span class="o">!=</span> <span class="n">B</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="nf">cmpCoord</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">?</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">sgn</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//复数没有小于运算，只能这样定义一个比较函数</span>

<span class="kt">bool</span> <span class="nf">cmpLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">arg</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">v</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//按极角排序，求凸包中使用</span>

<span class="n">lf</span> <span class="nf">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span><span class="p">;</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">Area2</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//三角形ABC有向面积的两倍</span>

<span class="n">Coord</span> <span class="nf">Rotate</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="n">lf</span> <span class="n">rad</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">polar</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rad</span><span class="p">);}</span> <span class="c1">//向量A逆时针旋转rad弧度</span>

<span class="n">Coord</span> <span class="nf">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="c1">//A的法向量，把A逆时针旋转九十度并长度化为1</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">L</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Coord</span><span class="p">(</span><span class="o">-</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">/</span> <span class="n">L</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">/</span> <span class="n">L</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">onLeft</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p是否在有向直线L左侧，不含线上</span>

<span class="n">lf</span> <span class="nf">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//点到直线距离（有向）</span>

<span class="n">lf</span> <span class="nf">DistanceToLine</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">lf</span> <span class="nf">DistanceToSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//点到线段的距离（无向）</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)));</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="nf">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">P</span> <span class="o">-</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">norm</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//点在直线上的投影</span>

<span class="n">Coord</span> <span class="nf">getLineProjection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>

<span class="n">Coord</span> <span class="nf">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">O</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">O</span> <span class="o">+</span> <span class="n">O</span> <span class="o">-</span> <span class="n">P</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//P关于O的对称点</span>

<span class="n">Coord</span> <span class="nf">getSymmetry</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getSymmetry</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">L</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//P关于L的对称点</span>

<span class="n">Coord</span> <span class="nf">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">L1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L1</span><span class="p">.</span><span class="n">p</span> <span class="o">-</span> <span class="n">L2</span><span class="p">.</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">Cross</span><span class="p">(</span><span class="n">L1</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">L2</span><span class="p">.</span><span class="n">v</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//直线交点,须确保两直线相交</span>

<span class="n">Coord</span> <span class="nf">getLineIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">));</span> <span class="p">}</span>

<span class="kt">bool</span> <span class="nf">SegmentProperIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B2</span><span class="p">)</span> <span class="c1">//线段相交判定，交点不在一条线段的端点</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">C1</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B1</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span> <span class="n">C2</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">,</span> <span class="n">B2</span> <span class="o">-</span> <span class="n">A1</span><span class="p">),</span>
	   <span class="n">C3</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">B1</span><span class="p">),</span> <span class="n">C4</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">B1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C4</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="nf">onSegment</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A2</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A1</span> <span class="o">-</span> <span class="n">P</span><span class="p">,</span> <span class="n">A2</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//判断点是否在线段上，不包含端点</span>

<span class="n">lf</span> <span class="nf">PolygonArea</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//计算多边形的有向面积，凸多边形即为面积</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">+=</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">s</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">inPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">)</span> <span class="c1">//点在多边形内的判定，转角法，正值为内部，0为外部，-1在边界上</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//在边界上</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span> <span class="o">-</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">d1</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="n">d2</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">].</span><span class="n">Y</span> <span class="o">-</span> <span class="n">p</span><span class="p">.</span><span class="n">Y</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">++</span><span class="n">ans</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d2</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">d1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="o">--</span><span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">collineation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//获得凸包，不希望凸包的边上有输入点第二个参数传0</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">ans</span><span class="p">;</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">p</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpCoord</span><span class="p">);</span> <span class="c1">//先比横坐标再比纵坐标</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>  <span class="c1">//求出下凸包</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span> <span class="c1">//求出上凸包</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="n">sgn</span><span class="p">(</span><span class="n">Area2</span><span class="p">(</span><span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ans</span><span class="p">[</span><span class="n">ans</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">2</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="n">collineation</span><span class="p">)</span>
			<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">ans</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">cutPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">poly</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="c1">//用有向直线A-&gt;B切割多边形poly， 返回“左侧”。 如果退化，可能会返回一个单点或者线段，复杂度O(n^2)</span>
<span class="p">{</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">newpoly</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">poly</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">C</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">D</span> <span class="o">=</span> <span class="n">poly</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">D</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="n">Coord</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">),</span> <span class="n">Line</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span> <span class="o">-</span> <span class="n">C</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onSegment</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">))</span>
				<span class="n">newpoly</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ip</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">newpoly</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">getHalfPlaneIntersection</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">L</span><span class="p">)</span> <span class="c1">//半平面交</span>
<span class="p">{</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">L</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">cmpLine</span><span class="p">);</span>  <span class="c1">//按极角排序</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Coord</span><span class="p">());</span> <span class="c1">//p[i]为q[i]和q[i+1]的交点</span>
	<span class="kt">int</span> <span class="n">first</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>			<span class="c1">//双端队列的第一个元素和最后一个元素</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Line</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">Line</span><span class="p">());</span>   <span class="c1">//双端队列</span>
	<span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>						<span class="c1">//队列初始化为只有一个半平面L[0]</span>

	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">n</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">first</span><span class="p">],</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
			<span class="o">++</span><span class="n">first</span><span class="p">;</span>

		<span class="n">q</span><span class="p">[</span><span class="o">++</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">].</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">v</span><span class="p">)))</span>
		<span class="p">{</span>
			<span class="o">--</span><span class="n">last</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">onLeft</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]))</span>
				<span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span><span class="p">)</span>
			<span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">last</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">onLeft</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">last</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]))</span>
		<span class="o">--</span><span class="n">last</span><span class="p">;</span> <span class="c1">//删除无用平面</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">();</span> <span class="c1">//空集</span>
	<span class="n">p</span><span class="p">[</span><span class="n">last</span><span class="p">]</span> <span class="o">=</span> <span class="n">getLineIntersection</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">last</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="n">first</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">first</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//从deque复制到输出中</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getLineCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Line</span> <span class="o">&amp;</span><span class="n">L</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">b</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
	   <span class="n">c</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">L</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
	   <span class="n">e</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span>
	   <span class="n">f</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">d</span><span class="p">),</span>
	   <span class="n">g</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">delta</span> <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">f</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">e</span> <span class="o">*</span> <span class="n">g</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">))),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">L</span><span class="p">.</span><span class="n">point</span><span class="p">((</span><span class="o">-</span><span class="n">f</span> <span class="o">+</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">e</span><span class="p">)));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getCircleIntersection</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C2</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//重合返回-1</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="c1">//外离或内含</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">C2</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">C1</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">da</span> <span class="o">=</span> <span class="n">acos</span><span class="p">((</span><span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C2</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">C1</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">d</span><span class="p">));</span>

	<span class="n">Coord</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">da</span><span class="p">),</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">C1</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">da</span><span class="p">);</span>

	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//相切</span>
	<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p2</span><span class="p">),</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Line</span> <span class="nf">getTangent</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Line</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Normal</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">P</span><span class="p">));</span> <span class="p">}</span> <span class="c1">//圆心C，圆上一点P处切线</span>

<span class="kt">int</span> <span class="nf">getTangents</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sol</span><span class="p">)</span> <span class="c1">//点到圆的切点，返回个数</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">u</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">u</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>	  <span class="c1">//点在圆内</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">))</span> <span class="c1">//点在圆上</span>
		<span class="k">return</span> <span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">sol</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">C</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">getTangents</span><span class="p">(</span><span class="n">Circle</span> <span class="n">A</span><span class="p">,</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="c1">//公共切线的切点</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span> <span class="n">swap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="c1">//有时需标记交换</span>

	<span class="n">lf</span> <span class="n">d</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">c</span><span class="p">),</span>
	   <span class="n">rdiff</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">-</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">,</span>
	   <span class="n">rsum</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">r</span> <span class="o">+</span> <span class="n">B</span><span class="p">.</span><span class="n">r</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//内含</span>

	<span class="n">lf</span> <span class="n">base</span> <span class="o">=</span> <span class="n">arg</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">c</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">rdiff</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">//重合，无穷多条切线</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rdiff</span><span class="p">))</span> <span class="c1">//内切，外公切线</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1">//有外公切线的情形</span>
	<span class="n">lf</span> <span class="n">ang</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rdiff</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang</span><span class="p">));</span>
	<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">rsum</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ang_in</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">rsum</span> <span class="o">/</span> <span class="n">d</span><span class="p">);</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">a</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span><span class="p">));</span>
		<span class="n">b</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">B</span><span class="p">.</span><span class="n">point</span><span class="p">(</span><span class="n">base</span> <span class="o">-</span> <span class="n">ang_in</span> <span class="o">+</span> <span class="n">M_PI</span><span class="p">));</span>
		<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">cnt</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="nf">AreaCircleWithTriangle</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//C和三角形OAB的相交面积，如果三角形顶点不在O上则把圆和三角形同时平移，直到有一个顶点在O上</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">sg</span> <span class="o">=</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sg</span> <span class="o">||</span> <span class="n">A</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span> <span class="o">||</span> <span class="n">B</span> <span class="o">==</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">lf</span> <span class="n">OA</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">OB</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">c</span><span class="p">),</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">Angle</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">),</span>
	   <span class="n">d</span> <span class="o">=</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OA</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">sgn</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Coord</span> <span class="n">prj</span> <span class="o">=</span> <span class="n">getLineProjection</span><span class="p">(</span><span class="n">Coord</span><span class="p">(),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">prj</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
		<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>

		<span class="n">lf</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">angle</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
		   <span class="n">s2</span> <span class="o">=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">s2</span> <span class="o">-=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">s1</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">sg</span> <span class="o">*</span> <span class="n">s1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">OB</span> <span class="o">-</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">);</span>

	<span class="n">Line</span> <span class="n">L</span> <span class="o">=</span> <span class="n">Line</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="n">inter</span><span class="p">;</span>
	<span class="n">getLineCircleIntersection</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">inter</span><span class="p">);</span>
	<span class="n">Coord</span> <span class="n">inter_point</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="o">!</span><span class="n">onSegment</span><span class="p">(</span><span class="n">inter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)];</span>

	<span class="n">lf</span> <span class="n">s</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">s</span> <span class="o">+=</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">C</span><span class="p">.</span><span class="n">r</span> <span class="o">*</span> <span class="n">Angle</span><span class="p">(</span><span class="n">inter_point</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">s</span> <span class="o">*</span> <span class="n">sg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">lf</span> <span class="nf">AreaCircleWithPolygon</span><span class="p">(</span><span class="k">const</span> <span class="n">Circle</span> <span class="o">&amp;</span><span class="n">C</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">ans</span> <span class="o">+=</span> <span class="n">AreaCircleWithTriangle</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
	<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Coord</span> <span class="nf">getGravityCenter</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="c1">//多边形重心</span>
<span class="p">{</span>
	<span class="n">Coord</span> <span class="n">a</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">lf</span> <span class="n">am</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mj</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">mj</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">a</span> <span class="o">+=</span> <span class="n">mj</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
		<span class="n">am</span> <span class="o">+=</span> <span class="n">mj</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">am</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="三维">三维</h2>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="kt">double</span> <span class="n">lf</span><span class="p">;</span>
<span class="k">const</span> <span class="n">lf</span> <span class="n">EPS</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">INF</span> <span class="o">=</span> <span class="mf">1e9</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">sgn</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">EPS</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">EPS</span><span class="p">);</span> <span class="p">}</span>
<span class="k">struct</span> <span class="nc">Coord3</span>
<span class="p">{</span>
	<span class="n">lf</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">;</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">)</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="n">b</span><span class="p">);</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">+=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">+=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">-=</span> <span class="n">b</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">*=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">*</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">*=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">/=</span><span class="p">(</span><span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">X</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Y</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="n">Z</span> <span class="o">/=</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="k">operator</span><span class="o">/</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">lf</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span> <span class="o">/=</span> <span class="n">d</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Dot</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">+</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Cross</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{</span><span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">Z</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Z</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">X</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">Y</span> <span class="o">-</span> <span class="n">A</span><span class="p">.</span><span class="n">Y</span> <span class="o">*</span> <span class="n">B</span><span class="p">.</span><span class="n">X</span><span class="p">};</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">norm</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">A</span><span class="p">);</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">abs</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Angle</span><span class="p">(</span><span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">A</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">acos</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">B</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Area2</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">Volume6</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">D</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">Cross</span><span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">C</span> <span class="o">-</span> <span class="n">A</span><span class="p">));</span> <span class="p">}</span>	 <span class="c1">//四面体体积</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">C</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">D</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">;</span> <span class="p">}</span>		  <span class="c1">//四面体的重心</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToPlane</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="p">}</span>		  <span class="c1">//点p到平面p0-n的有向距离</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">getPlaneProjection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="k">const</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">p</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p0</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span> <span class="p">}</span> <span class="c1">//点p在平面p0-n上的投影。n必须为单位向量</span>
	<span class="k">friend</span> <span class="n">Coord3</span> <span class="n">LinePlaneIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p0</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">n</span><span class="p">)</span>							  <span class="c1">//直线p1-p2 与平面p0-n的交点，假设交点唯一存在</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p0</span> <span class="o">-</span> <span class="n">p1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span><span class="p">);</span> <span class="c1">//分母为0，直线与平面平行或在平面上</span>
		<span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">t</span><span class="p">;</span>						  <span class="c1">//如果是线段 判断t是否在0~1之间</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//点P到直线AB的距离</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">DistanceToSeg</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">)</span> <span class="c1">//点到线段的距离</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">B</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">A</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">-</span> <span class="n">B</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">fabs</span><span class="p">(</span><span class="n">DistanceToLine</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">LineDistance3D</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">u</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">v</span><span class="p">,</span> <span class="n">lf</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="c1">//求异面直线 p1+s*u与p2+t*v的公垂线对应的s，如果平行|重合，返回0</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sgn</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">lf</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">)</span> <span class="o">-</span> <span class="n">Dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">p2</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">p1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">p2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p1</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span> <span class="n">Cross</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">,</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">a</span><span class="p">)))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//p1和p2是否在线段a-b的同侧</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>																						 <span class="c1">//点P在三角形P0,P1,p中</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
			   <span class="n">SameSide</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">A</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">B</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">PP</span><span class="p">)</span> <span class="c1">//三角形P0P1p是否和线段AB相交，如有则为PP</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">n</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>						 <span class="c1">//线段A-B和平面P0P1p平行或共面</span>
		<span class="n">lf</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">/</span> <span class="n">Dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">);</span> <span class="c1">//平面A和直线P1-p有惟一交点</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sgn</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">sgn</span><span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">//不在线段AB上</span>
		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">TriTriIntersection</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">T1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">Coord3</span> <span class="n">T2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">//空间两三角形是否相交</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">P</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T2</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">)</span> <span class="o">||</span>
				<span class="n">TriSegIntersection</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="n">T1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T1</span><span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">],</span> <span class="n">P</span><span class="p">))</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">SegSegDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">a1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">a2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="n">b2</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans1</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">&amp;</span><span class="n">ans2</span><span class="p">)</span> <span class="c1">//空间两直线上最近点对 返回最近距离 点对保存在ans1 ans2中</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">b1</span><span class="p">),</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">b2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">ab</span> <span class="o">=</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">a2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">ab</span><span class="p">)</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>
		<span class="n">Coord3</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">,</span> <span class="n">cd</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span>
		<span class="n">lf</span> <span class="n">nd</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">cd</span><span class="p">),</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d2</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">Dot</span><span class="p">(</span><span class="n">Cross</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">,</span> <span class="n">d1</span><span class="p">),</span> <span class="n">cd</span><span class="p">)</span> <span class="o">/</span> <span class="n">nd</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ans1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">*</span> <span class="n">t1</span><span class="p">,</span> <span class="n">ans2</span> <span class="o">=</span> <span class="n">a2</span> <span class="o">+</span> <span class="p">(</span><span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span><span class="p">)</span> <span class="o">*</span> <span class="n">t2</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ans</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="kt">bool</span> <span class="n">InsideWithMinDistance</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">PP</span><span class="p">,</span> <span class="n">Coord3</span> <span class="o">*</span><span class="n">P</span><span class="p">,</span> <span class="n">lf</span> <span class="n">dist</span><span class="p">)</span> <span class="c1">//判断PP是否在三角形P中，并且到三条边的距离都至少为dist。保证P,A,B,C共面</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">PointInTri</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span> <span class="o">||</span>
			   <span class="n">DistanceToLine</span><span class="p">(</span><span class="n">PP</span><span class="p">,</span> <span class="n">P</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">dist</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">friend</span> <span class="n">lf</span> <span class="n">minBall</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">lf</span> <span class="n">eps</span> <span class="o">=</span> <span class="n">EPS</span> <span class="o">*</span> <span class="mf">1e-3</span><span class="p">)</span> <span class="c1">//模拟退火求最小球覆盖，EPS玄学调整；返回半径</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">Coord3</span> <span class="n">z</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="n">eps</span><span class="p">;</span> <span class="n">step</span> <span class="o">*=</span> <span class="mf">0.99</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
					<span class="n">s</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">abs</span><span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]));</span>
			<span class="n">z</span> <span class="o">-=</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="o">*</span> <span class="n">step</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">Sphere</span>
<span class="p">{</span>
	<span class="n">Coord3</span> <span class="n">o</span><span class="p">;</span>
	<span class="n">lf</span> <span class="n">r</span><span class="p">;</span>
	<span class="n">Coord3</span> <span class="n">point</span><span class="p">(</span><span class="n">lf</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lf</span> <span class="n">lng</span><span class="p">)</span> <span class="k">const</span> <span class="c1">//经纬度确定球面上一点</span>
	<span class="p">{</span>
		<span class="n">lat</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="n">lng</span> <span class="o">*=</span> <span class="n">M_PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">o</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">lng</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">lat</span><span class="p">)};</span>
	<span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">ConvexPolyhedron</span> <span class="c1">//空间多边形和凸包问题</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="nc">Face</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">Face</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="p">}</span>
		<span class="n">Coord3</span> <span class="n">Normal</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Cross</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="p">}</span>
		<span class="kt">bool</span> <span class="n">CanSee</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">P</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Dot</span><span class="p">(</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">Normal</span><span class="p">(</span><span class="n">P</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//f是否能看见P[i]</span>
	<span class="p">};</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">faces</span><span class="p">;</span>
	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">ConvexPolyhedron</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Coord3</span><span class="o">&gt;</span> <span class="n">P</span><span class="p">)</span> <span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
			<span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Coord3</span><span class="p">{</span><span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">(),</span> <span class="n">randEPS</span><span class="p">()};</span>
		<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span> <span class="n">vis</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span> <span class="c1">//由于已经进行扰动，前三个点不共线</span>
		<span class="n">faces</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">vector</span><span class="o">&lt;</span><span class="n">Face</span><span class="o">&gt;</span> <span class="n">next</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="c1">//计算每条边的“左面”的可见性</span>
			<span class="p">{</span>
				<span class="n">Face</span> <span class="o">&amp;</span><span class="n">f</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
				<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">CanSee</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="p">)</span>
					<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
					<span class="n">vis</span><span class="p">[</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="n">f</span><span class="p">.</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">res</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span>
				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="o">++</span><span class="n">k</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">b</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">v</span><span class="p">[(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span><span class="p">];</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vis</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="n">a</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">vis</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">b</span><span class="p">])</span> <span class="c1">//(a,b)是分界线，左边对P[i]可见</span>
						<span class="n">next</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Face</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">i</span><span class="p">));</span>
				<span class="p">}</span>
			<span class="n">swap</span><span class="p">(</span><span class="n">faces</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">randEPS</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">rand</span><span class="p">()</span> <span class="o">/</span> <span class="n">lf</span><span class="p">(</span><span class="n">RAND_MAX</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">EPS</span><span class="p">;</span> <span class="p">}</span>
	<span class="n">Coord3</span> <span class="n">centroid</span><span class="p">()</span> <span class="c1">//三维凸包重心</span>
	<span class="p">{</span>
		<span class="n">Coord3</span> <span class="n">C</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tot</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
		<span class="n">lf</span> <span class="n">totv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">lf</span> <span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
			<span class="n">totv</span> <span class="o">+=</span> <span class="n">v</span><span class="p">;</span>
			<span class="n">tot</span> <span class="o">+=</span> <span class="n">v</span> <span class="o">*</span> <span class="n">Centroid</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">tot</span> <span class="o">/</span> <span class="n">totv</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">lf</span> <span class="n">dist</span><span class="p">(</span><span class="n">Coord3</span> <span class="n">C</span><span class="p">)</span> <span class="c1">//凸包内一点到表面最近距离</span>
	<span class="p">{</span>
		<span class="n">lf</span> <span class="n">ans</span> <span class="o">=</span> <span class="n">INF</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">faces</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Coord3</span> <span class="n">p1</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">p3</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]];</span>
			<span class="n">ans</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span> <span class="n">fabs</span><span class="p">(</span><span class="o">-</span><span class="n">Volume6</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span> <span class="o">/</span> <span class="n">Area2</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)));</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">ans</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>
</code></pre></div></div>
